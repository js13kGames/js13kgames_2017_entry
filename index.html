<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
<style type="text/css">body,html{background-color:#000;height:100%;margin:0;padding:0;width:100%}#canvas{background-color:inherit;border-radius:235px;left:50%;margin:-224px 0 0 -224px;position:fixed;top:50%;z-index:100}</style></head>

<body>
  <canvas id="canvas"></canvas>
<script type="text/javascript">!function(e){function t(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function y(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function g(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function v(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function b(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function w(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function k(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function O(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function x(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function M(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function T(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function E(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function j(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function S(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function C(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function P(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function I(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function W(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function R(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function A(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function G(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function H(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function z(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function B(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function D(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function L(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Y(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function F(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function K(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function N(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function U(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function X(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function J(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function q(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function Q(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function V(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function Z(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function $(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ee(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function te(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function ne(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ie(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function re(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function oe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ae(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function se(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function ue(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function he(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function le(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function fe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ce(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ye(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function pe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function de(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ge(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ve(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function be(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function we(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function me(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var ke=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Oe=null,xe=function(){function e(t,n,r){i(this,e),this.title=t,this.width=n,this.height=r,this.createDisplay()}return ke(e,[{key:"createDisplay",value:function(){document.title=this.title;var e=document.getElementById("canvas");e.setAttribute("height",this.height),e.setAttribute("width",this.width),Oe=e.getContext("2d"),Oe.webkitImageSmoothingEnabled=!1,Oe.mozImageSmoothingEnabled=!1,Oe.imageSmoothingEnabled=!1}},{key:"getTitle",value:function(){return this.title}},{key:"getWidth",value:function(){return this.width}},{key:"getHeight",value:function(){return this.height}},{key:"getGraphics",value:function(){return Oe}}]),e}();CanvasRenderingContext2D.prototype.myDrawImage=function(e,t,n,i,r){Oe.drawImage(e.sheet,e.x,e.y,e.width,e.height,t,n,i,r)},CanvasRenderingContext2D.prototype.drawText=function(e){Oe.font=e.fontSize+"px Arial",Oe.fillStyle=e.fillColor,Oe.strokeText(e.text,e.x,e.y),Oe.fillText(e.text,e.x,e.y)};var Me=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),_e=function(){function e(t,n,i,o){r(this,e),this.x=t,this.y=n,this.width=i,this.height=o}return Me(e,[{key:"intersects",value:function(e){return this.x<e.x+e.width&&this.x+this.width>e.x&&this.y<e.y+e.height&&this.y+this.height>e.y}}]),e}(),Te=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Ee=void 0,je=void 0,Se=void 0,Ce=function(e,t){var n=e.getY(),i=t.getY(),r=e.getHeight(),o=t.getHeight();return n+r===i+o?0:n+r<i+o?-1:1},Pe=function(){function e(t,n){o(this,e),Ee=t,je=n,Se=new Array(je)}return Te(e,[{key:"tick",value:function(e){Se.sort(Ce);for(var t=0;t<Se.length;t++){Se[t].tick(e)}}},{key:"render",value:function(e){Se.forEach(function(t){var n=t.handler.getWidth()+t.handler.getGameCamera().getxOffset(),i=t.handler.getHeight()+t.handler.getGameCamera().getyOffset(),r=t.handler.getGameCamera().getxOffset()-t.width,o=t.handler.getGameCamera().getyOffset()-t.height,a=!1;e.font="72px Arial",e.fillStyle="red",(t.x>n||t.y>i||t.x<r||t.y<o)&&(a=!0),a||t.render(e)},this)}},{key:"getPlayer",value:function(){return je}},{key:"getHandler",value:function(){return Ee}},{key:"getEntities",value:function(){return Se}},{key:"getSingleEntity",value:function(e){var t=void 0;return Se.forEach(function(n){n.type===e&&(t={type:n.type,x:n.x,y:n.y})}),t}},{key:"addEntity",value:function(e){Se.push(e),Ee.getWorld().getSpatialGrid().insert(new _e(e.x+e.bounds.x,e.y+e.bounds.y,e.bounds.width,e.bounds.height),e)}},{key:"removeEntity",value:function(e){for(var t=0;t<Se.length;t++){Se[t]===e&&Se.splice(t,1)}}},{key:"removeAllMonsters",value:function(){for(var e=0;e<Se.length;e++){"monster"===Se[e].type&&Se.splice(e,1)}}}]),e}(),Ie=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),We=function(){function e(){a(this,e)}return Ie(e,null,[{key:"loadImage",value:function(e){var t=new Image;return t.src=e,t}}]),e}(),Re=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Ae=function(){function e(t){s(this,e),this.sheet=t}return Re(e,[{key:"crop",value:function(e,t,n,i){return{sheet:this.sheet,x:e,y:t,width:n,height:i}}}]),e}(),Ge=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),He={},ze=window.location.href+"/src/res/",Be=function(){function e(t,n,i,r){u(this,e),He[t]=this,this.name=t,this.path=n,this.width=i,this.height=r,this.sheet=new Ae(We.loadImage(this.path))}return Ge(e,[{key:"getWidth",value:function(){return DEFAULT_WIDTH}},{key:"getHeight",value:function(){return DEFAULT_HEIGHT}}],[{key:"getAssets",value:function(e){return He[e]}}]),e}(),De=function(e,t,n){return e.sheet.crop(16*t,16*n,16,16)},Le=new Be("tiles",ze+"tiles_16x16_tiny.png",16,16);Le.path=De(Le,1,0),Le.pathBlue=De(Le,1,2),Le.pathGreen=De(Le,2,2),Le.pathYellow=De(Le,0,2),Le.wall=De(Le,0,0),Le.wallBlue=De(Le,1,1),Le.wallGreen=De(Le,2,1),Le.wallYellow=De(Le,0,1),Le.switchBlue=De(Le,2,0),Le.switchGreen=De(Le,3,0),Le.exit=De(Le,3,1);var Ye=new Be("creatures",ze+"player_16x16_tiny.png",16,16);Ye.playerDown=De(Ye,0,0),Ye.ghostDown=De(Ye,0,1);var Fe=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Ke=function(){function e(t){h(this,e),this.handler=t,this.countSinceInput=0}return Fe(e,[{key:"tick",value:function(e){this.countSinceInput++,this.countSinceInput>8&&this.getInput(e),this.render()}},{key:"render",value:function(){alert("overwrite this menu render bro")}},{key:"getInput",value:function(){alert("overwrite this menu input bro")}}]),e}(),Ne=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Ue=function(e){function t(e){return l(this,t),f(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return c(t,e),Ne(t,[{key:"render",value:function(e){if(e){var t=this.handler.getWidth(),n=this.handler.getHeight();e.fillStyle="black",e.fillRect(0,0,t,n);var i="You escaped the maze!",r=t/2-e.measureText(i).width/2,o=n/3;e.drawText({fillColor:"yellow",text:i,fontSize:32,font:"serif",x:r,y:o}),i="Press enter for another run!",r=t/2-e.measureText(i).width/2,o=n/1.5,e.drawText({fillColor:"white",text:i,fontSize:32,font:"serif",x:r,y:o})}}},{key:"getInput",value:function(){this.handler.getKeyManager().enter&&window.location.reload()}}]),t}(Ke),Xe=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Je=function(e){function t(e){return y(this,t),p(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return d(t,e),Xe(t,[{key:"render",value:function(e){if(e){var t=this.handler.getWidth(),n=this.handler.getHeight();e.fillStyle="black",e.fillRect(0,0,t,n);var i="Y O U   D I E D",r=t/2-e.measureText(i).width/2,o=n/3;e.drawText({fillColor:"red",text:i,fontSize:32,font:"serif",x:r,y:o}),i="press enter to try again",r=t/2-e.measureText(i).width/2,o=n/1.5,e.drawText({fillColor:"white",text:i,fontSize:32,font:"serif",x:r,y:o})}}},{key:"getInput",value:function(){this.handler.getKeyManager().enter&&window.location.reload()}}]),t}(Ke),qe=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Qe=function(){function e(t,n,i,r,o){g(this,e),this.x=n,this.y=i,this.width=r,this.height=o,this.handler=t,this.bounds=new _e(0,0,r,o),this.target=null}return qe(e,[{key:"tick",value:function(e){throw"Entities must have a tick function!"}},{key:"render",value:function(e){throw"Entities must have a render function!"}},{key:"getX",value:function(){return this.x}},{key:"getY",value:function(){return this.y}},{key:"getWidth",value:function(){return this.width}},{key:"getHeight",value:function(){return this.height}},{key:"getCollisionBounds",value:function(e,t){return new _e(parseInt(this.x+this.bounds.x+e),parseInt(this.y+this.bounds.y+t),this.bounds.width,this.bounds.height)}},{key:"checkEntityCollisions",value:function(e,t){for(var n=this.handler.getWorld().getSpatialGrid().retrieve(new _e(this.x+this.bounds.x+e,this.y+this.bounds.y+t,this.bounds.width,this.bounds.height),this),i=0;i<n.length;i++){var r=n[i];if(r.getCollisionBounds(0,0).intersects(this.getCollisionBounds(e,t))){if("monster"===this.type&&"monster"===r.type)return!1;if("player"===this.type&&"monster"===r.type||"monster"===this.type&&"player"===r.type){if(this.invincible||r.invincible)return!1;var o=new Je(this.handler);this.handler.getGame().getGameState().setState(o)}return!0}}return!1}},{key:"setX",value:function(e){this.x=e}},{key:"setY",value:function(e){this.y=e}},{key:"setWidth",value:function(e){this.width=e}},{key:"setHeight",value:function(e){this.height=e}}]),e}(),Ve=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Ze=120,$e=200,et=64,tt=64,nt=function(e){function t(e,n,i){v(this,t);var r=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,i,et,tt));return r.health=$e,r.speed=Ze,r.xMove=0,r.yMove=0,r.init(),r}return w(t,e),Ve(t,[{key:"init",value:function(){}},{key:"move",value:function(){(Math.abs(this.xMove)>0||Math.abs(this.yMove)>0)&&(this.handler.getWorld().getSpatialGrid().remove(new _e(this.x+this.bounds.x,this.y+this.bounds.y,this.bounds.width,this.bounds.height),this),this.checkEntityCollisions(this.xMove,0)||this.moveX(),this.checkEntityCollisions(0,this.yMove)||this.moveY(),this.handler.getWorld().getSpatialGrid().insert(new _e(this.x+this.bounds.x,this.y+this.bounds.y,this.bounds.width,this.bounds.height),this))}},{key:"moveX",value:function(){if(this.clipping)return void(this.x+=this.xMove);var e=void 0;if(this.xMove>0){e=parseInt((this.x+this.xMove+this.bounds.x+this.bounds.width)/64);var t=parseInt((this.y+this.bounds.y)/64),n=parseInt((this.y+this.bounds.y+this.bounds.height)/64);this.collisionWithTile(e,t)||this.collisionWithTile(e,n)?(this.x=64*e-this.bounds.x-this.bounds.width-1,this.checkForSwitchOrTrigger(t,n,e)):this.x+=this.xMove}else if(this.xMove<0){e=parseInt((this.x+this.xMove+this.bounds.x)/64);var i=parseInt((this.y+this.bounds.y)/64),r=parseInt((this.y+this.bounds.y+this.bounds.height)/64);this.collisionWithTile(e,i)||this.collisionWithTile(e,r)?(this.x=64*e+64-this.bounds.x,this.checkForSwitchOrTrigger(i,r,e)):this.x+=this.xMove}}},{key:"moveY",value:function(){if(this.clipping)return void(this.y+=this.yMove);var e=void 0;if(this.yMove>0){e=parseInt((this.y+this.yMove+this.bounds.y+this.bounds.height)/64);var t=parseInt((this.x+this.bounds.x)/64),n=parseInt((this.x+this.bounds.x+this.bounds.width)/64);this.collisionWithTile(t,e)||this.collisionWithTile(n,e)?(this.y=64*e-this.bounds.y-this.bounds.height-1,this.checkForSwitchOrTrigger(t,n,e)):this.y+=this.yMove}else if(this.yMove<0){e=parseInt((this.y+this.yMove+this.bounds.y)/64);var i=parseInt((this.x+this.bounds.x)/64),r=parseInt((this.x+this.bounds.x+this.bounds.width)/64);this.collisionWithTile(i,e)||this.collisionWithTile(r,e)?(this.y=64*e+64-this.bounds.y,this.checkForSwitchOrTrigger(i,r,e)):this.y+=this.yMove}}},{key:"checkForSwitchOrTrigger",value:function(e,t,n){var i=this.handler.getWorld().getTile(e,n),r=this.handler.getWorld().getTile(t,n);if("switch"===i.type?this.handler.getWorld().swapGreenAndBlueTiles(i.color):"switch"===r.type&&this.handler.getWorld().swapGreenAndBlueTiles(r.color),"exit"===i.type||"exit"===r.type){var o=new Ue(this.handler);this.handler.getGame().getGameState().setState(o)}}},{key:"collisionWithTile",value:function(e,t){if(!(e<0||t<0))return this.handler.getWorld().getTile(e,t).isSolid}},{key:"getHealth",value:function(){return this.health}},{key:"getSpeed",value:function(){return this.speed}},{key:"setHealth",value:function(e){this.health=e}},{key:"setSpeed",value:function(e){this.speed=e}}]),t}(Qe),it=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),rt=64,ot=64,at=function(e){function t(e,n,i){m(this,t);var r=k(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,i,rt,ot));return r.assets=Be.getAssets("creatures"),r.x=n,r.y=i,r.bounds.x=5,r.bounds.y=5,r.bounds.width=rt-2*r.bounds.x,r.bounds.height=ot-2*r.bounds.y,r.type="monster",r.targetType="player",r.patrol=r.getPatrolPattern(),r.startX=n,r.startY=i,r.patrolLength=200,r.dirMoving=0,r.numberOfMoves=0,r}return O(t,e),it(t,[{key:"getPatrolPattern",value:function(){var e=["vertical","horizontal"];return e[Math.floor(Math.random()*e.length)]}},{key:"maybeChangePatrol",value:function(){Math.random()<.41&&(this.patrol="vertical"===this.patrol?"horizontal":"vertical")}},{key:"tick",value:function(e){this.xMove=0,this.yMove=0,"vertical"===this.patrol?(0===this.dirMoving?this.yMove=-this.speed*e:this.yMove=this.speed*e,++this.numberOfMoves>this.patrolLength&&(this.dirMoving=0===this.dirMoving?1:0,this.numberOfMoves=0,this.maybeChangePatrol())):"horizontal"===this.patrol&&(0===this.dirMoving?this.xMove=-this.speed*e:this.xMove=this.speed*e,++this.numberOfMoves>this.patrolLength&&(this.dirMoving=0===this.dirMoving?1:0,this.numberOfMoves=0,this.maybeChangePatrol())),this.move()}},{key:"render",value:function(e){e.myDrawImage(this.getCurrentAnimationFrame(),this.x-this.handler.getGameCamera().getxOffset(),this.y-this.handler.getGameCamera().getyOffset(),this.width,this.height)}},{key:"getInput",value:function(e){}},{key:"getCurrentAnimationFrame",value:function(){return this.assets.ghostDown}}]),t}(nt),st=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),ut=[],ht=[],lt=[2,3,7],ft=function(e,t){return 0===e||0===t||38===e||38===t?1:Math.floor(20*Math.random())<15?1:lt[Math.floor(Math.random()*lt.length)]},ct=function(){function e(){x(this,e)}return st(e,null,[{key:"createMaze",value:function(){for(var e=[],t=0;t<39;t++){ut[t]=[];for(var n=0;n<39;n++)ut[t][n]=1}var i=1,r=1;ut[i][r]=0,e.push(r+39*r);do{if(e.length){var o="";if(i+2>0&&i+2<38&&1==ut[i+2][r]&&(o+="S"),i-2>0&&i-2<38&&1==ut[i-2][r]&&(o+="N"),r-2>0&&r-2<38&&1==ut[i][r-2]&&(o+="W"),r+2>0&&r+2<38&&1==ut[i][r+2]&&(o+="E"),o){var a=Math.floor(Math.random()*o.length);switch(o[a]){case"N":ut[i-2][r]=0,ut[i-1][r]=0,i-=2;break;case"S":ut[i+2][r]=0,ut[i+1][r]=0,i+=2;break;case"W":ut[i][r-2]=0,ut[i][r-1]=0,r-=2;break;case"E":ut[i][r+2]=0,ut[i][r+1]=0,r+=2}e.push(r+39*i)}else{var s=e.pop();i=Math.floor(s/39),r=s%39}this.buildFinalMaze(i,r)}}while(e.length)}},{key:"buildFinalMaze",value:function(e,t){for(var n=0;n<39;n++)for(var i=0;i<39;i++)ht[i]||(ht[i]=[]),ht[i][n]=1===ut[n][i]?ft(n,i):0}},{key:"getRandomRoomEntities",value:function(){var e=[10,0,9],t=[9];do{var n=e.length-1,i=Math.floor(Math.random()*(n+1));t.push(e[i]),e.splice(i,1)}while(e.length>0);return t}},{key:"createRooms",value:function(){var e=this.getRandomRoomEntities();this.createRoom(1,1,3,e[0]),this.createRoom(1,35,3,e[1]),this.createRoom(35,35,3,e[2]),this.createRoom(35,1,3,e[3])}},{key:"createRoom",value:function(e,t,n,i){for(var r=t;r<t+n;r++)for(var o=e;o<e+n;o++)ht[o][r]=0;ht[e+Math.floor(n/2)][t+Math.floor(n/2)]=i}},{key:"createBarriers",value:function(){ht[1][Math.ceil(19.5)]=1,ht[1][Math.ceil(19.5)+1]=1,ht[37][Math.ceil(19.5)]=1,ht[37][Math.ceil(19.5)+1]=1,ht[Math.ceil(19.5)][1]=1,ht[Math.ceil(19.5)+1][1]=1,ht[Math.ceil(19.5)][37]=1,ht[Math.ceil(19.5)+1][37]=1}},{key:"addOneOfEachSwitchAtStart",value:function(){ht[4][1]=3,ht[4][3]=7,ht[2][4]=2}},{key:"getRandomMaze",value:function(e,t,n,i){return this.createMaze(),this.createRooms(),this.createBarriers(),this.addOneOfEachSwitchAtStart(),{width:t,height:e,spawnX:n,spawnY:i,pieces:ht}}}]),e}(),yt=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),pt=!1,dt=0,gt=function(e){function t(e,n,i){M(this,t);var r=_(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,i));return r.assets=Be.getAssets("creatures"),r.x=n,r.y=i,r.speed=160,r.bounds.x=14,r.bounds.y=24,r.bounds.width=36,r.bounds.height=39,r.type="player",r.clipping=!1,r.invincible=!1,r.superSpeed=!1,r.allCheats=!1,r}return T(t,e),yt(t,[{key:"tick",value:function(e){this.getInput(e),this.move(),this.superSpeed&&(this.move(),this.move()),this.handler.getGameCamera().centerOnEntity(this)}},{key:"render",value:function(e){e.myDrawImage(this.getCurrentAnimationFrame(),this.x-this.handler.getGameCamera().getxOffset(),this.y-this.handler.getGameCamera().getyOffset(),64,64)}},{key:"getInput",value:function(e){if(this.xMove=0,this.yMove=0,this.handler.getKeyManager().up&&(this.yMove=-this.speed*e),this.handler.getKeyManager().down&&(this.yMove=this.speed*e),this.handler.getKeyManager().left&&(this.xMove=-this.speed*e),this.handler.getKeyManager().right&&(this.xMove=this.speed*e),pt||dt++,dt>15||pt){if(pt=!0,dt=0,this.handler.getKeyManager().a){var t=this.allCheats?" ALL CHEATS disabled ":" ALL CHEATS enabled ";this.handler.devMessage(t),this.allCheats=!this.allCheats,this.clipping=this.allCheats,this.invincible=this.allCheats,this.superSpeed=this.allCheats,pt=!1}if(this.handler.getKeyManager().i){var n=this.invincible?" invincibility disabled ":" invincibility enabled ";this.handler.devMessage(n),this.invincible=!this.invincible,pt=!1}if(this.handler.getKeyManager().c){var i=this.clipping?" clipping disabled ":" clipping enabled ";this.handler.devMessage(i),this.clipping=!this.clipping,pt=!1}if(this.handler.getKeyManager().x){var r=this.superSpeed?" super speed disabled ":" super speed enabled ";this.handler.devMessage(r),this.superSpeed=!this.superSpeed,pt=!1}}}},{key:"getCurrentAnimationFrame",value:function(){return this.assets.playerDown}}]),t}(nt),vt=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),bt=function(){function e(t,n,i){E(this,e),this.width=parseInt(t/i),this.height=parseInt(n/i),this.size=i,this.grid=[];for(var r=0;r<=this.width;r++){this.grid[r]=[];for(var o=0;o<=this.height;o++)this.grid[r][o]=[]}}return vt(e,[{key:"insert",value:function(e,t){for(var n=Math.max(0,parseInt(e.x/this.size)),i=Math.max(0,parseInt(e.y/this.size)),r=Math.min(this.width,parseInt((e.x+e.width)/this.size)),o=Math.min(this.height,parseInt((e.y+e.height)/this.size)),a=i;a<=o;a++)for(var s=n;s<=r;s++)-1===this.grid[s][a].indexOf(t)&&this.grid[s][a].push(t)}},{key:"retrieve",value:function(e,t){for(var n=Math.max(0,parseInt(e.x/this.size)),i=Math.max(0,parseInt(e.y/this.size)),r=Math.min(this.width,parseInt((e.x+e.width)/this.size)),o=Math.min(this.height,parseInt((e.y+e.height)/this.size)),a=[],s=i;s<=o;s++)for(var u=n;u<=r;u++)this.grid[u][s].forEach(function(e){e!==t&&-1==a.indexOf(e)&&a.push(e)});return a}},{key:"remove",value:function(e,t){for(var n=Math.max(0,parseInt(e.x/this.size)),i=Math.max(0,parseInt(e.y/this.size)),r=Math.min(this.width,parseInt((e.x+e.width)/this.size)),o=Math.min(this.height,parseInt((e.y+e.height)/this.size)),a=i;a<=o;a++)for(var s=n;s<=r;s++)for(var u=0;u<this.grid[s][a].length;u++)this.grid[s][a][u]===t&&this.grid[s][a].splice(u,1)}},{key:"getWidth",value:function(){return this.width}},{key:"getHeight",value:function(){return this.height}},{key:"getSize",value:function(){return this.size}}]),e}(),wt=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),mt=function(){function e(t,n){j(this,e),this.isSolid=!1,this.texture=t,this.id=n,this.light=.6,this.assets=Be.getAssets("tiles")}return wt(e,[{key:"render",value:function(e,t,n){e.myDrawImage(this.texture,t,n,64,64)}},{key:"getId",value:function(){return this.id}}]),e}(),kt=function(e){function t(e){S(this,t);var n=C(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,Be.getAssets("tiles").exit,e));return n.isSolid=!0,n.type="exit",n}return P(t,e),t}(mt),Ot=function(e){function t(e){return I(this,t),W(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,Be.getAssets("tiles").path,e))}return R(t,e),t}(mt),xt=function(e){function t(e){return A(this,t),G(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,Be.getAssets("tiles").pathBlue,e))}return H(t,e),t}(mt),Mt=function(e){function t(e){return z(this,t),B(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,Be.getAssets("tiles").pathYellow,e))}return D(t,e),t}(mt),_t=function(e){function t(e){L(this,t);var n=Y(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,Be.getAssets("tiles").wall,e));return n.isSolid=!0,n}return F(t,e),t}(mt),Tt=function(e){function t(e){K(this,t);var n=N(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,Be.getAssets("tiles").wallBlue,e));return n.isSolid=!0,n}return U(t,e),t}(mt),Et=function(e){function t(e){X(this,t);var n=J(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,Be.getAssets("tiles").wallYellow,e));return n.isSolid=!0,n}return q(t,e),t}(mt),jt=function(e){function t(e){Q(this,t);var n=V(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,Be.getAssets("tiles").switchBlue,e));return n.isSolid=!0,n.type="switch",n.color="blue",n}return Z(t,e),t}(mt),St=function(e){function t(e){return $(this,t),ee(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,Be.getAssets("tiles").pathGreen,e))}return te(t,e),t}(mt),Ct=function(e){function t(e){ne(this,t);var n=ie(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,Be.getAssets("tiles").wallGreen,e));return n.isSolid=!0,n}return re(t,e),t}(mt),Pt=function(e){function t(e){oe(this,t);var n=ae(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,Be.getAssets("tiles").switchGreen,e));return n.isSolid=!0,n.type="switch",n.color="green",n}return se(t,e),t}(mt),It=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Wt=Be.getAssets("tiles"),Rt=[];Rt[0]=new Ot(0),Rt[1]=new _t(1),Rt[2]=new Et(2),Rt[3]=new Tt(3),Rt[4]=new Mt(4),Rt[5]=new xt(5),Rt[6]=new jt(6),Rt[7]=new St(7),Rt[8]=new Ct(8),Rt[9]=new Pt(9),Rt[10]=new kt(10);var At=function(){function e(){ue(this,e)}return It(e,null,[{key:"getAssets",value:function(){return Wt}},{key:"getTiles",value:function(){return Rt}}]),e}(),Gt=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Ht=function(){function e(t,n,i,r){he(this,e),this.handler=i,this.manager=r,this.x=t,this.y=n,this.init()}return Gt(e,[{key:"init",value:function(){this.expandLight()}},{key:"expandLight",value:function(){for(var e=-2;e<3;e++)for(var t=-2;t<3;t++)this.manager.lightMap[this.x+t][this.y+e]=Math.min(this.manager.lightMap[this.x+t][this.y+e],.65);for(var n=-1;n<2;n++)for(var i=-1;i<2;i++)this.manager.lightMap[this.x+i][this.y+n]=Math.min(this.manager.lightMap[this.x+i][this.y+n],.5);this.manager.lightMap[this.x][this.y]=.3}},{key:"tick",value:function(){}},{key:"render",value:function(e){var t=64*this.x-this.handler.getGameCamera().getxOffset(),n=64*this.y-this.handler.getGameCamera().getyOffset();e.fillStyle="yellow",e.fillRect(t+16,n+8,32,32),e.fillStyle="orange",e.fillRect(t+24,n+16,16,16),e.fillStyle="brown",e.fillRect(t+24,n+40,16,16)}}]),e}(),zt=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Bt=function(){function e(t){le(this,e),this.handler=t,this.sources=[],this.lightMap=[],this.init()}return zt(e,[{key:"init",value:function(){this.fillLightMap()}},{key:"fillLightMap",value:function(){for(var e=this.handler.getWorld().getWorldWidth(),t=this.handler.getWorld().getWorldHeight(),n=0;n<t;n++)for(var i=0;i<e;i++)this.lightMap[i]||(this.lightMap[i]=[]),this.lightMap[i][n]=.75}},{key:"tick",value:function(){}},{key:"render",value:function(e,t,n,i,r){this.sources.forEach(function(e){e.render(r)}),this.drawLightBlocks(e,t,n,i,r)}},{key:"drawLightBlocks",value:function(e,t,n,i,r){r.fillStyle="black";for(var o=n;o<i;o++)for(var a=e;a<t;a++){var s=this.handler.getWorld().getTile(a,o).type;r.globalAlpha="switch"===s||"exit"===s?.3:this.lightMap[a][o],r.fillRect(64*a-this.handler.getGameCamera().getxOffset(),64*o-this.handler.getGameCamera().getyOffset(),64,64)}r.globalAlpha=1}},{key:"addSource",value:function(e,t){this.sources.push(new Ht(e,t,this.handler,this))}},{key:"setLight",value:function(e,t,n){this.lightMap[e][t]=n}}]),e}(),Dt=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Lt=64,Yt=64,Ft=!1,Kt=0,Nt=60,Ut=function(){function e(t){fe(this,e),this.tiles=[],this.handler=t,t.setWorld(this),this.entityManager=new Pe(t,new gt(t,20,20)),this.lightManager=new Bt(t),this.spatialGrid=new bt(this.handler.getWidth()*Lt,this.handler.getHeight()*Yt,64),this.level=1,this.loadWorld(),this.init()}return Dt(e,[{key:"init",value:function(){this.lightManager.addSource(4,2),this.addRandomLightSources(20),this.setPlayerSpawn(this.spawnX,this.spawnY),this.populateEnemies(20)}},{key:"addRandomLightSources",value:function(e){for(var t=0;t<e;t++){var n=Math.floor(34*Math.random())+3,i=Math.floor(34*Math.random())+3;this.lightManager.addSource(n,i)}}},{key:"getWorldHeight",value:function(){return 39}},{key:"getWorldWidth",value:function(){return 39}},{key:"populateEnemies",value:function(e){this.entityManager.addEntity(new at(this.handler,3*Lt,3*Yt));for(var t=0;t<e;t++){var n=Math.floor(30*Math.random())+5,i=Math.floor(30*Math.random())+5;this.entityManager.addEntity(new at(this.handler,n*Lt,i*Yt))}}},{key:"setPlayerSpawn",value:function(e,t){this.entityManager.getPlayer().setX(e),this.entityManager.getPlayer().setY(t)}},{key:"loadWorld",value:function(){for(var e=this.fillWorld(39,39,1,1),t=0;t<this.height;t++)for(var n=0;n<this.width;n++)this.tiles[n]||(this.tiles[n]=[]),this.tiles[n][t]=e[n][t]}},{key:"fillWorld",value:function(e,t,n,i){var r=ct.getRandomMaze(e,t,n,i);return this.height=r.height,this.width=r.width,this.spawnX=r.spawnX*Lt,this.spawnY=r.spawnY*Yt,r.pieces}},{key:"swapGreenAndBlueTiles",value:function(e){Nt<60||("blue"===e?(this.swapTilesByID(5,3),this.swapTilesByID(8,7),this.swapTilesByID(6,9)):"green"===e&&(this.swapTilesByID(3,5),this.swapTilesByID(7,8),this.swapTilesByID(9,6)),Nt=0)}},{key:"getInput",value:function(){}},{key:"swapTilesByID",value:function(e,t){for(var n=1;n<this.height-1;n++)for(var i=1;i<this.width-1;i++)this.tiles[i][n]===e&&(this.tiles[i][n]=t)}},{key:"checkForWallSwap",value:function(){++Kt>120&&(Kt=0,Ft?this.swapTilesByID(4,2):this.swapTilesByID(2,4),Ft=!Ft)}},{key:"tick",value:function(e){this.getInput(),this.checkForWallSwap(),this.entityManager.tick(e),this.lightManager.tick(e),Nt++}},{key:"render",value:function(e){var t=parseInt(Math.max(0,this.handler.getGameCamera().getxOffset()/Lt)),n=parseInt(Math.min(this.width,(this.handler.getGameCamera().getxOffset()+this.handler.getWidth())/Lt+1)),i=parseInt(Math.max(0,this.handler.getGameCamera().getyOffset()/Yt)),r=parseInt(Math.min(this.height,(this.handler.getGameCamera().getyOffset()+this.handler.getHeight())/Yt+1));this.drawTiles(t,n,i,r,e),this.entityManager.render(e),this.lightManager.render(t,n,i,r,e)}},{key:"drawTiles",value:function(e,t,n,i,r){for(var o=n;o<i;o++)for(var a=e;a<t;a++)void 0!==this.getTile(a,o)&&this.getTile(a,o).render(r,a*Lt-this.handler.getGameCamera().getxOffset(),o*Yt-this.handler.getGameCamera().getyOffset())}},{key:"getTile",value:function(e,t){if(!(e<0||t<0))return At.getTiles()[this.tiles[e][t]]}},{key:"getWidth",value:function(){return this.width}},{key:"getHeight",value:function(){return this.height}},{key:"getEntityManager",value:function(){return this.entityManager}},{key:"getSpatialGrid",value:function(){return this.spatialGrid}}]),e}(),Xt=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Jt=function(){function e(t){ce(this,e),this.handler=t,this.world=new Ut(t)}return Xt(e,[{key:"tick",value:function(e){this.world.tick(e)}},{key:"render",value:function(e){this.world.render(e)}}]),e}(),qt=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Qt=function(){function e(t,n,i){ye(this,e),this.xOffset=n,this.yOffset=i,this.handler=t}return qt(e,[{key:"centerOnEntity",value:function(e){this.xOffset=e.getX()-this.handler.getWidth()/2+e.getWidth()/2,this.yOffset=e.getY()-this.handler.getHeight()/2+e.getHeight()/2,this.checkBlankSpace()}},{key:"slowCenterOnEntity",value:function(e){var t=this.xOffset,n=this.yOffset,i=e.getX()-this.handler.getWidth()/2+e.getWidth()/2,r=e.getY()-this.handler.getHeight()/2+e.getHeight()/2;n>r&&this.yOffset>r&&(this.yOffset-=5),r>n&&this.yOffset<r&&(this.yOffset+=5),t>i&&this.xOffset>i&&(this.xOffset-=5),i>t&&this.xOffset<i&&(this.xOffset+=5),this.checkBlankSpace()}},{key:"move",value:function(e,t){this.xOffset+=e,this.yOffset+=t,this.checkBlankSpace()}},{key:"getxOffset",value:function(){return parseInt(this.xOffset)}},{key:"getyOffset",value:function(){return parseInt(this.yOffset)}},{key:"setxOffset",value:function(e){this.xOffset=e}},{key:"setyOffset",value:function(e){this.yOffset=e}},{key:"checkBlankSpace",value:function(){this.xOffset<0?this.xOffset=0:this.xOffset>64*this.handler.getWorld().getWidth()-this.handler.getWidth()&&(this.xOffset=64*this.handler.getWorld().getWidth()-this.handler.getWidth()),this.yOffset<0?this.yOffset=0:this.yOffset>64*this.handler.getWorld().getHeight()-this.handler.getHeight()&&(this.yOffset=64*this.handler.getWorld().getHeight()-this.handler.getHeight())}}]),e}(),Vt=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Zt=function(){function e(t){pe(this,e),this.game=t,this.console=document.getElementById("console"),this.devMessage(" dev cheats initialized \n c - clipping \n i - invincibility \n x - super speed ")}return Vt(e,[{key:"devMessage",value:function(e){var t=["background: linear-gradient(#ffffff, #ff00ff)","border: 1px solid #3E0E02","color: black","display: block","line-height: 40px","text-align: center","font-size: 18px","font-weight: bold"].join(";");console.log("%c"+e,t)}},{key:"getWidth",value:function(){return this.game.getWidth()}},{key:"getHeight",value:function(){return this.game.getHeight()}},{key:"getKeyManager",value:function(){return this.game.getKeyManager()}},{key:"getGameCamera",value:function(){return this.game.getGameCamera()}},{key:"getWorld",value:function(){return this.world}},{key:"setWorld",value:function(e){this.world=e}},{key:"getGame",value:function(){return this.game}}]),e}(),$t=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),en=[],tn=function(){function e(){de(this,e)}return $t(e,[{key:"tick",value:function(){this.up=en[38],this.down=en[40],this.left=en[37],this.right=en[39],this.a=en[65],this.c=en[67],this.i=en[73],this.x=en[88],this.enter=en[13]}}]),e}();window.onkeydown=function(e){en[e.keyCode]=!0},window.onkeyup=function(e){en[e.keyCode]=!1};var nn=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),rn=function(e){function t(e){return ge(this,t),ve(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return be(t,e),nn(t,[{key:"render",value:function(e){if(e){var t=this.handler.getWidth(),n=this.handler.getHeight();e.fillStyle="black",e.fillRect(0,0,t,n),e.drawText({fillColor:"white",text:"you are",fontSize:32,font:"serif",x:90,y:n/4}),e.drawText({fillColor:"yellow",text:"A L O N E",fontSize:64,font:"serif",x:80,y:n/2}),e.drawText({fillColor:"white",text:"press enter",fontSize:32,font:"serif",x:210,y:n/1.4})}}},{key:"getInput",value:function(e){if(this.handler.getKeyManager().enter){var t=new Jt(this.handler);this.handler.getGame().getGameState().setState(t)}}},{key:"getCredits",value:function(){return["Programming: Matthew McCord","Artwork: http://www.opengameart.org/","    Player: Antifarea(PC)","    Tiles: Chris Hamons / Medicine Storm","    Tiles: Buch / Keith Karnage","    Music: OveMelaa","    Sound FX: artisticdude / OveMelaa","    Castle: Alucard","Thanks: Jamie Nichols // JS game engine","                         Youtube tutorial"]}},{key:"initSounds",value:function(){var e=new SoundManager;e.setSounds(),handlerRef.setSoundManager(e),soundsLoaded=!0,loadingText="up/down to select, enter or   /   button to choose",handlerRef.getSoundManager().play("evilLaugh")}},{key:"loadSounds",value:function(){loadingText="loading sounds...",sounds.load([CURRENT_PATH+"/res/sound/ItaloUnlimited.ogg",CURRENT_PATH+"/res/sound/explode.wav",CURRENT_PATH+"/res/sound/explode2.wav",CURRENT_PATH+"/res/sound/lvlup.ogg",CURRENT_PATH+"/res/sound/select.wav",CURRENT_PATH+"/res/sound/start.wav",CURRENT_PATH+"/res/sound/spawn.ogg",CURRENT_PATH+"/res/sound/evillaugh.ogg",CURRENT_PATH+"/res/sound/monster.wav",CURRENT_PATH+"/res/sound/sword.wav"])}}]),t}(Ke),on=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),an=function(){function e(t){we(this,e),this.currentState=null,this.handler=t}return on(e,[{key:"tick",value:function(e){throw"Every state needs a tick"}},{key:"render",value:function(e){throw"Every state needs a render"}},{key:"getState",value:function(){return this.currentState}},{key:"setState",value:function(e){this.currentState=e}}]),e}(),sn=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),un=!1,hn=void 0,ln=void 0,fn=void 0,cn=void 0,yn=void 0,pn=void 0,dn=void 0;new(function(){function e(t,n,i){me(this,e),this.height=i,this.title=t,this.width=n}return sn(e,[{key:"run",value:function(){var e=this;this.init();var t=0,n=0,i=Date.now(),r=Date.now(),o=0;!function a(){un&&(i=Date.now(),t=i-r,o+=t,r=i),o>=1e3/60&&(n=o/1e3,e.tick(n),e.render(),o=0),window.requestAnimationFrame(a)}()}},{key:"start",value:function(){un||(un=!0,this.run())}},{key:"getKeyManager",value:function(){return fn}},{key:"getDisplay",value:function(){return ln}},{key:"getWidth",value:function(){return this.width}},{key:"getHeight",value:function(){return this.height}},{key:"getGameCamera",value:function(){return yn}},{key:"getGameState",value:function(){return pn}},{key:"init",value:function(){cn=new Zt(this),ln=new xe(this.title,this.width,this.height),fn=new tn,hn=ln.getGraphics(),pn=new an,yn=new Qt(cn,0,0),dn=new rn(cn),pn.setState(dn)}},{key:"tick",value:function(e){fn.tick(),pn.getState()&&pn.getState().tick(e)}},{key:"render",value:function(){pn.getState()&&pn.getState().render(hn)}}]),e}())("Lost!",448,448).start();n(1)},function(e,t){}]);</script></body>

</html>

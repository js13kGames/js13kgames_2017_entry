<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
<style type="text/css">body,html{background-color:#000;height:100%;margin:0;padding:0;width:100%}#canvas{background-color:inherit;border-radius:235px;left:50%;margin:-224px 0 0 -224px;position:fixed;top:50%;z-index:100}</style></head>

<body>
  <canvas id="canvas"></canvas>
<script type="text/javascript">!function(t){function e(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var n={};e.m=t,e.c=n,e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function h(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function l(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function c(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function f(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function p(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function y(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function d(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function g(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function v(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function b(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function w(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function m(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function k(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function O(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function x(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function M(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function T(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function E(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function S(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function C(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function j(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function P(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function W(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function I(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function R(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function A(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function G(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function H(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function z(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function L(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function B(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function D(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Y(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function F(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function X(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function U(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function N(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function K(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function q(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function J(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function Q(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function V(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function Z(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function $(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tt(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function et(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function nt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function it(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function rt(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function ot(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function at(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function st(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function ht(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ut(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function lt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ct(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ft(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function pt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function yt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function dt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function gt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function vt(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function bt(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function wt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function mt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function kt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var Ot=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),xt=null,Mt=function(){function t(e,n,r){i(this,t),this.title=e,this.width=n,this.height=r,this.paused=!1,this.createDisplay()}return Ot(t,[{key:"createDisplay",value:function(){document.title=this.title;var t=document.getElementById("canvas");t.setAttribute("height",this.height),t.setAttribute("width",this.width),xt=t.getContext("2d"),xt.webkitImageSmoothingEnabled=!1,xt.mozImageSmoothingEnabled=!1,xt.imageSmoothingEnabled=!1,this.setEventListeners()}},{key:"setEventListeners",value:function(){window.onblur=this.pause,window.onfocus=this.unPause}},{key:"pause",value:function(){this.paused=!0}},{key:"unPause",value:function(){this.paused=!1}},{key:"getTitle",value:function(){return this.title}},{key:"getWidth",value:function(){return this.width}},{key:"getHeight",value:function(){return this.height}},{key:"getGraphics",value:function(){return xt}}]),t}();CanvasRenderingContext2D.prototype.myDrawImage=function(t,e,n,i,r){xt.drawImage(t.sheet,t.x,t.y,t.width,t.height,e,n,i,r)},CanvasRenderingContext2D.prototype.drawText=function(t){xt.font=t.fontSize+"px Arial",xt.fillStyle=t.fillColor,xt.strokeText(t.text,t.x,t.y),xt.fillText(t.text,t.x,t.y)};var Tt=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),_t=function(){function t(e,n,i,o){r(this,t),this.x=e,this.y=n,this.width=i,this.height=o}return Tt(t,[{key:"intersects",value:function(t){return this.x<t.x+t.width&&this.x+this.width>t.x&&this.y<t.y+t.height&&this.y+this.height>t.y}}]),t}(),Et=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),St=void 0,Ct=void 0,jt=void 0,Pt=function(t,e){var n=t.getY(),i=e.getY(),r=t.getHeight(),o=e.getHeight();return n+r===i+o?0:n+r<i+o?-1:1},Wt=function(){function t(e,n){o(this,t),St=e,Ct=n,jt=new Array(Ct)}return Et(t,[{key:"tick",value:function(t){jt.sort(Pt);for(var e=0;e<jt.length;e++){jt[e].tick(t)}}},{key:"render",value:function(t){jt.forEach(function(e){var n=e.handler.getWidth()+e.handler.getGameCamera().getxOffset(),i=e.handler.getHeight()+e.handler.getGameCamera().getyOffset(),r=e.handler.getGameCamera().getxOffset()-e.width,o=e.handler.getGameCamera().getyOffset()-e.height,a=!1;t.font="72px Arial",t.fillStyle="red",(e.x>n||e.y>i||e.x<r||e.y<o)&&(a=!0),a||e.render(t)},this)}},{key:"getPlayer",value:function(){return Ct}},{key:"getHandler",value:function(){return St}},{key:"getEntities",value:function(){return jt}},{key:"getSingleEntity",value:function(t){var e=void 0;return jt.forEach(function(n){n.type===t&&(e={type:n.type,x:n.x,y:n.y})}),e}},{key:"addEntity",value:function(t){jt.push(t),St.getWorld().getSpatialGrid().insert(new _t(t.x+t.bounds.x,t.y+t.bounds.y,t.bounds.width,t.bounds.height),t)}},{key:"removeEntity",value:function(t){for(var e=0;e<jt.length;e++){jt[e]===t&&jt.splice(e,1)}}},{key:"removeAllMonsters",value:function(){for(var t=0;t<jt.length;t++){"monster"===jt[t].type&&jt.splice(t,1)}}}]),t}(),It=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),Rt=function(){function t(){a(this,t)}return It(t,null,[{key:"loadImage",value:function(t){var e=new Image;return e.src=t,e}}]),t}(),At=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),Gt=function(){function t(e){s(this,t),this.sheet=e}return At(t,[{key:"crop",value:function(t,e,n,i){return{sheet:this.sheet,x:t,y:e,width:n,height:i}}}]),t}(),Ht=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),zt={},Lt=window.location.href+"/src/res/",Bt=function(){function t(e,n,i,r){h(this,t),zt[e]=this,this.name=e,this.path=n,this.width=i,this.height=r,this.sheet=new Gt(Rt.loadImage(this.path))}return Ht(t,[{key:"getWidth",value:function(){return 16}},{key:"getHeight",value:function(){return 16}}],[{key:"getAssets",value:function(t){return zt[t]}}]),t}(),Dt=function(t,e,n){return t.sheet.crop(16*e,16*n,16,16)},Yt=new Bt("tiles",Lt+"tiles_16x16_tiny.png",16,16);Yt.path=Dt(Yt,1,0),Yt.pathBlue=Dt(Yt,1,2),Yt.pathGreen=Dt(Yt,2,2),Yt.pathYellow=Dt(Yt,0,2),Yt.wall=Dt(Yt,0,0),Yt.wallBlue=Dt(Yt,1,1),Yt.wallGreen=Dt(Yt,2,1),Yt.wallYellow=Dt(Yt,0,1),Yt.switchBlue=Dt(Yt,2,0),Yt.switchGreen=Dt(Yt,3,0),Yt.exit=Dt(Yt,3,1);var Ft=new Bt("creatures",Lt+"player_16x16_tiny.png",16,16);Ft.playerDown=Dt(Ft,0,0),Ft.ghostDown=Dt(Ft,0,1);var Xt=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),Ut=function(){function t(e){u(this,t),this.handler=e,this.countSinceInput=0}return Xt(t,[{key:"tick",value:function(t){this.countSinceInput++,this.countSinceInput>8&&this.getInput(t),this.render()}},{key:"render",value:function(){alert("overwrite this menu render bro")}},{key:"getInput",value:function(){alert("overwrite this menu input bro")}}]),t}(),Nt=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),Kt=function(t){function e(t){return l(this,e),c(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return f(e,t),Nt(e,[{key:"render",value:function(t){if(t){var e=this.handler.getWidth(),n=this.handler.getHeight();t.fillStyle="black",t.fillRect(0,0,e,n);var i="You escaped the maze!",r=e/2-t.measureText(i).width/2,o=n/3;t.drawText({fillColor:"yellow",text:i,fontSize:32,font:"serif",x:r,y:o}),i="Press enter for another run!",r=e/2-t.measureText(i).width/2,o=n/1.5,t.drawText({fillColor:"white",text:i,fontSize:32,font:"serif",x:r,y:o})}}},{key:"getInput",value:function(){this.handler.getKeyManager().enter&&window.location.reload()}}]),e}(Ut),qt=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),Jt=function(t){function e(t){return p(this,e),y(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return d(e,t),qt(e,[{key:"render",value:function(t){if(t){var e=this.handler.getWidth(),n=this.handler.getHeight();t.fillStyle="black",t.fillRect(0,0,e,n);var i="Y O U   D I E D",r=e/2-t.measureText(i).width/2,o=n/3;t.drawText({fillColor:"red",text:i,fontSize:32,font:"serif",x:r,y:o}),i="press enter to try again",r=e/2-t.measureText(i).width/2,o=n/1.5,t.drawText({fillColor:"white",text:i,fontSize:32,font:"serif",x:r,y:o})}}},{key:"getInput",value:function(){this.handler.getKeyManager().enter&&window.location.reload()}}]),e}(Ut),Qt=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),Vt=function(){function t(e,n,i,r,o){g(this,t),this.x=n,this.y=i,this.width=r,this.height=o,this.handler=e,this.bounds=new _t(0,0,r,o),this.target=null}return Qt(t,[{key:"tick",value:function(t){throw"Entities must have a tick function!"}},{key:"render",value:function(t){throw"Entities must have a render function!"}},{key:"getX",value:function(){return this.x}},{key:"getY",value:function(){return this.y}},{key:"getWidth",value:function(){return this.width}},{key:"getHeight",value:function(){return this.height}},{key:"getCollisionBounds",value:function(t,e){return new _t(parseInt(this.x+this.bounds.x+t),parseInt(this.y+this.bounds.y+e),this.bounds.width,this.bounds.height)}},{key:"checkEntityCollisions",value:function(t,e){for(var n=this.handler.getWorld().getSpatialGrid().retrieve(new _t(this.x+this.bounds.x+t,this.y+this.bounds.y+e,this.bounds.width,this.bounds.height),this),i=0;i<n.length;i++){var r=n[i];if(r.getCollisionBounds(0,0).intersects(this.getCollisionBounds(t,e))){if("monster"===this.type&&"monster"===r.type)return!1;if("player"===this.type&&"monster"===r.type||"monster"===this.type&&"player"===r.type){if(this.invincible||r.invincible)return!1;var o=new Jt(this.handler);this.handler.getGame().getGameState().setState(o)}return!0}}return!1}},{key:"setX",value:function(t){this.x=t}},{key:"setY",value:function(t){this.y=t}},{key:"setWidth",value:function(t){this.width=t}},{key:"setHeight",value:function(t){this.height=t}}]),t}(),Zt=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),$t=120,te=200,ee=64,ne=64,ie=function(t){function e(t,n,i){v(this,e);var r=b(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,i,ee,ne));return r.health=te,r.speed=$t,r.xMove=0,r.yMove=0,r.init(),r}return w(e,t),Zt(e,[{key:"init",value:function(){}},{key:"move",value:function(){(Math.abs(this.xMove)>0||Math.abs(this.yMove)>0)&&(this.handler.getWorld().getSpatialGrid().remove(new _t(this.x+this.bounds.x,this.y+this.bounds.y,this.bounds.width,this.bounds.height),this),this.checkEntityCollisions(this.xMove,0)||this.moveX(),this.checkEntityCollisions(0,this.yMove)||this.moveY(),this.handler.getWorld().getSpatialGrid().insert(new _t(this.x+this.bounds.x,this.y+this.bounds.y,this.bounds.width,this.bounds.height),this))}},{key:"moveX",value:function(){if(this.clipping)return void(this.x+=this.xMove);var t=void 0;if(this.xMove>0){t=parseInt((this.x+this.xMove+this.bounds.x+this.bounds.width)/64);var e=parseInt((this.y+this.bounds.y)/64),n=parseInt((this.y+this.bounds.y+this.bounds.height)/64);this.collisionWithTile(t,e)||this.collisionWithTile(t,n)?(this.x=64*t-this.bounds.x-this.bounds.width-1,"player"===this.type&&this.checkForSwitchOrTrigger(e,n,t)):this.x+=this.xMove}else if(this.xMove<0){t=parseInt((this.x+this.xMove+this.bounds.x)/64);var i=parseInt((this.y+this.bounds.y)/64),r=parseInt((this.y+this.bounds.y+this.bounds.height)/64);this.collisionWithTile(t,i)||this.collisionWithTile(t,r)?(this.x=64*t+64-this.bounds.x,"player"===this.type&&this.checkForSwitchOrTrigger(i,r,t)):this.x+=this.xMove}}},{key:"moveY",value:function(){if(this.clipping)return void(this.y+=this.yMove);var t=void 0;if(this.yMove>0){t=parseInt((this.y+this.yMove+this.bounds.y+this.bounds.height)/64);var e=parseInt((this.x+this.bounds.x)/64),n=parseInt((this.x+this.bounds.x+this.bounds.width)/64);this.collisionWithTile(e,t)||this.collisionWithTile(n,t)?(this.y=64*t-this.bounds.y-this.bounds.height-1,this.checkForSwitchOrTrigger(e,n,t)):this.y+=this.yMove}else if(this.yMove<0){t=parseInt((this.y+this.yMove+this.bounds.y)/64);var i=parseInt((this.x+this.bounds.x)/64),r=parseInt((this.x+this.bounds.x+this.bounds.width)/64);this.collisionWithTile(i,t)||this.collisionWithTile(r,t)?(this.y=64*t+64-this.bounds.y,this.checkForSwitchOrTrigger(i,r,t)):this.y+=this.yMove}}},{key:"checkForSwitchOrTrigger",value:function(t,e,n){var i=this.handler.getWorld().getTile(t,n),r=this.handler.getWorld().getTile(e,n);if("switch"===i.type?this.handler.getWorld().swapGreenAndBlueTiles(i.color):"switch"===r.type&&this.handler.getWorld().swapGreenAndBlueTiles(r.color),"exit"===i.type||"exit"===r.type){if(this.handler.getWorld().level>=4){var o=new Kt(this.handler);this.handler.getGame().getGameState().setState(o)}this.handler.getWorld().changeLevel()}}},{key:"collisionWithTile",value:function(t,e){try{return this.handler.getWorld().getTile(t,e).isSolid}catch(t){}}},{key:"getHealth",value:function(){return this.health}},{key:"getSpeed",value:function(){return this.speed}},{key:"setHealth",value:function(t){this.health=t}},{key:"setSpeed",value:function(t){this.speed=t}}]),e}(Vt),re=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),oe=64,ae=64,se=function(t){function e(t,n,i){m(this,e);var r=k(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,i,oe,ae));return r.assets=Bt.getAssets("creatures"),r.x=n,r.y=i,r.spawnX=n,r.spawnY=i,r.bounds.x=10,r.bounds.y=10,r.bounds.width=oe-2*r.bounds.x,r.bounds.height=ae-2*r.bounds.y,r.type="monster",r.targetType="player",r.patrol=r.getPatrolPattern(),r.startX=n,r.startY=i,r.patrolLength=200,r.dirMoving=0,r.numberOfMoves=0,r}return O(e,t),re(e,[{key:"getPatrolPattern",value:function(){var t=["vertical","horizontal"];return t[Math.floor(Math.random()*t.length)]}},{key:"maybeChangePatrol",value:function(){Math.random()<.41&&(this.patrol="vertical"===this.patrol?"horizontal":"vertical")}},{key:"checkIfOffMap",value:function(){var t=this.handler.getWorld().getWorldWidth()*oe,e=this.handler.getWorld().getWorldHeight()*ae;(this.x<1||this.y<1||this.x>t||this.y>e)&&(this.x=this.spawnX,this.y=this.spawnY)}},{key:"setPatrolMovement",value:function(t){"vertical"===this.patrol?(0===this.dirMoving?this.yMove=-this.speed*t:this.yMove=this.speed*t,++this.numberOfMoves>this.patrolLength&&(this.dirMoving=0===this.dirMoving?1:0,this.numberOfMoves=0,this.maybeChangePatrol())):"horizontal"===this.patrol&&(0===this.dirMoving?this.xMove=-this.speed*t:this.xMove=this.speed*t,++this.numberOfMoves>this.patrolLength&&(this.dirMoving=0===this.dirMoving?1:0,this.numberOfMoves=0,this.maybeChangePatrol()))}},{key:"checkIfInWall",value:function(){var t=Math.round(this.x/oe),e=Math.round(this.y/ae);if(this.handler.getWorld().getTile(t,e).isSolid)for(var n=t-1,i=e-1,r=t+1,o=e+1,a=i;a<o;a++)for(var s=n;s<r;s++)if(!this.handler.getWorld().getTile(s,a).isSolid&&(s===t||a===e))return this.x=s*oe,void(this.y=a*ae)}},{key:"tick",value:function(t){this.checkIfOffMap(),this.checkIfInWall(),this.xMove=0,this.yMove=0,this.setPatrolMovement(t),this.move()}},{key:"render",value:function(t){t.myDrawImage(this.getCurrentAnimationFrame(),this.x-this.handler.getGameCamera().getxOffset(),this.y-this.handler.getGameCamera().getyOffset(),this.width,this.height)}},{key:"getInput",value:function(t){}},{key:"getCurrentAnimationFrame",value:function(){return this.assets.ghostDown}}]),e}(ie),he=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),ue=[],le=[],ce=[2,3,7],fe=0,pe=0,ye=function(t,e){return 0===t||0===e||t===fe-1||e===pe-1?1:Math.floor(20*Math.random())<15?1:ce[Math.floor(Math.random()*ce.length)]},de=function(){function t(){x(this,t)}return he(t,null,[{key:"createMaze",value:function(){for(var t=[],e=0;e<pe;e++){ue[e]=[];for(var n=0;n<fe;n++)ue[e][n]=1}var i=1,r=1;ue[i][r]=0,t.push(r+r*fe);do{if(t.length){var o="";if(i+2>0&&i+2<pe-1&&1==ue[i+2][r]&&(o+="S"),i-2>0&&i-2<pe-1&&1==ue[i-2][r]&&(o+="N"),r-2>0&&r-2<fe-1&&1==ue[i][r-2]&&(o+="W"),r+2>0&&r+2<fe-1&&1==ue[i][r+2]&&(o+="E"),o){var a=Math.floor(Math.random()*o.length);switch(o[a]){case"N":ue[i-2][r]=0,ue[i-1][r]=0,i-=2;break;case"S":ue[i+2][r]=0,ue[i+1][r]=0,i+=2;break;case"W":ue[i][r-2]=0,ue[i][r-1]=0,r-=2;break;case"E":ue[i][r+2]=0,ue[i][r+1]=0,r+=2}t.push(r+i*fe)}else{var s=t.pop();i=Math.floor(s/fe),r=s%fe}this.buildFinalMaze(i,r)}}while(t.length)}},{key:"buildFinalMaze",value:function(){for(var t=0;t<pe;t++)for(var e=0;e<fe;e++)le[e]||(le[e]=[]),le[e][t]=1===ue[t][e]?ye(t,e):0}},{key:"getRandomRoomEntities",value:function(){var t=[10,0,9],e=[9];do{var n=t.length-1,i=Math.floor(Math.random()*(n+1));e.push(t[i]),t.splice(i,1)}while(t.length>0);return e}},{key:"createRooms",value:function(){var t=this.getRandomRoomEntities();this.createRoom(1,1,3,t[0]),this.createRoom(1,pe-4,3,t[1]),this.createRoom(fe-4,pe-4,3,t[2]),this.createRoom(fe-4,1,3,t[3])}},{key:"createRoom",value:function(t,e,n,i){for(var r=e;r<e+n;r++)for(var o=t;o<t+n;o++)le[o][r]=0;le[t+Math.floor(n/2)][e+Math.floor(n/2)]=i}},{key:"createBarriers",value:function(t){2!==t&&(le[1][Math.ceil(pe/2)]=1,le[1][Math.ceil(pe/2)+1]=1,le[fe-2][Math.ceil(pe/2)]=1,le[fe-2][Math.ceil(pe/2)+1]=1,le[Math.ceil(fe/2)][1]=1,le[Math.ceil(fe/2)+1][1]=1,le[Math.ceil(fe/2)][pe-2]=1,le[Math.ceil(fe/2)+1][pe-2]=1)}},{key:"addOneOfEachSwitchAtStart",value:function(){le[4][1]=3,le[4][3]=7,le[2][4]=2}},{key:"getIntroMaze",value:function(){return[[1,1,1,1,1,1,1],[1,0,10,0,0,0,1],[1,0,0,1,0,0,1],[1,0,1,1,1,0,1],[1,0,0,1,0,0,1],[1,0,0,0,0,10,1],[1,1,1,1,1,1,1]]}},{key:"getRandomMaze",value:function(t,e,n){return 1===t?{mazeWidth:7,mazeHeight:7,spawnX:1,spawnY:1,pieces:this.getIntroMaze()}:(fe=pe=10*t-1,this.createMaze(),this.createRooms(),this.createBarriers(t),this.addOneOfEachSwitchAtStart(),{mazeWidth:fe,mazeHeight:pe,spawnX:e,spawnY:n,pieces:le})}}]),t}(),ge=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),ve=!1,be=0,we=function(t){function e(t,n,i){M(this,e);var r=T(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,i));return r.assets=Bt.getAssets("creatures"),r.x=n,r.y=i,r.speed=160,r.bounds.x=14,r.bounds.y=24,r.bounds.width=36,r.bounds.height=39,r.type="player",r.clipping=!1,r.invincible=!1,r.superSpeed=!1,r.allCheats=!1,r}return _(e,t),ge(e,[{key:"tick",value:function(t){this.getInput(t),this.move(),this.superSpeed&&(this.move(),this.move()),this.handler.getGameCamera().centerOnEntity(this)}},{key:"render",value:function(t){t.myDrawImage(this.getCurrentAnimationFrame(),this.x-this.handler.getGameCamera().getxOffset(),this.y-this.handler.getGameCamera().getyOffset(),64,64)}},{key:"getInput",value:function(t){this.xMove=0,this.yMove=0;var e=this.handler.getKeyManager();if((e.up||e.w||e.z)&&(this.yMove=-this.speed*t),(e.down||e.s)&&(this.yMove=this.speed*t),(e.left||e.a||e.q)&&(this.xMove=-this.speed*t),(e.right||e.d)&&(this.xMove=this.speed*t),ve||be++,be>15||ve){if(ve=!0,be=0,e.one){var n=this.allCheats?" ALL CHEATS disabled ":" ALL CHEATS enabled ";this.handler.devMessage(n),this.allCheats=!this.allCheats,this.clipping=this.allCheats,this.invincible=this.allCheats,this.superSpeed=this.allCheats,ve=!1}if(e.three){var i=this.invincible?" invincibility disabled ":" invincibility enabled ";this.handler.devMessage(i),this.invincible=!this.invincible,ve=!1}if(e.two){var r=this.clipping?" clipping disabled ":" clipping enabled ";this.handler.devMessage(r),this.clipping=!this.clipping,ve=!1}if(e.four){var o=this.superSpeed?" super speed disabled ":" super speed enabled ";this.handler.devMessage(o),this.superSpeed=!this.superSpeed,ve=!1}}}},{key:"getCurrentAnimationFrame",value:function(){return this.assets.playerDown}}]),e}(ie),me=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),ke=function(){function t(e,n,i){E(this,t),this.width=parseInt(e/i),this.height=parseInt(n/i),this.size=i,this.grid=[];for(var r=0;r<=this.width;r++){this.grid[r]=[];for(var o=0;o<=this.height;o++)this.grid[r][o]=[]}}return me(t,[{key:"insert",value:function(t,e){for(var n=Math.max(0,parseInt(t.x/this.size)),i=Math.max(0,parseInt(t.y/this.size)),r=Math.min(this.width,parseInt((t.x+t.width)/this.size)),o=Math.min(this.height,parseInt((t.y+t.height)/this.size)),a=i;a<=o;a++)for(var s=n;s<=r;s++)-1===this.grid[s][a].indexOf(e)&&this.grid[s][a].push(e)}},{key:"retrieve",value:function(t,e){for(var n=Math.max(0,parseInt(t.x/this.size)),i=Math.max(0,parseInt(t.y/this.size)),r=Math.min(this.width,parseInt((t.x+t.width)/this.size)),o=Math.min(this.height,parseInt((t.y+t.height)/this.size)),a=[],s=i;s<=o;s++)for(var h=n;h<=r;h++)this.grid[h][s].forEach(function(t){t!==e&&-1==a.indexOf(t)&&a.push(t)});return a}},{key:"remove",value:function(t,e){for(var n=Math.max(0,parseInt(t.x/this.size)),i=Math.max(0,parseInt(t.y/this.size)),r=Math.min(this.width,parseInt((t.x+t.width)/this.size)),o=Math.min(this.height,parseInt((t.y+t.height)/this.size)),a=i;a<=o;a++)for(var s=n;s<=r;s++)for(var h=0;h<this.grid[s][a].length;h++)this.grid[s][a][h]===e&&this.grid[s][a].splice(h,1)}},{key:"getWidth",value:function(){return this.width}},{key:"getHeight",value:function(){return this.height}},{key:"getSize",value:function(){return this.size}}]),t}(),Oe=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),xe=function(){function t(e,n){S(this,t),this.isSolid=!1,this.texture=e,this.id=n,this.light=.6,this.assets=Bt.getAssets("tiles")}return Oe(t,[{key:"render",value:function(t,e,n){t.myDrawImage(this.texture,e,n,64,64)}},{key:"getId",value:function(){return this.id}}]),t}(),Me=function(t){function e(t){C(this,e);var n=j(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,Bt.getAssets("tiles").exit,t));return n.isSolid=!0,n.type="exit",n}return P(e,t),e}(xe),Te=function(t){function e(t){return W(this,e),I(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,Bt.getAssets("tiles").path,t))}return R(e,t),e}(xe),_e=function(t){function e(t){return A(this,e),G(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,Bt.getAssets("tiles").pathBlue,t))}return H(e,t),e}(xe),Ee=function(t){function e(t){return z(this,e),L(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,Bt.getAssets("tiles").pathYellow,t))}return B(e,t),e}(xe),Se=function(t){function e(t){D(this,e);var n=Y(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,Bt.getAssets("tiles").wall,t));return n.isSolid=!0,n}return F(e,t),e}(xe),Ce=function(t){function e(t){X(this,e);var n=U(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,Bt.getAssets("tiles").wallBlue,t));return n.isSolid=!0,n}return N(e,t),e}(xe),je=function(t){function e(t){K(this,e);var n=q(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,Bt.getAssets("tiles").wallYellow,t));return n.isSolid=!0,n}return J(e,t),e}(xe),Pe=function(t){function e(t){Q(this,e);var n=V(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,Bt.getAssets("tiles").switchBlue,t));return n.isSolid=!0,n.type="switch",n.color="blue",n}return Z(e,t),e}(xe),We=function(t){function e(t){return $(this,e),tt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,Bt.getAssets("tiles").pathGreen,t))}return et(e,t),e}(xe),Ie=function(t){function e(t){nt(this,e);var n=it(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,Bt.getAssets("tiles").wallGreen,t));return n.isSolid=!0,n}return rt(e,t),e}(xe),Re=function(t){function e(t){ot(this,e);var n=at(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,Bt.getAssets("tiles").switchGreen,t));return n.isSolid=!0,n.type="switch",n.color="green",n}return st(e,t),e}(xe),Ae=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),Ge=Bt.getAssets("tiles"),He=[];He[0]=new Te(0),He[1]=new Se(1),He[2]=new je(2),He[3]=new Ce(3),He[4]=new Ee(4),He[5]=new _e(5),He[6]=new Pe(6),He[7]=new We(7),He[8]=new Ie(8),He[9]=new Re(9),He[10]=new Me(10);var ze=function(){function t(){ht(this,t)}return Ae(t,null,[{key:"getAssets",value:function(){return Ge}},{key:"getTiles",value:function(){return He}}]),t}(),Le=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),Be=function(){function t(e,n,i,r){ut(this,t),this.handler=i,this.manager=r,this.x=e,this.y=n,this.flickering=!1,this.lastFlickerCounter=0,this.flickerToggle=0,this.flickerCount=0,this.flickerTimes=0,this.flickerLength=0,this.init()}return Le(t,[{key:"init",value:function(){this.makeSureOnWall(),this.expandLight()}},{key:"makeSureOnWall",value:function(){var t=this.x,e=this.y;if(!this.handler.getWorld().getTile(t,e).isSolid)for(var n=e-1;n<e+1;n++)for(var i=t-1;i<t+1;i++)if(1===this.handler.getWorld().getTile(i,n).id)return this.x=i,void(this.y=n)}},{key:"expandLight",value:function(){for(var t=-2;t<3;t++)for(var e=-2;e<3;e++)this.manager.lightMap[this.x+e][this.y+t]=Math.min(this.manager.lightMap[this.x+e][this.y+t],.65);for(var n=-1;n<2;n++)for(var i=-1;i<2;i++)this.manager.lightMap[this.x+i][this.y+n]=Math.min(this.manager.lightMap[this.x+i][this.y+n],.5);this.manager.lightMap[this.x][this.y]=.3}},{key:"dimLights",value:function(t){for(var e=-2;e<3;e++)for(var n=-2;n<3;n++)this.manager.lightMap[this.x+n][this.y+e]=Math.min(.75,.65+t);for(var i=-1;i<2;i++)for(var r=-1;r<2;r++)this.manager.lightMap[this.x+r][this.y+i]=Math.min(.75,.5+t);this.manager.lightMap[this.x][this.y]=Math.min(.75,.3+t)}},{key:"chanceToFlicker",value:function(){Math.random()<.85||(this.lastFlickerCounter=0,this.flickerLength=Math.floor(5*Math.random())+4,this.flickering=!0)}},{key:"flickerLights",value:function(){0===this.flickerCount&&(0===this.flickerToggle?(this.dimLights(.25),this.flickerToggle=1):(this.expandLight(),this.flickerToggle=0)),this.flickerCount++,this.flickerCount>=this.flickerLength&&(this.flickerCount=0,this.flickerTimes++),this.flickerTimes>=6&&(this.flickerTimes=0,this.flickering=!1)}},{key:"tick",value:function(){this.flickering?this.flickerLights():++this.lastFlickerCounter>240&&this.chanceToFlicker()}},{key:"render",value:function(t){var e=64*this.x-this.handler.getGameCamera().getxOffset(),n=64*this.y-this.handler.getGameCamera().getyOffset();t.fillStyle="orange",t.fillRect(e+16,n+8,32,32),t.fillStyle="yellow",t.fillRect(e+24,n+16,16,16),t.fillStyle="brown",t.fillRect(e+24,n+38,16,16)}}]),t}(),De=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),Ye=function(){function t(e){lt(this,t),this.handler=e,this.init()}return De(t,[{key:"init",value:function(){this.sources=[],this.lightMap=[],this.fillLightMap()}},{key:"fillLightMap",value:function(){for(var t=this.handler.getWorld().getWorldWidth(),e=this.handler.getWorld().getWorldHeight(),n=0;n<e;n++)for(var i=0;i<t;i++)this.lightMap[i]||(this.lightMap[i]=[]),this.lightMap[i][n]=.85}},{key:"tick",value:function(){this.sources.forEach(function(t){t.tick()})}},{key:"render",value:function(t,e,n,i,r){this.sources.forEach(function(t){t.render(r)}),this.drawLightBlocks(t,e,n,i,r)}},{key:"drawLightBlocks",value:function(t,e,n,i,r){r.fillStyle="black";for(var o=n;o<i;o++)for(var a=t;a<e;a++){var s=this.handler.getWorld().getTile(a,o).type;r.globalAlpha="switch"===s||"exit"===s?.3:this.lightMap[a][o],r.fillRect(64*a-this.handler.getGameCamera().getxOffset(),64*o-this.handler.getGameCamera().getyOffset(),64,64)}r.globalAlpha=1}},{key:"addSource",value:function(t,e){this.sources.push(new Be(t,e,this.handler,this))}},{key:"setLight",value:function(t,e,n){this.lightMap[t][e]=n}}]),t}(),Fe=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),Xe=64,Ue=64,Ne=!1,Ke=0,qe=60,Je=function(){function t(e){ct(this,t),this.width=null,this.height=null,this.tiles=[],this.handler=e,e.setWorld(this),this.entityManager=new Wt(e,new we(e,20,20)),this.spatialGrid=new ke(this.handler.getWidth()*Xe,this.handler.getHeight()*Ue,64),this.level=1,this.loadWorld(),this.lightManager=new Ye(e),this.init()}return Fe(t,[{key:"changeLevel",value:function(){this.setPlayerSpawn(this.spawnX,this.spawnY),this.level+=1,this.tiles=[],this.loadWorld(),this.init()}},{key:"init",value:function(){this.setPlayerSpawn(this.spawnX,this.spawnY),this.lightManager.init(),this.lightManager.fillLightMap(),1===this.level?this.lightManager.addSource(3,3):(this.addEvenSpreadOfLightSources(7),this.addEvenSpreadOfMonsters(8))}},{key:"addEvenSpreadOfLightSources",value:function(t){for(var e=t;e<=this.height;e+=t)for(var n=t;n<=this.width;n+=t)this.height-e>2&&this.width-n>2&&(console.log("adding at "+n+", "+e),this.lightManager.addSource(n,e))}},{key:"getWorldHeight",value:function(){return this.height}},{key:"getWorldWidth",value:function(){return this.width}},{key:"addEvenSpreadOfMonsters",value:function(t){for(var e=t;e<=this.height;e+=t)for(var n=t;n<=this.width;n+=t)this.height-e>2&&this.width-n>2&&this.entityManager.addEntity(new se(this.handler,n*Xe,e*Xe))}},{key:"setPlayerSpawn",value:function(t,e){this.entityManager.getPlayer().setX(t),this.entityManager.getPlayer().setY(e)}},{key:"loadWorld",value:function(){for(var t=this.fillWorld(this.level,1,1),e=0;e<this.height;e++)for(var n=0;n<this.width;n++)this.tiles[n]||(this.tiles[n]=[]),this.tiles[n][e]=t[n][e]}},{key:"fillWorld",value:function(t,e,n){var i=de.getRandomMaze(t,e,n);return this.height=i.mazeHeight,this.width=i.mazeWidth,this.spawnX=i.spawnX*Xe,this.spawnY=i.spawnY*Ue,i.pieces}},{key:"swapGreenAndBlueTiles",value:function(t){qe<30||("blue"===t?(this.swapTilesByID(5,3),this.swapTilesByID(8,7),this.swapTilesByID(6,9)):"green"===t&&(this.swapTilesByID(3,5),this.swapTilesByID(7,8),this.swapTilesByID(9,6)),qe=0)}},{key:"getInput",value:function(){}},{key:"swapTilesByID",value:function(t,e){for(var n=1;n<this.height;n++)for(var i=1;i<this.width;i++)this.tiles[i][n]===t&&(this.tiles[i][n]=e)}},{key:"checkForWallSwap",value:function(){++Ke>180&&(Ke=0,Ne?this.swapTilesByID(4,2):this.swapTilesByID(2,4),Ne=!Ne)}},{key:"tick",value:function(t){this.getInput(),this.checkForWallSwap(),this.entityManager.tick(t),this.lightManager.tick(t),qe++}},{key:"render",value:function(t){var e=parseInt(Math.max(0,this.handler.getGameCamera().getxOffset()/Xe)),n=parseInt(Math.min(this.width,(this.handler.getGameCamera().getxOffset()+this.handler.getWidth())/Xe+1)),i=parseInt(Math.max(0,this.handler.getGameCamera().getyOffset()/Ue)),r=parseInt(Math.min(this.height,(this.handler.getGameCamera().getyOffset()+this.handler.getHeight())/Ue+1));this.drawTiles(e,n,i,r,t),this.entityManager.render(t),this.lightManager.render(e,n,i,r,t)}},{key:"drawTiles",value:function(t,e,n,i,r){for(var o=n;o<i;o++)for(var a=t;a<e;a++)void 0!==this.getTile(a,o)&&this.getTile(a,o).render(r,a*Xe-this.handler.getGameCamera().getxOffset(),o*Ue-this.handler.getGameCamera().getyOffset())}},{key:"getTile",value:function(t,e){try{return ze.getTiles()[this.tiles[t][e]]}catch(t){}}},{key:"getWidth",value:function(){return this.width}},{key:"getHeight",value:function(){return this.height}},{key:"getEntityManager",value:function(){return this.entityManager}},{key:"getSpatialGrid",value:function(){return this.spatialGrid}}]),t}(),Qe=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),Ve=function(){function t(e){ft(this,t),this.handler=e,this.world=new Je(e)}return Qe(t,[{key:"tick",value:function(t){this.world.tick(t)}},{key:"render",value:function(t){this.world.render(t)}}]),t}(),Ze=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),$e=function(){function t(e,n,i){pt(this,t),this.xOffset=n,this.yOffset=i,this.handler=e}return Ze(t,[{key:"centerOnEntity",value:function(t){this.xOffset=t.getX()-this.handler.getWidth()/2+t.getWidth()/2,this.yOffset=t.getY()-this.handler.getHeight()/2+t.getHeight()/2,this.checkBlankSpace()}},{key:"slowCenterOnEntity",value:function(t){var e=this.xOffset,n=this.yOffset,i=t.getX()-this.handler.getWidth()/2+t.getWidth()/2,r=t.getY()-this.handler.getHeight()/2+t.getHeight()/2;n>r&&this.yOffset>r&&(this.yOffset-=5),r>n&&this.yOffset<r&&(this.yOffset+=5),e>i&&this.xOffset>i&&(this.xOffset-=5),i>e&&this.xOffset<i&&(this.xOffset+=5),this.checkBlankSpace()}},{key:"move",value:function(t,e){this.xOffset+=t,this.yOffset+=e,this.checkBlankSpace()}},{key:"getxOffset",value:function(){return parseInt(this.xOffset)}},{key:"getyOffset",value:function(){return parseInt(this.yOffset)}},{key:"setxOffset",value:function(t){this.xOffset=t}},{key:"setyOffset",value:function(t){this.yOffset=t}},{key:"checkBlankSpace",value:function(){this.xOffset<0?this.xOffset=0:this.xOffset>64*this.handler.getWorld().getWidth()-this.handler.getWidth()&&(this.xOffset=64*this.handler.getWorld().getWidth()-this.handler.getWidth()),this.yOffset<0?this.yOffset=0:this.yOffset>64*this.handler.getWorld().getHeight()-this.handler.getHeight()&&(this.yOffset=64*this.handler.getWorld().getHeight()-this.handler.getHeight())}}]),t}(),tn=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),en=function(){function t(e){yt(this,t),this.game=e,this.console=document.getElementById("console"),this.devMessage(" dev cheats initialized \n 2 - clipping \n 3 - invincibility \n 4 - super speed \n 1 - all cheats ")}return tn(t,[{key:"devMessage",value:function(t){var e=["background: linear-gradient(#ffffff, #ff00ff)","border: 1px solid #3E0E02","color: black","display: block","line-height: 40px","text-align: center","font-size: 18px","font-weight: bold"].join(";");console.log("%c"+t,e)}},{key:"getWidth",value:function(){return this.game.getWidth()}},{key:"getHeight",value:function(){return this.game.getHeight()}},{key:"getKeyManager",value:function(){return this.game.getKeyManager()}},{key:"getGameCamera",value:function(){return this.game.getGameCamera()}},{key:"getWorld",value:function(){return this.world}},{key:"setWorld",value:function(t){this.world=t}},{key:"getGame",value:function(){return this.game}}]),t}(),nn=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),rn=[],on=function(){function t(){dt(this,t)}return nn(t,[{key:"tick",value:function(){this.up=rn[38],this.down=rn[40],this.left=rn[37],this.right=rn[39],this.one=rn[49],this.two=rn[50],this.three=rn[51],this.four=rn[52],this.a=rn[65],this.w=rn[87],this.s=rn[83],this.d=rn[68],this.z=rn[90],this.q=rn[81],this.enter=rn[13]}}]),t}();window.onkeydown=function(t){rn[t.keyCode]=!0},window.onkeyup=function(t){rn[t.keyCode]=!1};var an=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),sn=(function(t){function e(t){return gt(this,e),vt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}bt(e,t),an(e,[{key:"render",value:function(t){if(t){var e=this.handler.getWidth(),n=this.handler.getHeight();t.fillStyle="black",t.fillRect(0,0,e,n),t.drawText({fillColor:"white",text:"you are",fontSize:32,font:"serif",x:90,y:n/4}),t.drawText({fillColor:"yellow",text:"A L O N E",fontSize:64,font:"serif",x:80,y:n/2}),t.drawText({fillColor:"white",text:"press enter",fontSize:32,font:"serif",x:210,y:n/1.4})}}},{key:"getInput",value:function(t){if(this.handler.getKeyManager().enter){var e=new Ve(this.handler);this.handler.getGame().getGameState().setState(e)}}},{key:"getCredits",value:function(){return["Programming: Matthew McCord","Artwork: http://www.opengameart.org/","    Player: Antifarea(PC)","    Tiles: Chris Hamons / Medicine Storm","    Tiles: Buch / Keith Karnage","    Music: OveMelaa","    Sound FX: artisticdude / OveMelaa","    Castle: Alucard","Thanks: Jamie Nichols // JS game engine","                         Youtube tutorial"]}},{key:"initSounds",value:function(){var t=new SoundManager;t.setSounds(),handlerRef.setSoundManager(t),soundsLoaded=!0,loadingText="up/down to select, enter or   /   button to choose",handlerRef.getSoundManager().play("evilLaugh")}},{key:"loadSounds",value:function(){loadingText="loading sounds...",sounds.load([CURRENT_PATH+"/res/sound/ItaloUnlimited.ogg",CURRENT_PATH+"/res/sound/explode.wav",CURRENT_PATH+"/res/sound/explode2.wav",CURRENT_PATH+"/res/sound/lvlup.ogg",CURRENT_PATH+"/res/sound/select.wav",CURRENT_PATH+"/res/sound/start.wav",CURRENT_PATH+"/res/sound/spawn.ogg",CURRENT_PATH+"/res/sound/evillaugh.ogg",CURRENT_PATH+"/res/sound/monster.wav",CURRENT_PATH+"/res/sound/sword.wav"])}}])}(Ut),function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}()),hn=function(){function t(e){wt(this,t),this.currentState=null,this.handler=e}return sn(t,[{key:"tick",value:function(t){throw"Every state needs a tick"}},{key:"render",value:function(t){throw"Every state needs a render"}},{key:"getState",value:function(){return this.currentState}},{key:"setState",value:function(t){this.currentState=t}}]),t}(),un=function(){var t,e,n,i,r,o=function(t){return Math.sin(6.283184*t)},a=function(t){return t%1*2-1},s=function(t){return t%1<.5?1:-1},h=function(t){var e=t%1*4;return e<2?e-1:3-e},u=function(t){return.003959503758*Math.pow(2,(t-128)/12)},l=function(t,e,n){var i,r,o,a,s,h,l,f=c[t.i[0]],p=t.i[1],y=t.i[3],d=c[t.i[4]],g=t.i[5],v=t.i[8],b=t.i[9],w=t.i[10]*t.i[10]*4,m=t.i[11]*t.i[11]*4,k=t.i[12]*t.i[12]*4,O=1/k,x=t.i[13],M=n*Math.pow(2,2-t.i[14]),T=new Int32Array(w+m+k),_=0,E=0;for(i=0,r=0;i<w+m+k;i++,r++)r>=0&&(x=x>>8|(255&x)<<4,r-=M,h=u(e+(15&x)+t.i[2]-128),l=u(e+(15&x)+t.i[6]-128)*(1+8e-4*t.i[7])),o=1,i<w?o=i/w:i>=w+m&&(o-=(i-w-m)*O),a=h,y&&(a*=o*o),_+=a,s=f(_)*p,a=l,v&&(a*=o*o),E+=a,s+=d(E)*g,b&&(s+=(2*Math.random()-1)*b),T[i]=80*s*o|0;return T},c=[o,s,a,h];this.init=function(o){t=o,e=o.endPattern-2,n=0,i=o.rowLen*o.patternLen*(e+1)*2,r=new Int32Array(i)},this.generate=function(){var a,s,h,u,f,p,y,d,g,v,b,w,m,k,O=new Int32Array(i),x=t.songData[n],M=t.rowLen,T=t.patternLen,_=0,E=0,S=!1,C=[];for(h=0;h<=e;++h)for(y=x.p[h],u=0;u<T;++u){var j=y?x.c[y-1].f[u]:0;j&&(x.i[j-1]=x.c[y-1].f[u+T]||0,j<16&&(C=[]));var P=c[x.i[15]],W=x.i[16]/512,I=Math.pow(2,x.i[17]-9)/M,R=x.i[18],A=x.i[19],G=43.23529*x.i[20]*3.141592/44100,H=1-x.i[21]/255,z=1e-5*x.i[22],L=x.i[23]/32,B=x.i[24]/512,D=6.283184*Math.pow(2,x.i[25]-9)/M,Y=x.i[26]/255,F=x.i[27]*M;for(b=(h*T+u)*M,f=0;f<4;++f)if(p=y?x.c[y-1].n[u+f*T]:0){C[p]||(C[p]=l(x,p,M));var X=C[p];for(s=0,a=2*b;s<X.length;s++,a+=2)O[a]+=X[s]}for(s=0;s<M;s++)d=2*(b+s),v=O[d],v||S?(w=G,R&&(w*=P(I*d)*W+.5),w=1.5*Math.sin(w),_+=w*E,m=H*(v-E)-_,E+=w*m,v=3==A?E:1==A?m:_,z&&(v*=z,v=v<1?v>-1?o(.25*v):-1:1,v/=z),v*=L,S=v*v>1e-5,g=Math.sin(D*d)*B+.5,k=v*(1-g),v*=g):k=0,d>=F&&(k+=O[d-F+1]*Y,v+=O[d-F]*Y),O[d]=0|k,O[d+1]=0|v,r[d]+=0|k,r[d+1]+=0|v}return++n/8},this.createWave=function(){var t=44+2*i-8,e=t-36,n=new Uint8Array(44+2*i);n.set([82,73,70,70,255&t,t>>8&255,t>>16&255,t>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&e,e>>8&255,e>>16&255,e>>24&255]);for(var o=0,a=44;o<i;++o){var s=r[o];s=s<-32767?-32767:s>32767?32767:s,n[a++]=255&s,n[a++]=s>>8&255}return n},this.getData=function(t,e){for(var n=2*Math.floor(44100*t),i=new Array(e),o=0;o<2*e;o+=1){var a=n+o;i[o]=t>0&&a<r.length?r[a]/32768:0}return i}},ln=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),cn=(function(){function t(){mt(this,t),this.bgMusic={songData:[{i:[3,59,140,0,1,60,128,3,0,29,92,28,95,0,0,3,96,2,1,2,124,135,11,25,130,4,97,2],p:[1],c:[{n:[112,,,,114,,,,117,,,,114,,,,112,,,,114,,,,117,,,,114,,,,141,,,,,,,,,,,,,,,,138],f:[]}]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]}],rowLen:22050,patternLen:32,endPattern:2},this.loaded=!1,this.lastTime=0,this.logged=0}ln(t,[{key:"init",value:function(){var t=new un;t.init(this.bgMusic);var e=!1;setInterval(function(){if(!e&&(e=t.generate()>=1)){var n=t.createWave(),i=document.createElement("audio");i.src=URL.createObjectURL(new Blob([n],{type:"audio/wav"})),i.play(),i.volume=.3,setInterval(function(){var e=i.currentTime;t.getData(e,300)&&0===this.logged&&this.logged++,e<=this.lastTime&&0!==e&&0!==this.lastTime&&i.play(),this.lastTime=e},16)}},0)}},{key:"tick",value:function(){}},{key:"render",value:function(){}}])}(),function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}()),fn=!1,pn=void 0,yn=void 0,dn=void 0,gn=void 0,vn=void 0,bn=void 0,wn=void 0;new(function(){function t(e,n,i){kt(this,t),this.height=i,this.title=e,this.width=n}return cn(t,[{key:"run",value:function(){var t=this;this.init();var e=0,n=0,i=Date.now(),r=Date.now(),o=0;!function a(){fn&&(i=Date.now(),e=i-r,o+=e,r=i),o>=1e3/60&&(n=o/1e3,t.tick(n),t.render(),o=0),window.requestAnimationFrame(a)}()}},{key:"start",value:function(){fn||(fn=!0,this.run())}},{key:"getSoundManager",value:function(){}},{key:"getKeyManager",value:function(){return dn}},{key:"getDisplay",value:function(){return yn}},{key:"getWidth",value:function(){return this.width}},{key:"getHeight",value:function(){return this.height}},{key:"getGameCamera",value:function(){return vn}},{key:"getGameState",value:function(){return bn}},{key:"init",value:function(){gn=new en(this),yn=new Mt(this.title,this.width,this.height),dn=new on,pn=yn.getGraphics(),bn=new hn,vn=new $e(gn,0,0),wn=new Ve(gn),bn.setState(wn)}},{key:"tick",value:function(t){dn.tick(),bn.getState()&&!yn.paused&&bn.getState().tick(t)}},{key:"render",value:function(){bn.getState()&&!yn.paused&&bn.getState().render(pn)}}]),t}())("Lost!",448,448).start();n(1)},function(t,e){}]);</script></body>

</html>

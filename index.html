<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
<style type="text/css">body,html{background-color:#000;height:100%;margin:0;padding:0;width:100%}#canvas{background-color:inherit;border-radius:235px;margin:50px 0 0 -224px}#canvas,.speech{left:50%;position:fixed;z-index:100}.speech{font-family:Arial,"serif";line-height:36px;font-size:24px;padding:0;top:408px}#dialogue{color:#fff;height:324px;margin:112px 0 0 -190px;width:600px}#speaker{color:#ff0;height:50px;margin:112px 0 0 -425px;text-align:right;width:200px}</style></head>

<body>
    <canvas id="canvas"></canvas>

    <div id="dialogue" class="speech"></div>

    <div id="speaker" class="speech"></div>
<script type="text/javascript">!function(e){function t(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function p(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function y(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function g(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function b(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function v(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function w(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function m(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function k(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function O(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function x(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function T(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function j(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function M(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function E(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function P(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function S(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function C(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function I(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function W(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function L(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function R(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function H(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function G(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function A(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function z(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function D(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function B(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function Y(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function N(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function F(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function X(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function $(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function K(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function V(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function J(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function q(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function U(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Q(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function Z(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function ee(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function te(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function ne(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function ie(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function re(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function oe(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function ae(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function se(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function ue(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function he(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function le(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ce(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function fe(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function pe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ye(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function de(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function ge(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function be(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ve(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function we(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function me(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ke(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function Oe(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function xe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Te(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function je(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function Me(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ee(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Pe(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function Se(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function Ce(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ie(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function We(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function Le(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Re(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function He(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function Ge(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ae(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function ze(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function De(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Be(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function Ye(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function Ne(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Fe(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function Xe(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function $e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ke(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function Ve(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function Je(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function qe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ue(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Qe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ze(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function et(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function tt(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function nt(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function it(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function rt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ot(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var at=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),st=null,ut=function(){function e(t,n,r){i(this,e),this.title=t,this.width=n,this.height=r,this.paused=!1,this.createDisplay()}return at(e,[{key:"createDisplay",value:function(){document.title=this.title;var e=document.getElementById("canvas");e.setAttribute("height",this.height),e.setAttribute("width",this.width),st=e.getContext("2d"),st.webkitImageSmoothingEnabled=!1,st.mozImageSmoothingEnabled=!1,st.imageSmoothingEnabled=!1,this.setEventListeners()}},{key:"setEventListeners",value:function(){window.onblur=this.pause,window.onfocus=this.unPause}},{key:"pause",value:function(){this.paused=!0}},{key:"unPause",value:function(){this.paused=!1}},{key:"getTitle",value:function(){return this.title}},{key:"getWidth",value:function(){return this.width}},{key:"getHeight",value:function(){return this.height}},{key:"getGraphics",value:function(){return st}}]),e}();CanvasRenderingContext2D.prototype.myDrawImage=function(e,t,n,i,r){st.drawImage(e.sheet,e.x,e.y,e.width,e.height,t,n,i,r)},CanvasRenderingContext2D.prototype.drawText=function(e){st.font=e.fontSize+"px Arial",st.fillStyle=e.fillColor,st.strokeText(e.text,e.x,e.y),st.fillText(e.text,e.x,e.y)};var ht=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),lt=function(){function e(t,n,i,o){r(this,e),this.x=t,this.y=n,this.width=i,this.height=o}return ht(e,[{key:"intersects",value:function(e){return this.x<e.x+e.width&&this.x+this.width>e.x&&this.y<e.y+e.height&&this.y+this.height>e.y}}]),e}(),ct=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),ft=void 0,pt=void 0,yt=void 0,dt=function(e,t){var n=e.getY(),i=t.getY(),r=e.getHeight(),o=t.getHeight();return n+r===i+o?0:n+r<i+o?-1:1},gt=function(){function e(t,n){o(this,e),ft=t,pt=n,yt=new Array(pt)}return ct(e,[{key:"tick",value:function(e){yt.sort(dt);for(var t=0;t<yt.length;t++){yt[t].tick(e)}}},{key:"render",value:function(e){yt.forEach(function(t){t.handler.getWidth()+t.handler.getGameCamera().getxOffset()&&t.handler.getHeight()+t.handler.getGameCamera().getyOffset()&&t.handler.getGameCamera().getxOffset()-t.width&&t.handler.getGameCamera().getyOffset()-t.height&&t.render(e)})}},{key:"getPlayer",value:function(){return pt}},{key:"getHandler",value:function(){return ft}},{key:"getEntities",value:function(){return yt}},{key:"addEntity",value:function(e){yt.push(e),ft.getWorld().getSpatialGrid().insert(new lt(e.x+e.bounds.x,e.y+e.bounds.y,e.bounds.width,e.bounds.height),e)}},{key:"removeEntity",value:function(e){var t=yt.indexOf(e);ft.getWorld().getSpatialGrid().remove(new lt(e.x+e.bounds.x,e.y+e.bounds.y,e.bounds.width,e.bounds.height),e),yt.splice(t,1)}},{key:"removeEntitiesByType",value:function(e){yt=yt.filter(function(t){if(t.type!==e)return t;ft.getWorld().getSpatialGrid().remove(new lt(t.x+t.bounds.x,t.y+t.bounds.y,t.bounds.width,t.bounds.height),t)})}}]),e}(),bt=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),vt=function(){function e(t){a(this,e),this.frames=t,this.index=0,this.lastTime=Date.now(),this.timer=0,this.speed=1e3}return bt(e,[{key:"tick",value:function(){this.timer+=Date.now()-this.lastTime,this.lastTime=Date.now(),this.timer>=this.speed&&(this.index++,this.timer=0,this.index>=this.frames.length&&(this.index=0))}},{key:"getCurrentFrame",value:function(){return this.speed=this.frames[this.index].speed,this.frames[this.index].frame}}]),e}(),wt=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),mt=function(){function e(){s(this,e)}return wt(e,null,[{key:"loadImage",value:function(e){var t=new Image;return t.src=e,t}}]),e}(),kt=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Ot=function(){function e(t){u(this,e),this.sheet=t}return kt(e,[{key:"crop",value:function(e,t,n,i){return{sheet:this.sheet,x:e,y:t,width:n,height:i}}}]),e}(),_t=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),xt={},Tt=window.location.href.replace("index.html","")+"src/res/",jt=function(){function e(t,n,i,r){h(this,e),xt[t]=this,this.name=t,this.path=n,this.width=i,this.height=r,this.sheet=new Ot(mt.loadImage(this.path)),this.animations={}}return _t(e,[{key:"addAnimation",value:function(e,t){this.animations[e]=t}},{key:"getWidth",value:function(){return 16}},{key:"getHeight",value:function(){return 16}}],[{key:"getAssets",value:function(e){return xt[e]}}]),e}(),Mt=function(e,t,n){return e.sheet.crop(16*t,16*n,16,16)},Et=new jt("tiles",Tt+"tiles.png",16,16);Et.path=Mt(Et,1,0),Et.pathBlue=Mt(Et,1,2),Et.pathGreen=Mt(Et,2,2),Et.pathYellow=Mt(Et,0,2),Et.wall=Mt(Et,0,0),Et.wallBlue=Mt(Et,1,1),Et.wallGreen=Mt(Et,2,1),Et.wallYellow=Mt(Et,0,1),Et.switchGreen=Mt(Et,2,0),Et.switchBlue=Mt(Et,3,0),Et.exit=Mt(Et,3,1),Et.lantern=Mt(Et,3,2);var Pt=new jt("sprites",Tt+"sprites.png",16,18),St=new jt("creature",Tt+"creature.png",16,18),Ct=function(e){for(var t=[],n=[],i=[],r=[],o=[],a=0;a<3;a++)i.push({frame:e.sheet.crop(e.width*a,0*e.height,e.width,e.height),speed:200}),t.push({frame:e.sheet.crop(e.width*a,1*e.height+1,e.width,e.height),speed:200}),r.push({frame:e.sheet.crop(e.width*a,2*e.height+1,e.width,e.height),speed:200}),n.push({frame:e.sheet.crop(e.width*a,3*e.height+1,e.width,e.height),speed:200}),o.push({frame:e.sheet.crop(e.width*a,4*e.height,e.width,e.height),speed:500});var s=[{frame:e.sheet.crop(0,2*e.height,e.width,e.height),speed:200},{frame:e.sheet.crop(1*e.width,2*e.height,e.width,e.height),speed:200},{frame:e.sheet.crop(2*e.width,2*e.height,e.width,e.height),speed:200}];e.addAnimation("walk_up",new vt(i)),e.addAnimation("walk_right",new vt(t)),e.addAnimation("walk_down",new vt(r)),e.addAnimation("walk_left",new vt(n)),e.addAnimation("idle",new vt(s)),e.addAnimation("death",new vt(o))};Ct(Pt),Ct(St);var It=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Wt=function(){function e(t){l(this,e),this.handler=t,this.countSinceInput=0}return It(e,[{key:"tick",value:function(e){this.countSinceInput++,this.countSinceInput>8&&this.getInput(e),this.render()}},{key:"render",value:function(){alert("all menus need a render!")}},{key:"getInput",value:function(){alert("all menus need getInput!")}}]),e}(),Lt=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Rt=function(e){function t(e){return c(this,t),f(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return p(t,e),Lt(t,[{key:"render",value:function(e){if(e){var t=this.handler.getWidth(),n=this.handler.getHeight();e.fillStyle="black",e.fillRect(0,0,t,n);var i="You escaped the maze!",r=t/2-e.measureText(i).width/2,o=n/3;e.drawText({fillColor:"yellow",text:i,fontSize:32,x:r,y:o}),i="Press enter for another run!",r=t/2-e.measureText(i).width/2,o=n/1.5,e.drawText({fillColor:"white",text:i,fontSize:32,x:r,y:o})}}},{key:"getInput",value:function(){this.handler.getKeyManager().enter&&window.location.reload()}}]),t}(Wt),Ht=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Gt=function(e){function t(e){return y(this,t),d(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return g(t,e),Ht(t,[{key:"render",value:function(e){if(e){var t=this.handler.getWidth(),n=this.handler.getHeight();e.fillStyle="black",e.fillRect(0,0,t,n);var i="Y O U   D I E D",r=t/2-e.measureText(i).width/2,o=n/3;e.drawText({fillColor:"red",text:i,fontSize:32,x:r,y:o}),i="press enter to try again",r=t/2-e.measureText(i).width/2,o=n/1.5,e.drawText({fillColor:"white",text:i,fontSize:32,x:r,y:o})}}},{key:"getInput",value:function(){this.handler.getKeyManager().enter&&window.location.reload()}}]),t}(Wt),At=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),zt=function(){function e(t,n,i,r,o){b(this,e),this.x=n,this.y=i,this.width=r,this.height=o,this.handler=t,this.bounds=new lt(0,0,r,o),this.target=null,this.moveThrough=!1}return At(e,[{key:"tick",value:function(e){throw"Entities must have a tick function!"}},{key:"render",value:function(e){throw"Entities must have a render function!"}},{key:"getX",value:function(){return this.x}},{key:"getY",value:function(){return this.y}},{key:"getWidth",value:function(){return this.width}},{key:"getHeight",value:function(){return this.height}},{key:"getCollisionBounds",value:function(e,t){return new lt(parseInt(this.x+this.bounds.x+e),parseInt(this.y+this.bounds.y+t),this.bounds.width,this.bounds.height)}},{key:"checkEntityCollisions",value:function(e,t){for(var n=this.handler.getWorld().getSpatialGrid().retrieve(new lt(this.x+this.bounds.x+e,this.y+this.bounds.y+t,this.bounds.width,this.bounds.height),this),i=0;i<n.length;i++){var r=n[i];if(r.moveThrough)return!1;if(r.getCollisionBounds(0,0).intersects(this.getCollisionBounds(e,t)))return this.checkForCollisionEvents(this,r),!0}return!1}},{key:"checkForCollisionEvents",value:function(e,t){if(!this.checkCollidingTypes(e,t,"monster","monster")){if(this.checkCollidingTypes(e,t,"player","journal")&&("journal"===e.type?(e.triggerEntry(),this.handler.getWorld().entityManager.removeEntity(e)):(t.triggerEntry(),this.handler.getWorld().entityManager.removeEntity(t))),this.checkCollidingTypes(e,t,"switch","player")&&("switch"===e.type?e.toggleSwitch():t.toggleSwitch()),this.checkCollidingTypes(e,t,"player","exit")){if(this.handler.getWorld().level>=4){var n=new Rt(this.handler);this.handler.getGame().getGameState().setState(n)}return void this.handler.getWorld().changeLevel()}if(this.checkCollidingTypes(e,t,"player","monster")){if(e.invincible||t.invincible)return;var i=new Gt(e.handler);e.handler.getGame().getGameState().setState(i)}}}},{key:"checkCollidingTypes",value:function(e,t,n,i){return e.type===n&&t.type===i||e.type===i&&t.type===n}},{key:"setX",value:function(e){this.x=e}},{key:"setY",value:function(e){this.y=e}},{key:"setWidth",value:function(e){this.width=e}},{key:"setHeight",value:function(e){this.height=e}}]),e}(),Dt=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Bt=100,Yt=200,Nt=64,Ft=64,Xt=function(e){function t(e,n,i){v(this,t);var r=w(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,i,Nt,Ft));return r.health=Yt,r.speed=Bt,r.xMove=0,r.yMove=0,r}return m(t,e),Dt(t,[{key:"tick",value:function(){this.yMove<0&&this.assets.animations.walk_up.tick(),this.yMove>0&&this.assets.animations.walk_down.tick(),this.xMove>0&&this.assets.animations.walk_right.tick(),this.xMove<0&&this.assets.animations.walk_left.tick()}},{key:"move",value:function(){(Math.abs(this.xMove)>0||Math.abs(this.yMove)>0)&&(this.handler.getWorld().getSpatialGrid().remove(new lt(this.x+this.bounds.x,this.y+this.bounds.y,this.bounds.width,this.bounds.height),this),this.checkEntityCollisions(this.xMove,0)||this.moveX(),this.checkEntityCollisions(0,this.yMove)||this.moveY(),this.handler.getWorld().getSpatialGrid().insert(new lt(this.x+this.bounds.x,this.y+this.bounds.y,this.bounds.width,this.bounds.height),this))}},{key:"moveX",value:function(){if(this.clipping)return void(this.x+=this.xMove);var e=this.xMove>0?parseInt((this.x+this.xMove+this.bounds.x+this.bounds.width)/64):parseInt((this.x+this.xMove+this.bounds.x)/64),t=parseInt((this.y+this.bounds.y)/64),n=parseInt((this.y+this.bounds.y+this.bounds.height)/64),i=this.xMove>0?64*e-this.bounds.x-this.bounds.width-1:64*e+64-this.bounds.x;this.collisionWithTile(e,t)||this.collisionWithTile(e,n)?this.x=i:this.x+=this.xMove}},{key:"moveY",value:function(){if(this.clipping)return void(this.y+=this.yMove);var e=this.yMove>0?parseInt((this.y+this.yMove+this.bounds.y+this.bounds.height)/64):parseInt((this.y+this.yMove+this.bounds.y)/64),t=parseInt((this.x+this.bounds.x)/64),n=parseInt((this.x+this.bounds.x+this.bounds.width)/64),i=this.yMove>0?64*e-this.bounds.y-this.bounds.height-1:64*e+64-this.bounds.y;this.collisionWithTile(t,e)||this.collisionWithTile(n,e)?this.y=i:this.y+=this.yMove}},{key:"collisionWithTile",value:function(e,t){try{return this.handler.getWorld().getTile(e,t).isSolid}catch(e){}}},{key:"getCurrentAnimationFrame",value:function(){return this.yMove<0?(this.lastAnimation="walk_up",this.assets.animations.walk_up.getCurrentFrame()):this.yMove>0?(this.lastAnimation="walk_down",this.assets.animations.walk_down.getCurrentFrame()):this.xMove<0?(this.lastAnimation="walk_left",this.assets.animations.walk_left.getCurrentFrame()):this.xMove>0?(this.lastAnimation="walk_right",this.assets.animations.walk_right.getCurrentFrame()):this.assets.animations[this.lastAnimation].getCurrentFrame()}}]),t}(zt),$t=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Kt=function e(t,n,i){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,n);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,i)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(i)},Vt=64,Jt=64,qt=function(e){function t(e,n,i){k(this,t);var r=O(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,i,Vt,Jt));return r.assets=jt.getAssets("creature"),r.x=n,r.y=i,r.spawnX=n,r.spawnY=i,r.bounds.x=10,r.bounds.y=10,r.bounds.width=Vt-2*r.bounds.x,r.bounds.height=Jt-2*r.bounds.y,r.type="monster",r.patrol=r.getPatrolPattern(),r.startX=n,r.startY=i,r.patrolLength=100,r.dirMoving=0,r.numberOfMoves=0,r.lastAnimation="walk_down",r}return _(t,e),$t(t,[{key:"getPatrolPattern",value:function(){var e=["vertical","horizontal"];return e[Math.floor(Math.random()*e.length)]}},{key:"maybeChangePatrol",value:function(){Math.random()<.41&&(this.patrol="vertical"===this.patrol?"horizontal":"vertical")}},{key:"checkIfOffMap",value:function(){var e=this.handler.getWorld().getWorldWidth()*Vt,t=this.handler.getWorld().getWorldHeight()*Jt;(this.x<1||this.y<1||this.x>e||this.y>t)&&(this.x=this.spawnX,this.y=this.spawnY)}},{key:"setPatrolMovement",value:function(e){"vertical"===this.patrol?(0===this.dirMoving?this.yMove=-this.speed*e:this.yMove=this.speed*e,++this.numberOfMoves>this.patrolLength&&(this.dirMoving=0===this.dirMoving?1:0,this.numberOfMoves=0,this.maybeChangePatrol())):"horizontal"===this.patrol&&(0===this.dirMoving?this.xMove=-this.speed*e:this.xMove=this.speed*e,++this.numberOfMoves>this.patrolLength&&(this.dirMoving=0===this.dirMoving?1:0,this.numberOfMoves=0,this.maybeChangePatrol()))}},{key:"checkIfInWall",value:function(){var e=Math.round(this.x/Vt),t=Math.round(this.y/Jt);if(this.handler.getWorld().getTile(e,t).isSolid)for(var n=e-1,i=t-1,r=e+1,o=t+1,a=i;a<o;a++)for(var s=n;s<r;s++)if(!this.handler.getWorld().getTile(s,a).isSolid&&(s===e||a===t))return this.x=s*Vt,void(this.y=a*Jt)}},{key:"tick",value:function(e){this.checkIfOffMap(),this.checkIfInWall(),this.setPatrolMovement(e),Kt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"tick",this).call(this),this.move()}},{key:"render",value:function(e){e.myDrawImage(this.getCurrentAnimationFrame(),this.x-this.handler.getGameCamera().getxOffset(),this.y-this.handler.getGameCamera().getyOffset(),this.width,this.height)}}]),t}(Xt),Ut=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Qt=[],Zt=[],en=[2,3,7],tn=0,nn=0,rn=function(e,t){return 0===e||0===t||e===tn-1||t===nn-1?1:Math.floor(20*Math.random())<15?1:en[Math.floor(Math.random()*en.length)]},on=function(){function e(){x(this,e)}return Ut(e,null,[{key:"createMaze",value:function(){for(var e=[],t=0;t<nn;t++){Qt[t]=[];for(var n=0;n<tn;n++)Qt[t][n]=1}var i=1,r=1;Qt[i][r]=0,e.push(r+r*tn);do{if(e.length){var o="";if(i+2>0&&i+2<nn-1&&1==Qt[i+2][r]&&(o+="S"),i-2>0&&i-2<nn-1&&1==Qt[i-2][r]&&(o+="N"),r-2>0&&r-2<tn-1&&1==Qt[i][r-2]&&(o+="W"),r+2>0&&r+2<tn-1&&1==Qt[i][r+2]&&(o+="E"),o){var a=Math.floor(Math.random()*o.length);switch(o[a]){case"N":Qt[i-2][r]=0,Qt[i-1][r]=0,i-=2;break;case"S":Qt[i+2][r]=0,Qt[i+1][r]=0,i+=2;break;case"W":Qt[i][r-2]=0,Qt[i][r-1]=0,r-=2;break;case"E":Qt[i][r+2]=0,Qt[i][r+1]=0,r+=2}e.push(r+i*tn)}else{var s=e.pop();i=Math.floor(s/tn),r=s%tn}this.buildFinalMaze(i,r)}}while(e.length)}},{key:"buildFinalMaze",value:function(){for(var e=0;e<nn;e++)for(var t=0;t<tn;t++)Zt[t]||(Zt[t]=[]),Zt[t][e]=1===Qt[e][t]?rn(e,t):0}},{key:"createRooms",value:function(){this.createRoom(1,1,3),this.createRoom(1,nn-4,3),this.createRoom(tn-4,nn-4,3),this.createRoom(tn-4,1,3)}},{key:"createRoom",value:function(e,t,n){for(var i=t;i<t+n;i++)for(var r=e;r<e+n;r++)Zt[r][i]=0}},{key:"createBarriers",value:function(e){2!==e&&(Zt[1][Math.ceil(nn/2)]=1,Zt[1][Math.ceil(nn/2)+1]=1,Zt[tn-2][Math.ceil(nn/2)]=1,Zt[tn-2][Math.ceil(nn/2)+1]=1,Zt[Math.ceil(tn/2)][1]=1,Zt[Math.ceil(tn/2)+1][1]=1,Zt[Math.ceil(tn/2)][nn-2]=1,Zt[Math.ceil(tn/2)+1][nn-2]=1)}},{key:"getIntroMaze",value:function(){return[[1,1,1,1,1,1,1,1,1],[1,0,0,2,0,0,7,0,1],[1,2,2,2,0,0,7,0,1],[1,0,0,0,0,0,7,0,1],[1,0,0,0,0,0,7,0,1],[1,3,3,0,0,0,7,0,1],[1,0,0,3,0,0,7,0,1],[1,0,0,3,0,0,7,0,1],[1,1,1,1,1,1,1,1,1]]}},{key:"getRandomMaze",value:function(e,t,n){return 1===e?{mazeWidth:9,mazeHeight:9,spawnX:1,spawnY:1,pieces:this.getIntroMaze()}:(tn=nn=10*e-1,this.createMaze(),this.createRooms(),this.createBarriers(e),{mazeWidth:tn,mazeHeight:nn,spawnX:t,spawnY:n,pieces:Zt})}}]),e}(),an=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),sn=function e(t,n,i){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,n);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,i)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(i)},un=!1,hn=0,ln=function(e){function t(e,n,i){T(this,t);var r=j(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,i));return r.assets=jt.getAssets("sprites"),r.x=n,r.y=i,r.speed=140,r.bounds.x=14,r.bounds.y=24,r.bounds.width=36,r.bounds.height=39,r.type="player",r.clipping=!1,r.invincible=!1,r.superSpeed=!1,r.allCheats=!1,r.lastAnimation="walk_down",r}return M(t,e),an(t,[{key:"tick",value:function(e){this.xMove=this.yMove=0,this.getInput(e),sn(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"tick",this).call(this,e),this.move(),this.superSpeed&&(this.move(),this.move()),this.handler.getGameCamera().centerOnEntity(this)}},{key:"render",value:function(e){e.myDrawImage(this.getCurrentAnimationFrame(),this.x-this.handler.getGameCamera().getxOffset(),this.y-this.handler.getGameCamera().getyOffset(),64,64)}},{key:"getInput",value:function(e){var t=this.handler.getKeyManager();if((t.up||t.w||t.z)&&(this.yMove=-this.speed*e),(t.down||t.s)&&(this.yMove=this.speed*e),(t.left||t.a||t.q)&&(this.xMove=-this.speed*e),(t.right||t.d)&&(this.xMove=this.speed*e),un||hn++,hn>15||un){if(un=!0,hn=0,t.one){var n=this.allCheats?" ALL CHEATS disabled ":" ALL CHEATS enabled ";this.handler.devMessage(n),this.allCheats=!this.allCheats,this.clipping=this.allCheats,this.invincible=this.allCheats,this.superSpeed=this.allCheats,un=!1}if(t.three){var i=this.invincible?" invincibility disabled ":" invincibility enabled ";this.handler.devMessage(i),this.invincible=!this.invincible,un=!1}if(t.two){var r=this.clipping?" clipping disabled ":" clipping enabled ";this.handler.devMessage(r),this.clipping=!this.clipping,un=!1}if(t.four){var o=this.superSpeed?" super speed disabled ":" super speed enabled ";this.handler.devMessage(o),this.superSpeed=!this.superSpeed,un=!1}}}}]),t}(Xt),cn=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),fn=function(){function e(t,n,i){E(this,e),this.width=parseInt(t/i),this.height=parseInt(n/i),this.size=i,this.grid=[];for(var r=0;r<=this.width;r++){this.grid[r]=[];for(var o=0;o<=this.height;o++)this.grid[r][o]=[]}}return cn(e,[{key:"insert",value:function(e,t){for(var n=Math.max(0,parseInt(e.x/this.size)),i=Math.max(0,parseInt(e.y/this.size)),r=Math.min(this.width,parseInt((e.x+e.width)/this.size)),o=Math.min(this.height,parseInt((e.y+e.height)/this.size)),a=i;a<=o;a++)for(var s=n;s<=r;s++)-1===this.grid[s][a].indexOf(t)&&this.grid[s][a].push(t)}},{key:"retrieve",value:function(e,t){for(var n=Math.max(0,parseInt(e.x/this.size)),i=Math.max(0,parseInt(e.y/this.size)),r=Math.min(this.width,parseInt((e.x+e.width)/this.size)),o=Math.min(this.height,parseInt((e.y+e.height)/this.size)),a=[],s=i;s<=o;s++)for(var u=n;u<=r;u++)this.grid[u][s].forEach(function(e){e!==t&&-1===a.indexOf(e)&&a.push(e)});return a}},{key:"remove",value:function(e,t){for(var n=Math.max(0,parseInt(e.x/this.size)),i=Math.max(0,parseInt(e.y/this.size)),r=Math.min(this.width,parseInt((e.x+e.width)/this.size)),o=Math.min(this.height,parseInt((e.y+e.height)/this.size)),a=i;a<=o;a++)for(var s=n;s<=r;s++)for(var u=0;u<this.grid[s][a].length;u++)this.grid[s][a][u]===t&&this.grid[s][a].splice(u,1)}},{key:"getWidth",value:function(){return this.width}},{key:"getHeight",value:function(){return this.height}},{key:"getSize",value:function(){return this.size}}]),e}(),pn=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),yn=function(){function e(t,n){P(this,e),this.isSolid=!1,this.texture=t,this.id=n,this.disappear=!1,this.assets=jt.getAssets("tiles")}return pn(e,[{key:"render",value:function(e,t,n){e.myDrawImage(this.texture,t,n,64,64)}},{key:"getId",value:function(){return this.id}}]),e}(),dn=(function(e){function t(e){S(this,t);var n=C(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,jt.getAssets("tiles").exit,e));return n.isSolid=!0,n.type="exit",n}I(t,e)}(yn),function(e){function t(e){return W(this,t),L(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,jt.getAssets("tiles").path,e))}return R(t,e),t}(yn)),gn=function(e){function t(e){return H(this,t),G(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,jt.getAssets("tiles").pathBlue,e))}return A(t,e),t}(yn),bn=function(e){function t(e){return z(this,t),D(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,jt.getAssets("tiles").pathYellow,e))}return B(t,e),t}(yn),vn=function(e){function t(e){Y(this,t);var n=N(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,jt.getAssets("tiles").wall,e));return n.isSolid=!0,n}return F(t,e),t}(yn),wn=function(e){function t(e){X(this,t);var n=$(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,jt.getAssets("tiles").wallBlue,e));return n.isSolid=!0,n}return K(t,e),t}(yn),mn=function(e){function t(e){V(this,t);var n=J(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,jt.getAssets("tiles").wallYellow,e));return n.isSolid=!0,n.disappear=!0,n}return q(t,e),t}(yn),kn=(function(e){function t(e){U(this,t);var n=Q(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,jt.getAssets("tiles").switchBlue,e));return n.isSolid=!0,n.type="switch",n.color="blue",n}Z(t,e)}(yn),function(e){function t(e){return ee(this,t),te(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,jt.getAssets("tiles").pathGreen,e))}return ne(t,e),t}(yn)),On=function(e){function t(e){ie(this,t);var n=re(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,jt.getAssets("tiles").wallGreen,e));return n.isSolid=!0,n}return oe(t,e),t}(yn),_n=(function(e){function t(e){ae(this,t);var n=se(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,jt.getAssets("tiles").switchGreen,e));return n.isSolid=!0,n.type="switch",n.color="green",n}ue(t,e)}(yn),function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}()),xn=jt.getAssets("tiles"),Tn=[];Tn[0]=new dn(0),Tn[1]=new vn(1),Tn[2]=new mn(2),Tn[3]=new wn(3),Tn[4]=new bn(4),Tn[5]=new gn(5),Tn[7]=new kn(7),Tn[8]=new On(8);var jn=function(){function e(){he(this,e)}return _n(e,null,[{key:"getAssets",value:function(){return xn}},{key:"getTiles",value:function(){return Tn}}]),e}(),Mn=function(e){function t(e,n,i,r,o){return le(this,t),ce(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,i,r,o))}return fe(t,e),t}(zt),En=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Pn=64,Sn=64,Cn=function(e){function t(e,n,i,r,o){pe(this,t);var a=ye(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,i,r,o));return a.manager=a.handler.getWorld().getLightManager(),a.posX=Math.floor(n/Pn),a.posY=Math.floor(i/Sn),a.bounds.x=0,a.bounds.y=0,a.bounds.width=0,a.bounds.height=0,a.flickering=!1,a.lastFlickerCounter=0,a.flickerToggle=0,a.flickerCount=0,a.flickerTimes=0,a.flickerLength=0,a.moveThrough=!0,a.assets=jt.getAssets("tiles"),a.type="light",a.init(),a}return de(t,e),En(t,[{key:"init",value:function(){this.makeSureOnWall(),this.expandLight()}},{key:"makeSureOnWall",value:function(){var e=this.posX,t=this.posY;if(1!==this.handler.getWorld().getTile(e,t).id)for(var n=t-1;n<t+1;n++)for(var i=e-1;i<e+1;i++)if(1===this.handler.getWorld().getTile(i,n).id)return this.posX=i,void(this.posY=n)}},{key:"expandLight",value:function(){for(var e=-2;e<3;e++)for(var t=-2;t<3;t++)this.manager.lightMap[this.posX+t][this.posY+e]=Math.min(this.manager.lightMap[this.posX+t][this.posY+e],.65);for(var n=-1;n<2;n++)for(var i=-1;i<2;i++)this.manager.lightMap[this.posX+i][this.posY+n]=Math.min(this.manager.lightMap[this.posX+i][this.posY+n],.5);this.manager.lightMap[this.posX][this.posY]=.3}},{key:"dimLights",value:function(e){for(var t=-2;t<3;t++)for(var n=-2;n<3;n++)this.manager.lightMap[this.posX+n][this.posY+t]=Math.min(.75,.65+e);for(var i=-1;i<2;i++)for(var r=-1;r<2;r++)this.manager.lightMap[this.posX+r][this.posY+i]=Math.min(.75,.5+e);this.manager.lightMap[this.posX][this.posY]=Math.min(.75,.3+e)}},{key:"chanceToFlicker",value:function(){Math.random()<.85||(this.lastFlickerCounter=0,this.flickerLength=Math.floor(5*Math.random())+4,this.flickering=!0)}},{key:"flickerLights",value:function(){0===this.flickerCount&&(0===this.flickerToggle?(this.dimLights(.25),this.flickerToggle=1):(this.expandLight(),this.flickerToggle=0)),this.flickerCount++,this.flickerCount>=this.flickerLength&&(this.flickerCount=0,this.flickerTimes++),this.flickerTimes>=6&&(this.flickerTimes=0,this.flickering=!1)}},{key:"tick",value:function(){this.flickering?this.flickerLights():++this.lastFlickerCounter>240&&this.chanceToFlicker()}},{key:"render",value:function(e){e.myDrawImage(this.assets.lantern,this.x-this.handler.getGameCamera().getxOffset(),this.y-this.handler.getGameCamera().getyOffset(),this.width,this.height)}}]),t}(Mn),In=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Wn=function(){function e(t){ge(this,e),this.handler=t,this.init()}return In(e,[{key:"init",value:function(){this.sources=[],this.lightMap=[],this.fillLightMap()}},{key:"fillLightMap",value:function(){for(var e=this.handler.getWorld().getWorldWidth(),t=this.handler.getWorld().getWorldHeight(),n=0;n<t;n++)for(var i=0;i<e;i++)this.lightMap[i]||(this.lightMap[i]=[]),this.lightMap[i][n]=.85}},{key:"tick",value:function(){this.sources.forEach(function(e){e.tick()})}},{key:"render",value:function(e,t,n,i,r){this.sources.forEach(function(e){e.render(r)}),this.drawLightBlocks(e,t,n,i,r)}},{key:"drawLightBlocks",value:function(e,t,n,i,r){r.fillStyle="black";for(var o=n;o<i;o++)for(var a=e;a<t;a++){var s=this.handler.getWorld().getTile(a,o).type;r.globalAlpha="switch"===s||"exit"===s?.3:this.lightMap[a][o],r.fillRect(64*a-this.handler.getGameCamera().getxOffset(),64*o-this.handler.getGameCamera().getyOffset(),64,64)}r.globalAlpha=1}},{key:"addSource",value:function(e,t){var n=new Cn(this.handler,64*e,64*t,64,64,this);this.handler.getWorld().getEntityManager().addEntity(n),this.sources.push(n)}},{key:"setLight",value:function(e,t,n){this.lightMap[e][t]=n}},{key:"removeSources",value:function(){this.handler.getWorld().getEntityManager().removeEntitiesByType("light"),this.sources=[]}}]),e}(),Ln=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Rn=function(e){function t(e,n,i,r,o){be(this,t);var a=ve(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,i,r,o));return a.assets=jt.getAssets("tiles"),a.type="exit",a.bounds.x=15,a.bounds.y=15,a.bounds.width=a.width-30,a.bounds.height=a.height-30,a}return we(t,e),Ln(t,[{key:"tick",value:function(){}},{key:"render",value:function(e){e.myDrawImage(this.assets.exit,this.x-this.handler.getGameCamera().getxOffset(),this.y-this.handler.getGameCamera().getyOffset(),this.width,this.height)}}]),t}(Mn),Hn=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Gn=60,An=function(e){function t(e,n,i,r,o){me(this,t);var a=ke(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,i,r,o));return a.assets=jt.getAssets("tiles"),a.type="switch",a.bounds.x=5,a.bounds.y=25,a.bounds.width=a.width-18,a.bounds.height=a.height-35,a.currentSwitch=a.assets.switchGreen,a}return Oe(t,e),Hn(t,[{key:"tick",value:function(){Gn++}},{key:"toggleSwitch",value:function(){Gn<40||(this.currentSwitch===this.assets.switchGreen?(this.currentSwitch=this.assets.switchBlue,this.color="blue"):(this.currentSwitch=this.assets.switchGreen,this.color="green"),this.handler.getWorld().swapGreenAndBlueTiles(this.color),Gn=0)}},{key:"render",value:function(e){e.myDrawImage(this.currentSwitch,this.x-this.handler.getGameCamera().getxOffset(),this.y-this.handler.getGameCamera().getyOffset(),this.width,this.height)}}]),t}(Mn),zn=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Dn=document.getElementById("dialogue"),Bn=document.getElementById("speaker"),Yn=5,Nn=0,Fn="",Xn="",$n=!1,Kn=!1,Vn=!1,Jn=function(){function e(){_e(this,e),this.init(),this.words=[],this.speakers=[]}return zn(e,[{key:"init",value:function(){}},{key:"tick",value:function(){Yn>=0&&this.words.length&&(this.words[0].length?this.speakNextLetter():Nn>=120?this.resetForNextSentence():Nn++),Yn<30&&Yn++}},{key:"resetForNextSentence",value:function(){this.words.splice(0,1),this.speakers.splice(0,1),Dn.innerHTML="",Bn.innerHTML="",Nn=0}},{key:"speakNextLetter",value:function(){Bn.innerHTML=this.speakers[0]+":";var e=this.words[0][0];"@"===e&&($n=!$n),"$"===e&&(Vn=!Vn),"&"===e&&(Kn=!Kn),Fn="",Xn="",$n&&(Fn+='<span style="color:red">',Xn+="</span>"),Vn&&(Fn+='<span style="color:yellow">',Xn+="</span>"),Kn&&(Fn+="<em>",Xn+="</em>"),"%"===e&&(Xn+="<br />"),Dn.innerHTML+=Fn+e.replace("%","").replace("@","").replace("&","").replace("$","")+Xn,this.words[0].splice(0,1),Yn=0}},{key:"addWords",value:function(e,t){this.words.push(t.split("")),this.speakers.push(e)}}]),e}(),qn=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Un=function(e){function t(e,n,i,r,o,a){xe(this,t);var s=Te(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,i,r,o));return s.type="journal",s.bounds.x=15,s.bounds.y=15,s.bounds.width=s.width-30,s.bounds.height=s.height-30,s.journal=a,s.triggered=!1,s}return je(t,e),qn(t,[{key:"tick",value:function(){}},{key:"render",value:function(e){e.fillStyle="yellow",e.fillRect(this.bounds.x+this.x-this.handler.getGameCamera().getxOffset(),this.bounds.y+this.y-this.handler.getGameCamera().getyOffset(),this.bounds.width,this.bounds.height)}},{key:"triggerEntry",value:function(){var e=this;this.triggered||(this.triggered=!0,this.journal.getText().forEach(function(t){e.handler.getWorld().dialogue.addWords(e.journal.name,t)}))}}]),t}(Mn),Qn=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Zn=function(){function e(){Me(this,e)}return Qn(e,[{key:"getText",value:function(){return this.text}},{key:"setText",value:function(e){this.text=e}}]),e}(),ei=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),ti=function(e){function t(){Ee(this,t);var e=Pe(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.setText(e.myText()),e.name="Journal #001",e}return Se(t,e),ei(t,[{key:"myText",value:function(){return["Despite his best efforts, I've stayed alive longer than anyone else...","Before he sent me down into this hellhole, I was able to swipe one of his notebooks. He noticed, and broke my leg with a pipe...","Beware of the grotesque beings down here. One touch from them will plague your mind.","The beings are often slow, so make use of the switches and rotating walls to cut them off.","For all who come after me, I hope to provide some small guidance."]}}]),t}(Zn),ni=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),ii=function(e){function t(){Ce(this,t);var e=Ie(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.setText(e.myText()),e.name="Journal #002",e}return We(t,e),ni(t,[{key:"myText",value:function(){return["This place seems dark and unending. I feel as though I am peering into the abyss at every turn..","I'm not sure how much farther down it goes... I hope I'll see it to the end.","I have to hope, because the only thing left for me is fear and this damned broken tibia.","One odd thing... I have encountered an $old man$ in some of the darkest corners of the maze.","There is something very calming about him. He makes me feel as though I can push on a little longer.","He never speaks, and those... things never bother him. I wonder why?"]}}]),t}(Zn),ri=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),oi=function(e){function t(){Le(this,t);var e=Re(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.setText(e.myText()),e.name="Journal #003",e}return He(t,e),ri(t,[{key:"myText",value:function(){return["It seems like this place gets larger with each floor I descend. Am I in a pyramid?","The gurgling noises come and go, but a foul stench is always present.","I am feeling migraines from time to time, and hearing an eerie voice constantly calling out to me from within. Like it wants to escape.","I think the silence and darkness are getting the better of me. The $bleeding$ won't stop. I am... afraid."]}}]),t}(Zn),ai=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),si=function(e){function t(){Ge(this,t);var e=Ae(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.setText(e.myText()),e.name="Journal #004",e}return ze(t,e),ai(t,[{key:"myText",value:function(){return["It has been bothering me for a while and I can't get past it. Those creatures, they seem somehow... familiar.","I'm not sure from when or where, but their faces are familiar to me.","Another thing bothering me is that same old man on every floor. How is he traveling between the floors without passing me?","I'll think more on this later... The voice in my head is getting louder and is more frequent.","(&At the bottom of the page you see these words written in what looks to be @blood@.&)","@... ~HeHe. VeRy GooD!~@"]}}]),t}(Zn),ui=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),hi=function(e){function t(){De(this,t);var e=Be(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.setText(e.myText()),e.name="Journal #005",e}return Ye(t,e),ui(t,[{key:"myText",value:function(){return["(&This page is covered in sweat and droplets of @blood@&)","I got a better look at the creatures today.","The strange part is that they all look the same. They all have the same face. %@~WiTH THiS GRoSS SMiLe.~@","It gets creepier. I got a good look at their faces this time in the light.","They all look like the $old man$. &EXACTLY& like him...","@~eVeRy.~","~SiNGLe.~","~oNe.~@"]}}]),t}(Zn),li=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),ci=function(e){function t(){Ne(this,t);var e=Fe(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.setText(e.myText()),e.name="JournaL 0o0o06",e}return Xe(t,e),li(t,[{key:"myText",value:function(){return["To whomever...@~you~@ has made it this far, the $old man$ on this floor has passed away.%@~He iS DeaD you KNoW.~@","I fear no help is available to you.%@~you aRe aLoNe!~@%I barely made it back here on my own.%@~you WeRe NeVeR aLONE~@","I did find an eerie discovery while searching the old man. It seems he bares the same small branding upon his neck as I do.","I cannot see what mine says, but I believe his to be the letter $C$ followed by a $5 digit number$.%@~you KNoW WHaT THiS MeaNS.~@","The headaches rarely stop now.%@~aND SooN NeVeR WiLL.~@"]}}]),t}(Zn),fi=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),pi=function(e){function t(){$e(this,t);var e=Ke(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.setText(e.myText()),e.name="HeHe! My eNTRy",e}return Ve(t,e),fi(t,[{key:"myText",value:function(){return["@~WoW. you Too HaVe MaDe iT To THe eND. WHaT a ViLe JoKe aWaiTS.~","~HoW PiTiFuL i MuST HaVe SeeMeD, THiNKiNG i PuLLeD THe WooL oVeR HiS eyeS.~","~aT THe eND oF THiS FlooR, i HAVE SEEN THE ANSWER. SooN you WiLL Too. SHaLL you GueSS WHaT i SaW?~","~you WouLDN'T BeLieVe Me eVeN iF i ToLD you.~","~SCuRRy oN LiTTLe RaT! you SooN Too WiLL LeaRN THe TRuTH.~@"]}}]),t}(Zn),yi=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),di=64,gi=64,bi=!1,vi=!1,wi=0,mi=0,ki=function(){function e(t){Je(this,e),this.width=null,this.height=null,this.tiles=[],this.handler=t,t.setWorld(this),this.entityManager=new gt(t,new ln(t,20,20)),this.spatialGrid=new fn(this.handler.getWidth()*di,this.handler.getHeight()*gi,64),this.level=1,this.loadWorld(),this.lightManager=new Wn(t),this.dialogue=new Jn,this.init()}return yi(e,[{key:"getLightManager",value:function(){return this.lightManager}},{key:"changeLevel",value:function(){this.setPlayerSpawn(this.spawnX,this.spawnY),this.level+=1,this.tiles=[],mi=0,this.lightManager.removeSources(),this.entityManager.removeEntitiesByType("exit"),this.entityManager.removeEntitiesByType("switch"),this.entityManager.removeEntitiesByType("journal"),vi||this.entityManager.removeEntitiesByType("monster"),vi=!1,this.loadWorld(),this.init()}},{key:"spawnRandomRoomEntities",value:function(){var e=new Rn(this.handler,(this.width-2)*di,(this.height-2)*gi,di,gi),t=Math.random()<.5,n=t?(this.width-3)*di:2*di,i=t?2*gi:(this.height-3)*gi;this.entityManager.addEntity(new An(this.handler,n,i,di,gi)),this.entityManager.addEntity(e)}},{key:"init",value:function(){this.setPlayerSpawn(this.spawnX,this.spawnY),this.lightManager.init(),this.lightManager.fillLightMap(),1===this.level?(this.entityManager.addEntity(new Rn(this.handler,7*di,7*gi,di,gi)),this.entityManager.addEntity(new Un(this.handler,1*di,2*gi,di,gi,new ti)),this.entityManager.addEntity(new qt(this.handler,6*di,2*di)),this.entityManager.addEntity(new An(this.handler,4*di,4*gi,di,gi)),this.lightManager.addSource(5,3)):(this.spawnRandomRoomEntities(),this.addEvenSpreadOfLightSources(7),this.addEvenSpreadOfMonsters(7),this.spawnJournals())}},{key:"spawnJournals",value:function(){var e=[new ii,new oi,new si,new hi,new ci,new pi],t=e[2*this.level-4],n=e[2*this.level-3];this.entityManager.addEntity(new Un(this.handler,2*di,2*gi,di,gi,t)),this.entityManager.addEntity(new Un(this.handler,(this.width-3)*di,(this.height-3)*gi,di,gi,n))}},{key:"addEvenSpreadOfLightSources",value:function(e){for(var t=e;t<=this.height;t+=e)for(var n=e;n<=this.width;n+=e)this.height-t>2&&this.width-n>2&&this.lightManager.addSource(n,t)}},{key:"getWorldHeight",value:function(){return this.height}},{key:"getWorldWidth",value:function(){return this.width}},{key:"addEvenSpreadOfMonsters",value:function(e){for(var t=e;t<=this.height;t+=e)for(var n=e;n<=this.width;n+=e)this.height-t>2&&this.width-n>2&&this.entityManager.addEntity(new qt(this.handler,n*di,t*di))}},{key:"setPlayerSpawn",value:function(e,t){this.entityManager.getPlayer().setX(e),this.entityManager.getPlayer().setY(t)}},{key:"loadWorld",value:function(){for(var e=this.fillWorld(this.level,1,1),t=0;t<this.height;t++)for(var n=0;n<this.width;n++)this.tiles[n]||(this.tiles[n]=[]),this.tiles[n][t]=e[n][t]}},{key:"fillWorld",value:function(e,t,n){var i=on.getRandomMaze(e,t,n);return this.height=i.mazeHeight,this.width=i.mazeWidth,this.spawnX=i.spawnX*di,this.spawnY=i.spawnY*gi,i.pieces}},{key:"swapGreenAndBlueTiles",value:function(e){"green"===e?(this.swapTilesByID(5,3),this.swapTilesByID(8,7)):"blue"===e&&(this.swapTilesByID(3,5),this.swapTilesByID(7,8))}},{key:"getInput",value:function(){}},{key:"swapTilesByID",value:function(e,t){for(var n=1;n<this.height;n++)for(var i=1;i<this.width;i++)this.tiles[i][n]===e&&(this.tiles[i][n]=this.handler.getWorld().getTile(i,n).disappear?0:t)}},{key:"checkForWallSwap",value:function(){++wi>300&&(wi=0,bi?this.swapTilesByID(4,2):this.swapTilesByID(2,4),bi=!bi)}},{key:"tick",value:function(e){this.getInput(),this.checkForWallSwap(),this.entityManager.tick(e),this.lightManager.tick(e),this.dialogue.tick(),vi||1===this.level||++mi/60>=240&&(alert("the monsters crumble all around you."),this.entityManager.removeEntitiesByType("monster"),vi=!0)}},{key:"render",value:function(e){var t=parseInt(Math.max(0,this.handler.getGameCamera().getxOffset()/di)),n=parseInt(Math.min(this.width,(this.handler.getGameCamera().getxOffset()+this.handler.getWidth())/di+1)),i=parseInt(Math.max(0,this.handler.getGameCamera().getyOffset()/gi)),r=parseInt(Math.min(this.height,(this.handler.getGameCamera().getyOffset()+this.handler.getHeight())/gi+1));this.drawTiles(t,n,i,r,e),this.entityManager.render(e),this.lightManager.render(t,n,i,r,e)}},{key:"drawTiles",value:function(e,t,n,i,r){for(var o=n;o<i;o++)for(var a=e;a<t;a++)void 0!==this.getTile(a,o)&&this.getTile(a,o).render(r,a*di-this.handler.getGameCamera().getxOffset(),o*gi-this.handler.getGameCamera().getyOffset())}},{key:"getTile",value:function(e,t){try{return jn.getTiles()[this.tiles[e][t]]}catch(e){}}},{key:"getWidth",value:function(){return this.width}},{key:"getHeight",value:function(){return this.height}},{key:"getEntityManager",value:function(){return this.entityManager}},{key:"getSpatialGrid",value:function(){return this.spatialGrid}}]),e}(),Oi=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),_i=function(){function e(t){qe(this,e),this.handler=t,this.world=new ki(t)}return Oi(e,[{key:"tick",value:function(e){this.world.tick(e)}},{key:"render",value:function(e){this.world.render(e)}}]),e}(),xi=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Ti=function(){function e(t,n,i){Ue(this,e),this.xOffset=n,this.yOffset=i,this.handler=t}return xi(e,[{key:"centerOnEntity",value:function(e){this.xOffset=e.getX()-this.handler.getWidth()/2+e.getWidth()/2,this.yOffset=e.getY()-this.handler.getHeight()/2+e.getHeight()/2,this.checkBlankSpace()}},{key:"move",value:function(e,t){this.xOffset+=e,this.yOffset+=t,this.checkBlankSpace()}},{key:"getxOffset",value:function(){return parseInt(this.xOffset)}},{key:"getyOffset",value:function(){return parseInt(this.yOffset)}},{key:"setxOffset",value:function(e){this.xOffset=e}},{key:"setyOffset",value:function(e){this.yOffset=e}},{key:"checkBlankSpace",value:function(){this.xOffset<0?this.xOffset=0:this.xOffset>64*this.handler.getWorld().getWidth()-this.handler.getWidth()&&(this.xOffset=64*this.handler.getWorld().getWidth()-this.handler.getWidth()),this.yOffset<0?this.yOffset=0:this.yOffset>64*this.handler.getWorld().getHeight()-this.handler.getHeight()&&(this.yOffset=64*this.handler.getWorld().getHeight()-this.handler.getHeight())}}]),e}(),ji=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Mi=function(){function e(t){Qe(this,e),this.game=t,this.console=document.getElementById("console"),this.devMessage(" dev cheats initialized \n 2 - clipping \n 3 - invincibility \n 4 - super speed \n 1 - all cheats ")}return ji(e,[{key:"devMessage",value:function(e){var t=["background: linear-gradient(#ffffff, #ff00ff)","border: 1px solid #3E0E02","color: black","display: block","line-height: 40px","text-align: center","font-size: 18px","font-weight: bold"].join(";");console.log("%c"+e,t)}},{key:"getWidth",value:function(){return this.game.getWidth()}},{key:"getHeight",value:function(){return this.game.getHeight()}},{key:"getKeyManager",value:function(){return this.game.getKeyManager()}},{key:"getGameCamera",value:function(){return this.game.getGameCamera()}},{key:"getWorld",value:function(){return this.world}},{key:"setWorld",value:function(e){this.world=e}},{key:"getGame",value:function(){return this.game}}]),e}(),Ei=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Pi=[],Si=function(){function e(){Ze(this,e)}return Ei(e,[{key:"tick",value:function(){this.up=Pi[38],this.down=Pi[40],this.left=Pi[37],this.right=Pi[39],this.one=Pi[49],this.two=Pi[50],this.three=Pi[51],this.four=Pi[52],this.a=Pi[65],this.w=Pi[87],this.s=Pi[83],this.d=Pi[68],this.z=Pi[90],this.q=Pi[81],this.enter=Pi[13]}}]),e}();window.onkeydown=function(e){Pi[e.keyCode]=!0},window.onkeyup=function(e){Pi[e.keyCode]=!1};var Ci=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Ii=(function(e){function t(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];return et(this,t),tt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}nt(t,e),Ci(t,[{key:"render",value:function(e){if(e){var t=this.handler.getWidth(),n=this.handler.getHeight();e.fillStyle="black",e.fillRect(0,0,t,n),e.drawText({fillColor:"white",text:"you are",fontSize:32,x:90,y:n/4}),e.drawText({fillColor:"yellow",text:"A L O N E",fontSize:64,x:80,y:n/2}),e.drawText({fillColor:"white",text:"press enter",fontSize:32,x:210,y:n/1.4})}}},{key:"getInput",value:function(e){if(this.handler.getKeyManager().enter){var t=new _i(this.handler);this.handler.getGame().getGameState().setState(t)}}}])}(Wt),function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}()),Wi=function(){function e(t){it(this,e),this.currentState=null,this.handler=t}return Ii(e,[{key:"tick",value:function(e){throw"Every state needs a tick"}},{key:"render",value:function(e){throw"Every state needs a render"}},{key:"getState",value:function(){return this.currentState}},{key:"setState",value:function(e){this.currentState=e}}]),e}(),Li=function(){var e=function(e){return Math.sin(6.283184*e)},t=function(e){return e%1*2-1},n=function(e){return e%1<.5?1:-1},i=function(e){var t=e%1*4;return t<2?t-1:3-t},r=function(e){return.003959503758*Math.pow(2,(e-128)/12)},o=function(e,t,n){var i=a[e.i[0]],o=e.i[1],s=e.i[3],u=a[e.i[4]],h=e.i[5],l=e.i[8],c=e.i[9],f=e.i[10]*e.i[10]*4,p=e.i[11]*e.i[11]*4,y=e.i[12]*e.i[12]*4,d=1/y,g=e.i[13],b=n*Math.pow(2,2-e.i[14]),v=new Int32Array(f+p+y),w=0,m=0,k=void 0,O=void 0,_=void 0,x=void 0,T=void 0,j=void 0,M=void 0;for(k=0,O=0;k<f+p+y;k++,O++)O>=0&&(g=g>>8|(255&g)<<4,O-=b,j=r(t+(15&g)+e.i[2]-128),M=r(t+(15&g)+e.i[6]-128)*(1+8e-4*e.i[7])),_=1,k<f?_=k/f:k>=f+p&&(_-=(k-f-p)*d),x=j,s&&(x*=_*_),w+=x,T=i(w)*o,x=M,l&&(x*=_*_),m+=x,T+=u(m)*h,c&&(T+=(2*Math.random()-1)*c),v[k]=80*T*_|0;return v},a=[e,n,t,i],s=void 0,u=void 0,h=void 0,l=void 0,c=void 0;this.init=function(e){s=e,u=e.endPattern-2,h=0,l=e.rowLen*e.patternLen*(u+1)*2,c=new Int32Array(l)},this.generate=function(){var t=void 0,n=void 0,i=void 0,r=void 0,f=void 0,p=void 0,y=void 0,d=void 0,g=void 0,b=void 0,v=void 0,w=void 0,m=new Int32Array(l),k=s.songData[h],O=s.rowLen,_=s.patternLen,x=0,T=0,j=void 0,M=void 0,E=!1,P=[];for(i=0;i<=u;++i)for(y=k.p[i],r=0;r<_;++r){var S=y?k.c[y-1].f[r]:0;S&&(k.i[S-1]=k.c[y-1].f[r+_]||0,S<16&&(P=[]));var C=a[k.i[15]],I=k.i[16]/512,W=Math.pow(2,k.i[17]-9)/O,L=k.i[18],R=k.i[19],H=43.23529*k.i[20]*3.141592/44100,G=1-k.i[21]/255,A=1e-5*k.i[22],z=k.i[23]/32,D=k.i[24]/512,B=6.283184*Math.pow(2,k.i[25]-9)/O,Y=k.i[26]/255,N=k.i[27]*O;for(v=(i*_+r)*O,f=0;f<4;++f)if(p=y?k.c[y-1].n[r+f*_]:0){P[p]||(P[p]=o(k,p,O));var F=P[p];for(n=0,t=2*v;n<F.length;n++,t+=2)m[t]+=F[n]}for(n=0;n<O;n++)d=2*(v+n),b=m[d],b||E?(w=H,L&&(w*=C(W*d)*I+.5),w=1.5*Math.sin(w),x+=w*T,j=G*(b-T)-x,T+=w*j,b=3==R?T:1==R?j:x,A&&(b*=A,b=b<1?b>-1?e(.25*b):-1:1,b/=A),b*=z,E=b*b>1e-5,g=Math.sin(B*d)*D+.5,M=b*(1-g),b*=g):M=0,d>=N&&(M+=m[d-N+1]*Y,b+=m[d-N]*Y),m[d]=0|M,m[d+1]=0|b,c[d]+=0|M,c[d+1]+=0|b}return++h/8},this.createWave=function(){var e=44+2*l-8,t=e-36,n=new Uint8Array(44+2*l);n.set([82,73,70,70,255&e,e>>8&255,e>>16&255,e>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&t,t>>8&255,t>>16&255,t>>24&255]);for(var i=0,r=44;i<l;++i){var o=c[i];o=o<-32767?-32767:o>32767?32767:o,n[r++]=255&o,n[r++]=o>>8&255}return n},this.getData=function(e,t){for(var n=2*Math.floor(44100*e),i=new Array(t),r=0;r<2*t;r+=1){var o=n+r;i[r]=e>0&&o<c.length?c[o]/32768:0}return i}},Ri=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Hi=(function(){function e(){rt(this,e),this.bgMusic={songData:[{i:[3,59,140,0,1,60,128,3,0,29,92,28,95,0,0,3,96,2,1,2,124,135,11,25,130,4,97,2],p:[1],c:[{n:[112,,,,114,,,,117,,,,114,,,,112,,,,114,,,,117,,,,114,,,,141,,,,,,,,,,,,,,,,138],f:[]}]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]}],rowLen:22050,patternLen:32,endPattern:2},this.loaded=!1,this.lastTime=0,this.logged=0}Ri(e,[{key:"init",value:function(){var e=new Li;e.init(this.bgMusic);var t=!1;setInterval(function(){if(!t&&(t=e.generate()>=1)){var n=e.createWave(),i=document.createElement("audio");i.src=URL.createObjectURL(new Blob([n],{type:"audio/wav"})),i.play(),i.volume=.3,setInterval(function(){var t=i.currentTime;e.getData(t,300)&&0===this.logged&&this.logged++,i.play(),i.loop=!0,this.lastTime=t},16)}},0)}},{key:"tick",value:function(){}},{key:"render",value:function(){}}])}(),function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}()),Gi=!1,Ai=void 0,zi=void 0,Di=void 0,Bi=void 0,Yi=void 0,Ni=void 0,Fi=void 0;new(function(){function e(t,n,i){ot(this,e),this.height=i,this.title=t,this.width=n}return Hi(e,[{key:"run",value:function(){var e=this;this.init();var t=0,n=0,i=Date.now(),r=Date.now(),o=0;!function a(){Gi&&(i=Date.now(),t=i-r,o+=t,r=i),o>=1e3/60&&(n=o/1e3,e.tick(n),e.render(),o=0),window.requestAnimationFrame(a)}()}},{key:"start",value:function(){Gi||(Gi=!0,this.run())}},{key:"getSoundManager",value:function(){}},{key:"getKeyManager",value:function(){return Di}},{key:"getDisplay",value:function(){return zi}},{key:"getWidth",value:function(){return this.width}},{key:"getHeight",value:function(){return this.height}},{key:"getGameCamera",value:function(){return Yi}},{key:"getGameState",value:function(){return Ni}},{key:"init",value:function(){Bi=new Mi(this),zi=new ut(this.title,this.width,this.height),Di=new Si,Ai=zi.getGraphics(),Ni=new Wi,Yi=new Ti(Bi,0,0),Fi=new _i(Bi),Ni.setState(Fi)}},{key:"tick",value:function(e){Di.tick(),Ni.getState()&&!zi.paused&&Ni.getState().tick(e)}},{key:"render",value:function(){Ni.getState()&&!zi.paused&&Ni.getState().render(Ai)}}]),e}())("Lost!",448,448).start();var Xi=n(1);n.n(Xi)},function(e,t){}]);</script></body>

</html>

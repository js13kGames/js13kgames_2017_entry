<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
<style type="text/css">body,html{background-color:#000;height:100%;margin:0;padding:0;width:100%}#canvas{background-color:inherit;border-radius:235px;margin:-336px 0 0 -224px}#canvas,.speech{left:50%;position:fixed;top:50%;z-index:100}.speech{font-family:Arial,"serif";line-height:36px;font-size:26px;height:224px;padding:20px}#dialogue{color:#fff;margin:112px 0 0 -190px;width:600px}#speaker{color:#ff0;margin:112px 0 0 -425px;text-align:right;width:200px}</style></head>

<body>
    <canvas id="canvas"></canvas>

    <div id="dialogue" class="speech"></div>

    <div id="speaker" class="speech"></div>
<script type="text/javascript">!function(t){function e(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var n={};e.m=t,e.c=n,e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function h(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function l(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function c(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function f(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function p(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function y(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function d(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function g(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function v(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function w(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function b(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function m(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function k(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function O(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function x(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function M(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function j(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function E(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function T(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function C(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function P(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function S(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function I(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function W(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function A(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function G(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function L(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function z(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function R(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function H(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function B(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function Y(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function D(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function X(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function F(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function K(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function N(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function U(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function q(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function J(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function Q(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function V(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Z(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function $(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function tt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function et(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function nt(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function it(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function rt(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function ot(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function at(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function st(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function ht(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function ut(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function lt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ct(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function ft(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function pt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function yt(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function dt(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function gt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function vt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function wt(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function bt(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function mt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function kt(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function Ot(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function xt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Mt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function jt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Et(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Tt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ct(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Pt(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function St(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function It(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Wt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function At(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var Gt=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),Lt=null,zt=function(){function t(e,n,r){i(this,t),this.title=e,this.width=n,this.height=r,this.paused=!1,this.createDisplay()}return Gt(t,[{key:"createDisplay",value:function(){document.title=this.title;var t=document.getElementById("canvas");t.setAttribute("height",this.height),t.setAttribute("width",this.width),Lt=t.getContext("2d"),Lt.webkitImageSmoothingEnabled=!1,Lt.mozImageSmoothingEnabled=!1,Lt.imageSmoothingEnabled=!1,this.setEventListeners()}},{key:"setEventListeners",value:function(){window.onblur=this.pause,window.onfocus=this.unPause}},{key:"pause",value:function(){this.paused=!0}},{key:"unPause",value:function(){this.paused=!1}},{key:"getTitle",value:function(){return this.title}},{key:"getWidth",value:function(){return this.width}},{key:"getHeight",value:function(){return this.height}},{key:"getGraphics",value:function(){return Lt}}]),t}();CanvasRenderingContext2D.prototype.myDrawImage=function(t,e,n,i,r){Lt.drawImage(t.sheet,t.x,t.y,t.width,t.height,e,n,i,r)},CanvasRenderingContext2D.prototype.drawText=function(t){Lt.font=t.fontSize+"px Arial",Lt.fillStyle=t.fillColor,Lt.strokeText(t.text,t.x,t.y),Lt.fillText(t.text,t.x,t.y)};var Rt=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),Ht=function(){function t(e,n,i,o){r(this,t),this.x=e,this.y=n,this.width=i,this.height=o}return Rt(t,[{key:"intersects",value:function(t){return this.x<t.x+t.width&&this.x+this.width>t.x&&this.y<t.y+t.height&&this.y+this.height>t.y}}]),t}(),Bt=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),Yt=void 0,Dt=void 0,Xt=void 0,Ft=function(t,e){var n=t.getY(),i=e.getY(),r=t.getHeight(),o=e.getHeight();return n+r===i+o?0:n+r<i+o?-1:1},Kt=function(){function t(e,n){o(this,t),Yt=e,Dt=n,Xt=new Array(Dt)}return Bt(t,[{key:"tick",value:function(t){Xt.sort(Ft);for(var e=0;e<Xt.length;e++){Xt[e].tick(t)}}},{key:"render",value:function(t){Xt.forEach(function(e){e.handler.getWidth()+e.handler.getGameCamera().getxOffset()&&e.handler.getHeight()+e.handler.getGameCamera().getyOffset()&&e.handler.getGameCamera().getxOffset()-e.width&&e.handler.getGameCamera().getyOffset()-e.height&&e.render(t)})}},{key:"getPlayer",value:function(){return Dt}},{key:"getHandler",value:function(){return Yt}},{key:"getEntities",value:function(){return Xt}},{key:"addEntity",value:function(t){Xt.push(t),Yt.getWorld().getSpatialGrid().insert(new Ht(t.x+t.bounds.x,t.y+t.bounds.y,t.bounds.width,t.bounds.height),t)}},{key:"removeEntitiesByType",value:function(t){Xt=Xt.filter(function(e){if(e.type!==t)return e;Yt.getWorld().getSpatialGrid().remove(new Ht(e.x+e.bounds.x,e.y+e.bounds.y,e.bounds.width,e.bounds.height),e)})}}]),t}(),Nt=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),Ut=function(){function t(e){a(this,t),this.frames=e,this.index=0,this.lastTime=Date.now(),this.timer=0,this.speed=1e3}return Nt(t,[{key:"tick",value:function(){this.timer+=Date.now()-this.lastTime,this.lastTime=Date.now(),this.timer>=this.speed&&(this.index++,this.timer=0,this.index>=this.frames.length&&(this.index=0))}},{key:"getCurrentFrame",value:function(){return this.speed=this.frames[this.index].speed,this.frames[this.index].frame}}]),t}(),qt=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),Jt=function(){function t(){s(this,t)}return qt(t,null,[{key:"loadImage",value:function(t){var e=new Image;return e.src=t,e}}]),t}(),Qt=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),Vt=function(){function t(e){h(this,t),this.sheet=e}return Qt(t,[{key:"crop",value:function(t,e,n,i){return{sheet:this.sheet,x:t,y:e,width:n,height:i}}}]),t}(),Zt=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),$t={},te=window.location.href.replace("index.html","")+"src/res/",ee=function(){function t(e,n,i,r){u(this,t),$t[e]=this,this.name=e,this.path=n,this.width=i,this.height=r,this.sheet=new Vt(Jt.loadImage(this.path)),this.animations={}}return Zt(t,[{key:"addAnimation",value:function(t,e){this.animations[t]=e}},{key:"getWidth",value:function(){return 16}},{key:"getHeight",value:function(){return 16}}],[{key:"getAssets",value:function(t){return $t[t]}}]),t}(),ne=function(t,e,n){return t.sheet.crop(16*e,16*n,16,16)},ie=new ee("tiles",te+"tiles.png",16,16);ie.path=ne(ie,1,0),ie.pathBlue=ne(ie,1,2),ie.pathGreen=ne(ie,2,2),ie.pathYellow=ne(ie,0,2),ie.wall=ne(ie,0,0),ie.wallBlue=ne(ie,1,1),ie.wallGreen=ne(ie,2,1),ie.wallYellow=ne(ie,0,1),ie.switchGreen=ne(ie,2,0),ie.switchBlue=ne(ie,3,0),ie.exit=ne(ie,3,1),ie.lantern=ne(ie,3,2);var re=new ee("sprites",te+"sprites.png",16,18),oe=new ee("creature",te+"creature.png",16,18),ae=function(t){for(var e=[],n=[],i=[],r=[],o=[],a=0;a<3;a++)i.push({frame:t.sheet.crop(t.width*a,0*t.height,t.width,t.height),speed:200}),e.push({frame:t.sheet.crop(t.width*a,1*t.height+1,t.width,t.height),speed:200}),r.push({frame:t.sheet.crop(t.width*a,2*t.height+1,t.width,t.height),speed:200}),n.push({frame:t.sheet.crop(t.width*a,3*t.height+1,t.width,t.height),speed:200}),o.push({frame:t.sheet.crop(t.width*a,4*t.height,t.width,t.height),speed:500});var s=[{frame:t.sheet.crop(0,2*t.height,t.width,t.height),speed:200},{frame:t.sheet.crop(1*t.width,2*t.height,t.width,t.height),speed:200},{frame:t.sheet.crop(2*t.width,2*t.height,t.width,t.height),speed:200}];t.addAnimation("walk_up",new Ut(i)),t.addAnimation("walk_right",new Ut(e)),t.addAnimation("walk_down",new Ut(r)),t.addAnimation("walk_left",new Ut(n)),t.addAnimation("idle",new Ut(s)),t.addAnimation("death",new Ut(o))};ae(re),ae(oe);var se=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),he=function(){function t(e){l(this,t),this.handler=e,this.countSinceInput=0}return se(t,[{key:"tick",value:function(t){this.countSinceInput++,this.countSinceInput>8&&this.getInput(t),this.render()}},{key:"render",value:function(){alert("all menus need a render!")}},{key:"getInput",value:function(){alert("all menus need getInput!")}}]),t}(),ue=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),le=function(t){function e(t){return c(this,e),f(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return p(e,t),ue(e,[{key:"render",value:function(t){if(t){var e=this.handler.getWidth(),n=this.handler.getHeight();t.fillStyle="black",t.fillRect(0,0,e,n);var i="You escaped the maze!",r=e/2-t.measureText(i).width/2,o=n/3;t.drawText({fillColor:"yellow",text:i,fontSize:32,x:r,y:o}),i="Press enter for another run!",r=e/2-t.measureText(i).width/2,o=n/1.5,t.drawText({fillColor:"white",text:i,fontSize:32,x:r,y:o})}}},{key:"getInput",value:function(){this.handler.getKeyManager().enter&&window.location.reload()}}]),e}(he),ce=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),fe=function(t){function e(t){return y(this,e),d(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return g(e,t),ce(e,[{key:"render",value:function(t){if(t){var e=this.handler.getWidth(),n=this.handler.getHeight();t.fillStyle="black",t.fillRect(0,0,e,n);var i="Y O U   D I E D",r=e/2-t.measureText(i).width/2,o=n/3;t.drawText({fillColor:"red",text:i,fontSize:32,x:r,y:o}),i="press enter to try again",r=e/2-t.measureText(i).width/2,o=n/1.5,t.drawText({fillColor:"white",text:i,fontSize:32,x:r,y:o})}}},{key:"getInput",value:function(){this.handler.getKeyManager().enter&&window.location.reload()}}]),e}(he),pe=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),ye=function(){function t(e,n,i,r,o){v(this,t),this.x=n,this.y=i,this.width=r,this.height=o,this.handler=e,this.bounds=new Ht(0,0,r,o),this.target=null}return pe(t,[{key:"tick",value:function(t){throw"Entities must have a tick function!"}},{key:"render",value:function(t){throw"Entities must have a render function!"}},{key:"getX",value:function(){return this.x}},{key:"getY",value:function(){return this.y}},{key:"getWidth",value:function(){return this.width}},{key:"getHeight",value:function(){return this.height}},{key:"getCollisionBounds",value:function(t,e){return new Ht(parseInt(this.x+this.bounds.x+t),parseInt(this.y+this.bounds.y+e),this.bounds.width,this.bounds.height)}},{key:"checkEntityCollisions",value:function(t,e){for(var n=this.handler.getWorld().getSpatialGrid().retrieve(new Ht(this.x+this.bounds.x+t,this.y+this.bounds.y+e,this.bounds.width,this.bounds.height),this),i=0;i<n.length;i++){var r=n[i];if(r.getCollisionBounds(0,0).intersects(this.getCollisionBounds(t,e)))return this.checkForCollisionEvents(this,r),!0}return!1}},{key:"checkForCollisionEvents",value:function(t,e){if(!this.checkCollidingTypes(t,e,"monster","monster")){if(this.checkCollidingTypes(t,e,"switch","player")&&("switch"===t.type?t.toggleSwitch():e.toggleSwitch()),this.checkCollidingTypes(t,e,"player","exit")){if(this.handler.getWorld().level>=4){var n=new le(this.handler);this.handler.getGame().getGameState().setState(n)}return void this.handler.getWorld().changeLevel()}if(this.checkCollidingTypes(t,e,"player","monster")){if(t.invincible||e.invincible)return;var i=new fe(t.handler);t.handler.getGame().getGameState().setState(i)}}}},{key:"checkCollidingTypes",value:function(t,e,n,i){return t.type===n&&e.type===i||t.type===i&&e.type===n}},{key:"setX",value:function(t){this.x=t}},{key:"setY",value:function(t){this.y=t}},{key:"setWidth",value:function(t){this.width=t}},{key:"setHeight",value:function(t){this.height=t}}]),t}(),de=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),ge=100,ve=200,we=64,be=64,me=function(t){function e(t,n,i){w(this,e);var r=b(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,i,we,be));return r.health=ve,r.speed=ge,r.xMove=0,r.yMove=0,r}return m(e,t),de(e,[{key:"tick",value:function(){this.yMove<0&&this.assets.animations.walk_up.tick(),this.yMove>0&&this.assets.animations.walk_down.tick(),this.xMove>0&&this.assets.animations.walk_right.tick(),this.xMove<0&&this.assets.animations.walk_left.tick()}},{key:"move",value:function(){(Math.abs(this.xMove)>0||Math.abs(this.yMove)>0)&&(this.handler.getWorld().getSpatialGrid().remove(new Ht(this.x+this.bounds.x,this.y+this.bounds.y,this.bounds.width,this.bounds.height),this),this.checkEntityCollisions(this.xMove,0)||this.moveX(),this.checkEntityCollisions(0,this.yMove)||this.moveY(),this.handler.getWorld().getSpatialGrid().insert(new Ht(this.x+this.bounds.x,this.y+this.bounds.y,this.bounds.width,this.bounds.height),this))}},{key:"moveX",value:function(){if(this.clipping)return void(this.x+=this.xMove);var t=this.xMove>0?parseInt((this.x+this.xMove+this.bounds.x+this.bounds.width)/64):parseInt((this.x+this.xMove+this.bounds.x)/64),e=parseInt((this.y+this.bounds.y)/64),n=parseInt((this.y+this.bounds.y+this.bounds.height)/64),i=this.xMove>0?64*t-this.bounds.x-this.bounds.width-1:64*t+64-this.bounds.x;this.collisionWithTile(t,e)||this.collisionWithTile(t,n)?this.x=i:this.x+=this.xMove}},{key:"moveY",value:function(){if(this.clipping)return void(this.y+=this.yMove);var t=this.yMove>0?parseInt((this.y+this.yMove+this.bounds.y+this.bounds.height)/64):parseInt((this.y+this.yMove+this.bounds.y)/64),e=parseInt((this.x+this.bounds.x)/64),n=parseInt((this.x+this.bounds.x+this.bounds.width)/64),i=this.yMove>0?64*t-this.bounds.y-this.bounds.height-1:64*t+64-this.bounds.y;this.collisionWithTile(e,t)||this.collisionWithTile(n,t)?this.y=i:this.y+=this.yMove}},{key:"collisionWithTile",value:function(t,e){try{return this.handler.getWorld().getTile(t,e).isSolid}catch(t){}}},{key:"getCurrentAnimationFrame",value:function(){return this.yMove<0?(this.lastAnimation="walk_up",this.assets.animations.walk_up.getCurrentFrame()):this.yMove>0?(this.lastAnimation="walk_down",this.assets.animations.walk_down.getCurrentFrame()):this.xMove<0?(this.lastAnimation="walk_left",this.assets.animations.walk_left.getCurrentFrame()):this.xMove>0?(this.lastAnimation="walk_right",this.assets.animations.walk_right.getCurrentFrame()):this.assets.animations[this.lastAnimation].getCurrentFrame()}}]),e}(ye),ke=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),Oe=function t(e,n,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,n);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,i)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(i)},xe=64,_e=64,Me=function(t){function e(t,n,i){k(this,e);var r=O(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,i,xe,_e));return r.assets=ee.getAssets("creature"),r.x=n,r.y=i,r.spawnX=n,r.spawnY=i,r.bounds.x=10,r.bounds.y=10,r.bounds.width=xe-2*r.bounds.x,r.bounds.height=_e-2*r.bounds.y,r.type="monster",r.patrol=r.getPatrolPattern(),r.startX=n,r.startY=i,r.patrolLength=100,r.dirMoving=0,r.numberOfMoves=0,r.lastAnimation="walk_down",r}return x(e,t),ke(e,[{key:"getPatrolPattern",value:function(){var t=["vertical","horizontal"];return t[Math.floor(Math.random()*t.length)]}},{key:"maybeChangePatrol",value:function(){Math.random()<.41&&(this.patrol="vertical"===this.patrol?"horizontal":"vertical")}},{key:"checkIfOffMap",value:function(){var t=this.handler.getWorld().getWorldWidth()*xe,e=this.handler.getWorld().getWorldHeight()*_e;(this.x<1||this.y<1||this.x>t||this.y>e)&&(this.x=this.spawnX,this.y=this.spawnY)}},{key:"setPatrolMovement",value:function(t){"vertical"===this.patrol?(0===this.dirMoving?this.yMove=-this.speed*t:this.yMove=this.speed*t,++this.numberOfMoves>this.patrolLength&&(this.dirMoving=0===this.dirMoving?1:0,this.numberOfMoves=0,this.maybeChangePatrol())):"horizontal"===this.patrol&&(0===this.dirMoving?this.xMove=-this.speed*t:this.xMove=this.speed*t,++this.numberOfMoves>this.patrolLength&&(this.dirMoving=0===this.dirMoving?1:0,this.numberOfMoves=0,this.maybeChangePatrol()))}},{key:"checkIfInWall",value:function(){var t=Math.round(this.x/xe),e=Math.round(this.y/_e);if(this.handler.getWorld().getTile(t,e).isSolid)for(var n=t-1,i=e-1,r=t+1,o=e+1,a=i;a<o;a++)for(var s=n;s<r;s++)if(!this.handler.getWorld().getTile(s,a).isSolid&&(s===t||a===e))return this.x=s*xe,void(this.y=a*_e)}},{key:"tick",value:function(t){this.checkIfOffMap(),this.checkIfInWall(),this.setPatrolMovement(t),Oe(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"tick",this).call(this),this.move()}},{key:"render",value:function(t){t.myDrawImage(this.getCurrentAnimationFrame(),this.x-this.handler.getGameCamera().getxOffset(),this.y-this.handler.getGameCamera().getyOffset(),this.width,this.height)}}]),e}(me),je=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),Ee=[],Te=[],Ce=[2,3,7],Pe=0,Se=0,Ie=function(t,e){return 0===t||0===e||t===Pe-1||e===Se-1?1:Math.floor(20*Math.random())<15?1:Ce[Math.floor(Math.random()*Ce.length)]},We=function(){function t(){_(this,t)}return je(t,null,[{key:"createMaze",value:function(){for(var t=[],e=0;e<Se;e++){Ee[e]=[];for(var n=0;n<Pe;n++)Ee[e][n]=1}var i=1,r=1;Ee[i][r]=0,t.push(r+r*Pe);do{if(t.length){var o="";if(i+2>0&&i+2<Se-1&&1==Ee[i+2][r]&&(o+="S"),i-2>0&&i-2<Se-1&&1==Ee[i-2][r]&&(o+="N"),r-2>0&&r-2<Pe-1&&1==Ee[i][r-2]&&(o+="W"),r+2>0&&r+2<Pe-1&&1==Ee[i][r+2]&&(o+="E"),o){var a=Math.floor(Math.random()*o.length);switch(o[a]){case"N":Ee[i-2][r]=0,Ee[i-1][r]=0,i-=2;break;case"S":Ee[i+2][r]=0,Ee[i+1][r]=0,i+=2;break;case"W":Ee[i][r-2]=0,Ee[i][r-1]=0,r-=2;break;case"E":Ee[i][r+2]=0,Ee[i][r+1]=0,r+=2}t.push(r+i*Pe)}else{var s=t.pop();i=Math.floor(s/Pe),r=s%Pe}this.buildFinalMaze(i,r)}}while(t.length)}},{key:"buildFinalMaze",value:function(){for(var t=0;t<Se;t++)for(var e=0;e<Pe;e++)Te[e]||(Te[e]=[]),Te[e][t]=1===Ee[t][e]?Ie(t,e):0}},{key:"createRooms",value:function(){this.createRoom(1,1,3),this.createRoom(1,Se-4,3),this.createRoom(Pe-4,Se-4,3),this.createRoom(Pe-4,1,3)}},{key:"createRoom",value:function(t,e,n){for(var i=e;i<e+n;i++)for(var r=t;r<t+n;r++)Te[r][i]=0}},{key:"createBarriers",value:function(t){2!==t&&(Te[1][Math.ceil(Se/2)]=1,Te[1][Math.ceil(Se/2)+1]=1,Te[Pe-2][Math.ceil(Se/2)]=1,Te[Pe-2][Math.ceil(Se/2)+1]=1,Te[Math.ceil(Pe/2)][1]=1,Te[Math.ceil(Pe/2)+1][1]=1,Te[Math.ceil(Pe/2)][Se-2]=1,Te[Math.ceil(Pe/2)+1][Se-2]=1)}},{key:"getIntroMaze",value:function(){return[[1,1,1,1,1,1,1],[1,0,0,0,0,0,1],[1,0,0,1,0,0,1],[1,0,1,1,1,0,1],[1,0,0,1,0,0,1],[1,0,0,0,0,0,1],[1,1,1,1,1,1,1]]}},{key:"getRandomMaze",value:function(t,e,n){return 1===t?{mazeWidth:7,mazeHeight:7,spawnX:1,spawnY:1,pieces:this.getIntroMaze()}:(Pe=Se=10*t-1,this.createMaze(),this.createRooms(),this.createBarriers(t),{mazeWidth:Pe,mazeHeight:Se,spawnX:e,spawnY:n,pieces:Te})}}]),t}(),Ae=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),Ge=function t(e,n,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,n);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,i)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(i)},Le=!1,ze=0,Re=function(t){function e(t,n,i){M(this,e);var r=j(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,i));return r.assets=ee.getAssets("sprites"),r.x=n,r.y=i,r.speed=140,r.bounds.x=14,r.bounds.y=24,r.bounds.width=36,r.bounds.height=39,r.type="player",r.clipping=!1,r.invincible=!1,r.superSpeed=!1,r.allCheats=!1,r.lastAnimation="walk_down",r}return E(e,t),Ae(e,[{key:"tick",value:function(t){this.xMove=this.yMove=0,this.getInput(t),Ge(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"tick",this).call(this,t),this.move(),this.superSpeed&&(this.move(),this.move()),this.handler.getGameCamera().centerOnEntity(this)}},{key:"render",value:function(t){t.myDrawImage(this.getCurrentAnimationFrame(),this.x-this.handler.getGameCamera().getxOffset(),this.y-this.handler.getGameCamera().getyOffset(),64,64)}},{key:"getInput",value:function(t){var e=this.handler.getKeyManager();if((e.up||e.w||e.z)&&(this.yMove=-this.speed*t),(e.down||e.s)&&(this.yMove=this.speed*t),(e.left||e.a||e.q)&&(this.xMove=-this.speed*t),(e.right||e.d)&&(this.xMove=this.speed*t),Le||ze++,ze>15||Le){if(Le=!0,ze=0,e.one){var n=this.allCheats?" ALL CHEATS disabled ":" ALL CHEATS enabled ";this.handler.devMessage(n),this.allCheats=!this.allCheats,this.clipping=this.allCheats,this.invincible=this.allCheats,this.superSpeed=this.allCheats,Le=!1}if(e.three){var i=this.invincible?" invincibility disabled ":" invincibility enabled ";this.handler.devMessage(i),this.invincible=!this.invincible,Le=!1}if(e.two){var r=this.clipping?" clipping disabled ":" clipping enabled ";this.handler.devMessage(r),this.clipping=!this.clipping,Le=!1}if(e.four){var o=this.superSpeed?" super speed disabled ":" super speed enabled ";this.handler.devMessage(o),this.superSpeed=!this.superSpeed,Le=!1}}}}]),e}(me),He=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),Be=function(){function t(e,n,i){T(this,t),this.width=parseInt(e/i),this.height=parseInt(n/i),this.size=i,this.grid=[];for(var r=0;r<=this.width;r++){this.grid[r]=[];for(var o=0;o<=this.height;o++)this.grid[r][o]=[]}}return He(t,[{key:"insert",value:function(t,e){for(var n=Math.max(0,parseInt(t.x/this.size)),i=Math.max(0,parseInt(t.y/this.size)),r=Math.min(this.width,parseInt((t.x+t.width)/this.size)),o=Math.min(this.height,parseInt((t.y+t.height)/this.size)),a=i;a<=o;a++)for(var s=n;s<=r;s++)-1===this.grid[s][a].indexOf(e)&&this.grid[s][a].push(e)}},{key:"retrieve",value:function(t,e){for(var n=Math.max(0,parseInt(t.x/this.size)),i=Math.max(0,parseInt(t.y/this.size)),r=Math.min(this.width,parseInt((t.x+t.width)/this.size)),o=Math.min(this.height,parseInt((t.y+t.height)/this.size)),a=[],s=i;s<=o;s++)for(var h=n;h<=r;h++)this.grid[h][s].forEach(function(t){t!==e&&-1===a.indexOf(t)&&a.push(t)});return a}},{key:"remove",value:function(t,e){for(var n=Math.max(0,parseInt(t.x/this.size)),i=Math.max(0,parseInt(t.y/this.size)),r=Math.min(this.width,parseInt((t.x+t.width)/this.size)),o=Math.min(this.height,parseInt((t.y+t.height)/this.size)),a=i;a<=o;a++)for(var s=n;s<=r;s++)for(var h=0;h<this.grid[s][a].length;h++)this.grid[s][a][h]===e&&this.grid[s][a].splice(h,1)}},{key:"getWidth",value:function(){return this.width}},{key:"getHeight",value:function(){return this.height}},{key:"getSize",value:function(){return this.size}}]),t}(),Ye=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),De=function(){function t(e,n){C(this,t),this.isSolid=!1,this.texture=e,this.id=n,this.assets=ee.getAssets("tiles")}return Ye(t,[{key:"render",value:function(t,e,n){t.myDrawImage(this.texture,e,n,64,64)}},{key:"getId",value:function(){return this.id}}]),t}(),Xe=(function(t){function e(t){P(this,e);var n=S(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,ee.getAssets("tiles").exit,t));return n.isSolid=!0,n.type="exit",n}I(e,t)}(De),function(t){function e(t){return W(this,e),A(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,ee.getAssets("tiles").path,t))}return G(e,t),e}(De)),Fe=function(t){function e(t){return L(this,e),z(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,ee.getAssets("tiles").pathBlue,t))}return R(e,t),e}(De),Ke=function(t){function e(t){return H(this,e),B(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,ee.getAssets("tiles").pathYellow,t))}return Y(e,t),e}(De),Ne=function(t){function e(t){D(this,e);var n=X(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,ee.getAssets("tiles").wall,t));return n.isSolid=!0,n}return F(e,t),e}(De),Ue=function(t){function e(t){K(this,e);var n=N(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,ee.getAssets("tiles").wallBlue,t));return n.isSolid=!0,n}return U(e,t),e}(De),qe=function(t){function e(t){q(this,e);var n=J(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,ee.getAssets("tiles").wallYellow,t));return n.isSolid=!0,n}return Q(e,t),e}(De),Je=(function(t){function e(t){V(this,e);var n=Z(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,ee.getAssets("tiles").switchBlue,t));return n.isSolid=!0,n.type="switch",n.color="blue",n}$(e,t)}(De),function(t){function e(t){return tt(this,e),et(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,ee.getAssets("tiles").pathGreen,t))}return nt(e,t),e}(De)),Qe=function(t){function e(t){it(this,e);var n=rt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,ee.getAssets("tiles").wallGreen,t));return n.isSolid=!0,n}return ot(e,t),e}(De),Ve=(function(t){function e(t){at(this,e);var n=st(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,ee.getAssets("tiles").switchGreen,t));return n.isSolid=!0,n.type="switch",n.color="green",n}ht(e,t)}(De),function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}()),Ze=ee.getAssets("tiles"),$e=[];$e[0]=new Xe(0),$e[1]=new Ne(1),$e[2]=new qe(2),$e[3]=new Ue(3),$e[4]=new Ke(4),$e[5]=new Fe(5),$e[7]=new Je(7),$e[8]=new Qe(8);var tn=function(){function t(){ut(this,t)}return Ve(t,null,[{key:"getAssets",value:function(){return Ze}},{key:"getTiles",value:function(){return $e}}]),t}(),en=function(t){function e(t,n,i,r,o){return lt(this,e),ct(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,i,r,o))}return ft(e,t),e}(ye),nn=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),rn=64,on=64,an=function(t){function e(t,n,i,r,o){pt(this,e);var a=yt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,i,r,o));return a.manager=a.handler.getWorld().getLightManager(),a.posX=Math.floor(n/rn),a.posY=Math.floor(i/on),a.bounds.x=0,a.bounds.y=0,a.bounds.width=0,a.bounds.height=0,a.flickering=!1,a.lastFlickerCounter=0,a.flickerToggle=0,a.flickerCount=0,a.flickerTimes=0,a.flickerLength=0,a.assets=ee.getAssets("tiles"),a.type="light",a.init(),a}return dt(e,t),nn(e,[{key:"init",value:function(){this.makeSureOnWall(),this.expandLight()}},{key:"makeSureOnWall",value:function(){var t=this.posX,e=this.posY;if(1!==this.handler.getWorld().getTile(t,e).id)for(var n=e-1;n<e+1;n++)for(var i=t-1;i<t+1;i++)if(1===this.handler.getWorld().getTile(i,n).id)return this.posX=i,void(this.posY=n)}},{key:"expandLight",value:function(){for(var t=-2;t<3;t++)for(var e=-2;e<3;e++)this.manager.lightMap[this.posX+e][this.posY+t]=Math.min(this.manager.lightMap[this.posX+e][this.posY+t],.65);for(var n=-1;n<2;n++)for(var i=-1;i<2;i++)this.manager.lightMap[this.posX+i][this.posY+n]=Math.min(this.manager.lightMap[this.posX+i][this.posY+n],.5);this.manager.lightMap[this.posX][this.posY]=.3}},{key:"dimLights",value:function(t){for(var e=-2;e<3;e++)for(var n=-2;n<3;n++)this.manager.lightMap[this.posX+n][this.posY+e]=Math.min(.75,.65+t);for(var i=-1;i<2;i++)for(var r=-1;r<2;r++)this.manager.lightMap[this.posX+r][this.posY+i]=Math.min(.75,.5+t);this.manager.lightMap[this.posX][this.posY]=Math.min(.75,.3+t)}},{key:"chanceToFlicker",value:function(){Math.random()<.85||(this.lastFlickerCounter=0,this.flickerLength=Math.floor(5*Math.random())+4,this.flickering=!0)}},{key:"flickerLights",value:function(){0===this.flickerCount&&(0===this.flickerToggle?(this.dimLights(.25),this.flickerToggle=1):(this.expandLight(),this.flickerToggle=0)),this.flickerCount++,this.flickerCount>=this.flickerLength&&(this.flickerCount=0,this.flickerTimes++),this.flickerTimes>=6&&(this.flickerTimes=0,this.flickering=!1)}},{key:"tick",value:function(){this.flickering?this.flickerLights():++this.lastFlickerCounter>240&&this.chanceToFlicker()}},{key:"render",value:function(t){var e=this.x-this.handler.getGameCamera().getxOffset(),n=this.y-this.handler.getGameCamera().getyOffset();t.myDrawImage(this.assets.lantern,e,n,this.width,this.height)}}]),e}(en),sn=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),hn=function(){function t(e){gt(this,t),this.handler=e,this.init()}return sn(t,[{key:"init",value:function(){this.sources=[],this.lightMap=[],this.fillLightMap()}},{key:"fillLightMap",value:function(){for(var t=this.handler.getWorld().getWorldWidth(),e=this.handler.getWorld().getWorldHeight(),n=0;n<e;n++)for(var i=0;i<t;i++)this.lightMap[i]||(this.lightMap[i]=[]),this.lightMap[i][n]=.85}},{key:"tick",value:function(){this.sources.forEach(function(t){t.tick()})}},{key:"render",value:function(t,e,n,i,r){this.sources.forEach(function(t){t.render(r)}),this.drawLightBlocks(t,e,n,i,r)}},{key:"drawLightBlocks",value:function(t,e,n,i,r){r.fillStyle="black";for(var o=n;o<i;o++)for(var a=t;a<e;a++){var s=this.handler.getWorld().getTile(a,o).type;r.globalAlpha="switch"===s||"exit"===s?.3:this.lightMap[a][o],r.fillRect(64*a-this.handler.getGameCamera().getxOffset(),64*o-this.handler.getGameCamera().getyOffset(),64,64)}r.globalAlpha=1}},{key:"addSource",value:function(t,e){var n=new an(this.handler,64*t,64*e,64,64,this);this.handler.getWorld().getEntityManager().addEntity(n),this.sources.push(n)}},{key:"setLight",value:function(t,e,n){this.lightMap[t][e]=n}},{key:"removeSources",value:function(){this.handler.getWorld().getEntityManager().removeEntitiesByType("light"),this.sources=[]}}]),t}(),un=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),ln=function(t){function e(t,n,i,r,o){vt(this,e);var a=wt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,i,r,o));return a.assets=ee.getAssets("tiles"),a.type="exit",a.bounds.x=15,a.bounds.y=15,a.bounds.width=a.width-30,a.bounds.height=a.height-30,a}return bt(e,t),un(e,[{key:"tick",value:function(){}},{key:"render",value:function(t){t.myDrawImage(this.assets.exit,this.x-this.handler.getGameCamera().getxOffset(),this.y-this.handler.getGameCamera().getyOffset(),this.width,this.height)}}]),e}(en),cn=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),fn=60,pn=function(t){function e(t,n,i,r,o){mt(this,e);var a=kt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,i,r,o));return a.assets=ee.getAssets("tiles"),a.type="switch",a.bounds.x=5,a.bounds.y=25,a.bounds.width=a.width-18,a.bounds.height=a.height-35,a.currentSwitch=a.assets.switchGreen,a}return Ot(e,t),cn(e,[{key:"tick",value:function(){fn++}},{key:"toggleSwitch",value:function(){fn<40||(this.currentSwitch===this.assets.switchGreen?(this.currentSwitch=this.assets.switchBlue,this.color="blue"):(this.currentSwitch=this.assets.switchGreen,this.color="green"),this.handler.getWorld().swapGreenAndBlueTiles(this.color),fn=0)}},{key:"render",value:function(t){t.myDrawImage(this.currentSwitch,this.x-this.handler.getGameCamera().getxOffset(),this.y-this.handler.getGameCamera().getyOffset(),this.width,this.height)}}]),e}(en),yn=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),dn=document.getElementById("dialogue"),gn=document.getElementById("speaker"),vn=5,wn=0,bn=function(){function t(){xt(this,t),this.init(),this.words=[],this.speakers=[]}return yn(t,[{key:"init",value:function(){}},{key:"tick",value:function(){vn>=3&&this.words.length&&(this.words[0].length?this.speakNextLetter():wn>=90?this.resetForNextSentence():wn++),vn<30&&vn++}},{key:"resetForNextSentence",value:function(){this.words.splice(0,1),this.speakers.splice(0,1),dn.innerHTML="",gn.innerHTML="",wn=0}},{key:"speakNextLetter",value:function(){gn.innerHTML=this.speakers[0]+":",dn.innerHTML+=this.words[0][0],this.words[0].splice(0,1),vn=0}},{key:"addWords",value:function(t,e){this.words.push(e.split("")),this.speakers.push(t)}}]),t}(),mn=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),kn=64,On=64,xn=!1,_n=!1,Mn=0,jn=0,En=function(){function t(e){_t(this,t),this.width=null,this.height=null,this.tiles=[],this.handler=e,e.setWorld(this),this.entityManager=new Kt(e,new Re(e,20,20)),this.spatialGrid=new Be(this.handler.getWidth()*kn,this.handler.getHeight()*On,64),this.level=1,this.loadWorld(),this.lightManager=new hn(e),this.dialogue=new bn,this.init()}return mn(t,[{key:"getLightManager",value:function(){return this.lightManager}},{key:"changeLevel",value:function(){this.setPlayerSpawn(this.spawnX,this.spawnY),this.level+=1,this.tiles=[],jn=0,_n=!1,this.lightManager.removeSources(),this.entityManager.removeEntitiesByType("exit"),this.loadWorld(),this.init()}},{key:"spawnRandomRoomEntities",value:function(){var t=new ln(this.handler,(this.width-3)*kn,(this.height-3)*On,kn,On),e=new pn(this.handler,2*kn,2*On,kn,On),n=new pn(this.handler,(this.width-3)*kn,2*On,kn,On),i=[t,e,n];do{var r=i.length-1,o=Math.floor(Math.random()*(r+1));this.entityManager.addEntity(i[o]),i.splice(o,1)}while(i.length>0)}},{key:"init",value:function(){this.setPlayerSpawn(this.spawnX,this.spawnY),this.lightManager.init(),this.lightManager.fillLightMap(),1===this.level?(this.entityManager.addEntity(new ln(this.handler,kn,2*On,kn,On)),this.lightManager.addSource(3,3)):(this.spawnRandomRoomEntities(),this.addEvenSpreadOfLightSources(7),this.addEvenSpreadOfMonsters(7))}},{key:"addEvenSpreadOfLightSources",value:function(t){for(var e=t;e<=this.height;e+=t)for(var n=t;n<=this.width;n+=t)this.height-e>2&&this.width-n>2&&this.lightManager.addSource(n,e)}},{key:"getWorldHeight",value:function(){return this.height}},{key:"getWorldWidth",value:function(){return this.width}},{key:"addEvenSpreadOfMonsters",value:function(t){for(var e=t;e<=this.height;e+=t)for(var n=t;n<=this.width;n+=t)this.height-e>2&&this.width-n>2&&this.entityManager.addEntity(new Me(this.handler,n*kn,e*kn))}},{key:"setPlayerSpawn",value:function(t,e){this.entityManager.getPlayer().setX(t),this.entityManager.getPlayer().setY(e)}},{key:"loadWorld",value:function(){for(var t=this.fillWorld(this.level,1,1),e=0;e<this.height;e++)for(var n=0;n<this.width;n++)this.tiles[n]||(this.tiles[n]=[]),this.tiles[n][e]=t[n][e]}},{key:"fillWorld",value:function(t,e,n){var i=We.getRandomMaze(t,e,n);return this.height=i.mazeHeight,this.width=i.mazeWidth,this.spawnX=i.spawnX*kn,this.spawnY=i.spawnY*On,i.pieces}},{key:"swapGreenAndBlueTiles",value:function(t){"green"===t?(this.swapTilesByID(5,3),this.swapTilesByID(8,7)):"blue"===t&&(this.swapTilesByID(3,5),this.swapTilesByID(7,8))}},{key:"getInput",value:function(){}},{key:"swapTilesByID",value:function(t,e){for(var n=1;n<this.height;n++)for(var i=1;i<this.width;i++)this.tiles[i][n]===t&&(this.tiles[i][n]=e)}},{key:"checkForWallSwap",value:function(){++Mn>180&&(Mn=0,xn?this.swapTilesByID(4,2):this.swapTilesByID(2,4),xn=!xn)}},{key:"tick",value:function(t){this.getInput(),this.checkForWallSwap(),this.entityManager.tick(t),this.lightManager.tick(t),this.dialogue.tick(),_n||1===this.level||++jn/60>=240&&(alert("the monsters crumble all around you."),this.entityManager.removeEntitiesByType("monster"),_n=!0)}},{key:"render",value:function(t){var e=parseInt(Math.max(0,this.handler.getGameCamera().getxOffset()/kn)),n=parseInt(Math.min(this.width,(this.handler.getGameCamera().getxOffset()+this.handler.getWidth())/kn+1)),i=parseInt(Math.max(0,this.handler.getGameCamera().getyOffset()/On)),r=parseInt(Math.min(this.height,(this.handler.getGameCamera().getyOffset()+this.handler.getHeight())/On+1));this.drawTiles(e,n,i,r,t),this.entityManager.render(t),this.lightManager.render(e,n,i,r,t)}},{key:"drawTiles",value:function(t,e,n,i,r){for(var o=n;o<i;o++)for(var a=t;a<e;a++)void 0!==this.getTile(a,o)&&this.getTile(a,o).render(r,a*kn-this.handler.getGameCamera().getxOffset(),o*On-this.handler.getGameCamera().getyOffset())}},{key:"getTile",value:function(t,e){try{return tn.getTiles()[this.tiles[t][e]]}catch(t){}}},{key:"getWidth",value:function(){return this.width}},{key:"getHeight",value:function(){return this.height}},{key:"getEntityManager",value:function(){return this.entityManager}},{key:"getSpatialGrid",value:function(){return this.spatialGrid}}]),t}(),Tn=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),Cn=function(){function t(e){Mt(this,t),this.handler=e,this.world=new En(e)}return Tn(t,[{key:"tick",value:function(t){this.world.tick(t)}},{key:"render",value:function(t){this.world.render(t)}}]),t}(),Pn=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),Sn=function(){function t(e,n,i){jt(this,t),this.xOffset=n,this.yOffset=i,this.handler=e}return Pn(t,[{key:"centerOnEntity",value:function(t){this.xOffset=t.getX()-this.handler.getWidth()/2+t.getWidth()/2,this.yOffset=t.getY()-this.handler.getHeight()/2+t.getHeight()/2,this.checkBlankSpace()}},{key:"move",value:function(t,e){this.xOffset+=t,this.yOffset+=e,this.checkBlankSpace()}},{key:"getxOffset",value:function(){return parseInt(this.xOffset)}},{key:"getyOffset",value:function(){return parseInt(this.yOffset)}},{key:"setxOffset",value:function(t){this.xOffset=t}},{key:"setyOffset",value:function(t){this.yOffset=t}},{key:"checkBlankSpace",value:function(){this.xOffset<0?this.xOffset=0:this.xOffset>64*this.handler.getWorld().getWidth()-this.handler.getWidth()&&(this.xOffset=64*this.handler.getWorld().getWidth()-this.handler.getWidth()),this.yOffset<0?this.yOffset=0:this.yOffset>64*this.handler.getWorld().getHeight()-this.handler.getHeight()&&(this.yOffset=64*this.handler.getWorld().getHeight()-this.handler.getHeight())}}]),t}(),In=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),Wn=function(){function t(e){Et(this,t),this.game=e,this.console=document.getElementById("console"),this.devMessage(" dev cheats initialized \n 2 - clipping \n 3 - invincibility \n 4 - super speed \n 1 - all cheats ")}return In(t,[{key:"devMessage",value:function(t){var e=["background: linear-gradient(#ffffff, #ff00ff)","border: 1px solid #3E0E02","color: black","display: block","line-height: 40px","text-align: center","font-size: 18px","font-weight: bold"].join(";");console.log("%c"+t,e)}},{key:"getWidth",value:function(){return this.game.getWidth()}},{key:"getHeight",value:function(){return this.game.getHeight()}},{key:"getKeyManager",value:function(){return this.game.getKeyManager()}},{key:"getGameCamera",value:function(){return this.game.getGameCamera()}},{key:"getWorld",value:function(){return this.world}},{key:"setWorld",value:function(t){this.world=t}},{key:"getGame",value:function(){return this.game}}]),t}(),An=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),Gn=[],Ln=function(){function t(){Tt(this,t)}return An(t,[{key:"tick",value:function(){this.up=Gn[38],this.down=Gn[40],this.left=Gn[37],this.right=Gn[39],this.one=Gn[49],this.two=Gn[50],this.three=Gn[51],this.four=Gn[52],this.a=Gn[65],this.w=Gn[87],this.s=Gn[83],this.d=Gn[68],this.z=Gn[90],this.q=Gn[81],this.enter=Gn[13]}}]),t}();window.onkeydown=function(t){Gn[t.keyCode]=!0},window.onkeyup=function(t){Gn[t.keyCode]=!1};var zn=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),Rn=(function(t){function e(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Ct(this,e),Pt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}St(e,t),zn(e,[{key:"render",value:function(t){if(t){var e=this.handler.getWidth(),n=this.handler.getHeight();t.fillStyle="black",t.fillRect(0,0,e,n),t.drawText({fillColor:"white",text:"you are",fontSize:32,x:90,y:n/4}),t.drawText({fillColor:"yellow",text:"A L O N E",fontSize:64,x:80,y:n/2}),t.drawText({fillColor:"white",text:"press enter",fontSize:32,x:210,y:n/1.4})}}},{key:"getInput",value:function(t){if(this.handler.getKeyManager().enter){var e=new Cn(this.handler);this.handler.getGame().getGameState().setState(e)}}}])}(he),function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}()),Hn=function(){function t(e){It(this,t),this.currentState=null,this.handler=e}return Rn(t,[{key:"tick",value:function(t){throw"Every state needs a tick"}},{key:"render",value:function(t){throw"Every state needs a render"}},{key:"getState",value:function(){return this.currentState}},{key:"setState",value:function(t){this.currentState=t}}]),t}(),Bn=function(){var t=function(t){return Math.sin(6.283184*t)},e=function(t){return t%1*2-1},n=function(t){return t%1<.5?1:-1},i=function(t){var e=t%1*4;return e<2?e-1:3-e},r=function(t){return.003959503758*Math.pow(2,(t-128)/12)},o=function(t,e,n){var i=a[t.i[0]],o=t.i[1],s=t.i[3],h=a[t.i[4]],u=t.i[5],l=t.i[8],c=t.i[9],f=t.i[10]*t.i[10]*4,p=t.i[11]*t.i[11]*4,y=t.i[12]*t.i[12]*4,d=1/y,g=t.i[13],v=n*Math.pow(2,2-t.i[14]),w=new Int32Array(f+p+y),b=0,m=0,k=void 0,O=void 0,x=void 0,_=void 0,M=void 0,j=void 0,E=void 0;for(k=0,O=0;k<f+p+y;k++,O++)O>=0&&(g=g>>8|(255&g)<<4,O-=v,j=r(e+(15&g)+t.i[2]-128),E=r(e+(15&g)+t.i[6]-128)*(1+8e-4*t.i[7])),x=1,k<f?x=k/f:k>=f+p&&(x-=(k-f-p)*d),_=j,s&&(_*=x*x),b+=_,M=i(b)*o,_=E,l&&(_*=x*x),m+=_,M+=h(m)*u,c&&(M+=(2*Math.random()-1)*c),w[k]=80*M*x|0;return w},a=[t,n,e,i],s=void 0,h=void 0,u=void 0,l=void 0,c=void 0;this.init=function(t){s=t,h=t.endPattern-2,u=0,l=t.rowLen*t.patternLen*(h+1)*2,c=new Int32Array(l)},this.generate=function(){var e=void 0,n=void 0,i=void 0,r=void 0,f=void 0,p=void 0,y=void 0,d=void 0,g=void 0,v=void 0,w=void 0,b=void 0,m=new Int32Array(l),k=s.songData[u],O=s.rowLen,x=s.patternLen,_=0,M=0,j=void 0,E=void 0,T=!1,C=[];for(i=0;i<=h;++i)for(y=k.p[i],r=0;r<x;++r){var P=y?k.c[y-1].f[r]:0;P&&(k.i[P-1]=k.c[y-1].f[r+x]||0,P<16&&(C=[]));var S=a[k.i[15]],I=k.i[16]/512,W=Math.pow(2,k.i[17]-9)/O,A=k.i[18],G=k.i[19],L=43.23529*k.i[20]*3.141592/44100,z=1-k.i[21]/255,R=1e-5*k.i[22],H=k.i[23]/32,B=k.i[24]/512,Y=6.283184*Math.pow(2,k.i[25]-9)/O,D=k.i[26]/255,X=k.i[27]*O;for(w=(i*x+r)*O,f=0;f<4;++f)if(p=y?k.c[y-1].n[r+f*x]:0){C[p]||(C[p]=o(k,p,O));var F=C[p];for(n=0,e=2*w;n<F.length;n++,e+=2)m[e]+=F[n]}for(n=0;n<O;n++)d=2*(w+n),v=m[d],v||T?(b=L,A&&(b*=S(W*d)*I+.5),b=1.5*Math.sin(b),_+=b*M,j=z*(v-M)-_,M+=b*j,v=3==G?M:1==G?j:_,R&&(v*=R,v=v<1?v>-1?t(.25*v):-1:1,v/=R),v*=H,T=v*v>1e-5,g=Math.sin(Y*d)*B+.5,E=v*(1-g),v*=g):E=0,d>=X&&(E+=m[d-X+1]*D,v+=m[d-X]*D),m[d]=0|E,m[d+1]=0|v,c[d]+=0|E,c[d+1]+=0|v}return++u/8},this.createWave=function(){var t=44+2*l-8,e=t-36,n=new Uint8Array(44+2*l);n.set([82,73,70,70,255&t,t>>8&255,t>>16&255,t>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&e,e>>8&255,e>>16&255,e>>24&255]);for(var i=0,r=44;i<l;++i){var o=c[i];o=o<-32767?-32767:o>32767?32767:o,n[r++]=255&o,n[r++]=o>>8&255}return n},this.getData=function(t,e){for(var n=2*Math.floor(44100*t),i=new Array(e),r=0;r<2*e;r+=1){var o=n+r;i[r]=t>0&&o<c.length?c[o]/32768:0}return i}},Yn=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),Dn=(function(){function t(){Wt(this,t),this.bgMusic={songData:[{i:[3,59,140,0,1,60,128,3,0,29,92,28,95,0,0,3,96,2,1,2,124,135,11,25,130,4,97,2],p:[1],c:[{n:[112,,,,114,,,,117,,,,114,,,,112,,,,114,,,,117,,,,114,,,,141,,,,,,,,,,,,,,,,138],f:[]}]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]}],rowLen:22050,patternLen:32,endPattern:2},this.loaded=!1,this.lastTime=0,this.logged=0}Yn(t,[{key:"init",value:function(){var t=new Bn;t.init(this.bgMusic);var e=!1;setInterval(function(){if(!e&&(e=t.generate()>=1)){var n=t.createWave(),i=document.createElement("audio");i.src=URL.createObjectURL(new Blob([n],{type:"audio/wav"})),i.play(),i.volume=.3,setInterval(function(){var e=i.currentTime;t.getData(e,300)&&0===this.logged&&this.logged++,i.play(),i.loop=!0,this.lastTime=e},16)}},0)}},{key:"tick",value:function(){}},{key:"render",value:function(){}}])}(),function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}()),Xn=!1,Fn=void 0,Kn=void 0,Nn=void 0,Un=void 0,qn=void 0,Jn=void 0,Qn=void 0;new(function(){function t(e,n,i){At(this,t),this.height=i,this.title=e,this.width=n}return Dn(t,[{key:"run",value:function(){var t=this;this.init();var e=0,n=0,i=Date.now(),r=Date.now(),o=0;!function a(){Xn&&(i=Date.now(),e=i-r,o+=e,r=i),o>=1e3/60&&(n=o/1e3,t.tick(n),t.render(),o=0),window.requestAnimationFrame(a)}()}},{key:"start",value:function(){Xn||(Xn=!0,this.run())}},{key:"getSoundManager",value:function(){}},{key:"getKeyManager",value:function(){return Nn}},{key:"getDisplay",value:function(){return Kn}},{key:"getWidth",value:function(){return this.width}},{key:"getHeight",value:function(){return this.height}},{key:"getGameCamera",value:function(){return qn}},{key:"getGameState",value:function(){return Jn}},{key:"init",value:function(){Un=new Wn(this),Kn=new zt(this.title,this.width,this.height),Nn=new Ln,Fn=Kn.getGraphics(),Jn=new Hn,qn=new Sn(Un,0,0),Qn=new Cn(Un),Jn.setState(Qn)}},{key:"tick",value:function(t){Nn.tick(),Jn.getState()&&!Kn.paused&&Jn.getState().tick(t)}},{key:"render",value:function(){Jn.getState()&&!Kn.paused&&Jn.getState().render(Fn)}}]),t}())("Lost!",448,448).start();var Vn=n(1);n.n(Vn)},function(t,e){}]);</script></body>

</html>

<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
<style type="text/css">body,html{background-color:#000;height:100%;margin:0;padding:0;width:100%}#canvas{background-color:inherit;border-radius:235px;margin:50px 0 0 -224px}#canvas,.speech{left:50%;position:fixed;z-index:100}.speech{font-family:Arial,"serif";line-height:36px;font-size:24px;padding:0;top:408px}#dialogue{color:#fff;height:324px;margin:112px 0 0 -190px;width:600px}#speaker{color:#ff0;height:50px;margin:112px 0 0 -425px;text-align:right;width:200px}</style></head>

<body>
    <canvas id="canvas"></canvas>

    <div id="dialogue" class="speech"></div>

    <div id="speaker" class="speech"></div>
<script type="text/javascript">!function(e){function t(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function p(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function y(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function g(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function b(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function v(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function w(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function m(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function T(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function k(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function E(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function O(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function I(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function x(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function H(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function M(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function j(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function L(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function P(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function W(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function S(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function C(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function G(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function D(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function R(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function A(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function z(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function N(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function B(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function F(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function Y(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function X(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function $(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function U(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function K(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function V(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function J(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function q(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Q(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function Z(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function ee(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function te(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ne(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function ie(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function re(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function oe(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function ae(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function se(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ue(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function he(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function le(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function ce(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function fe(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function pe(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function ye(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function de(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ge(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function be(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function ve(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function we(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function me(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function Te(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function ke(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _e(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function Ee(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function Oe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ie(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function xe(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function He(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Me(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function je(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function Le(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Pe(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function We(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function Se(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ce(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function Ge(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function De(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Re(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function Ae(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function ze(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ne(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Be(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Fe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ye(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Xe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function $e(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function Ue(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function Ke(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ve(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Je(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var qe=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Qe=null,Ze=function(){function e(t,n,r){i(this,e),this.title=t,this.width=n,this.height=r,this.paused=!1,this.createDisplay()}return qe(e,[{key:"createDisplay",value:function(){document.title=this.title;var e=document.getElementById("canvas");e.setAttribute("height",this.height),e.setAttribute("width",this.width),Qe=e.getContext("2d"),Qe.webkitImageSmoothingEnabled=!1,Qe.mozImageSmoothingEnabled=!1,Qe.imageSmoothingEnabled=!1,this.setEventListeners()}},{key:"setEventListeners",value:function(){window.onblur=this.pause,window.onfocus=this.unPause}},{key:"pause",value:function(){this.paused=!0}},{key:"unPause",value:function(){this.paused=!1}},{key:"getTitle",value:function(){return this.title}},{key:"getWidth",value:function(){return this.width}},{key:"getHeight",value:function(){return this.height}},{key:"getGraphics",value:function(){return Qe}}]),e}();CanvasRenderingContext2D.prototype.myDrawImage=function(e,t,n,i,r){Qe.drawImage(e.sheet,e.x,e.y,e.width,e.height,t,n,i,r)},CanvasRenderingContext2D.prototype.drawText=function(e){Qe.font=e.fontSize+"px Arial",Qe.fillStyle=e.fillColor,Qe.strokeText(e.text,e.x,e.y),Qe.fillText(e.text,e.x,e.y)};var et=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),tt=function(){function e(t,n,i,o){r(this,e),this.x=t,this.y=n,this.width=i,this.height=o}return et(e,[{key:"intersects",value:function(e){return this.x<e.x+e.width&&this.x+this.width>e.x&&this.y<e.y+e.height&&this.y+this.height>e.y}}]),e}(),nt=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),it=void 0,rt=void 0,ot=void 0,at=function(e,t){var n=e.getY(),i=t.getY(),r=e.getHeight(),o=t.getHeight();return n+r===i+o?0:n+r<i+o?-1:1},st=function(){function e(t,n){o(this,e),it=t,rt=n,ot=new Array(rt)}return nt(e,[{key:"tick",value:function(e){ot.sort(at);for(var t=0;t<ot.length;t++){ot[t].tick(e)}}},{key:"render",value:function(e){ot.forEach(function(t){t.handler.getWidth()+t.handler.getGameCamera().getxOffset()&&t.handler.getHeight()+t.handler.getGameCamera().getyOffset()&&t.handler.getGameCamera().getxOffset()-t.width&&t.handler.getGameCamera().getyOffset()-t.height&&t.render(e)})}},{key:"getPlayer",value:function(){return rt}},{key:"getHandler",value:function(){return it}},{key:"getEntities",value:function(){return ot}},{key:"addEntity",value:function(e){ot.push(e),it.getWorld().getSpatialGrid().insert(new tt(e.x+e.bounds.x,e.y+e.bounds.y,e.bounds.width,e.bounds.height),e)}},{key:"removeEntity",value:function(e){var t=ot.indexOf(e);it.getWorld().getSpatialGrid().remove(new tt(e.x+e.bounds.x,e.y+e.bounds.y,e.bounds.width,e.bounds.height),e),ot.splice(t,1)}},{key:"removeEntitiesByType",value:function(e){ot=ot.filter(function(t){if(t.type!==e)return t;it.getWorld().getSpatialGrid().remove(new tt(t.x+t.bounds.x,t.y+t.bounds.y,t.bounds.width,t.bounds.height),t)})}}]),e}(),ut=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),ht=function(){function e(t){a(this,e),this.frames=t,this.index=0,this.lastTime=Date.now(),this.timer=0,this.speed=1e3}return ut(e,[{key:"tick",value:function(){this.timer+=Date.now()-this.lastTime,this.lastTime=Date.now(),this.timer>=this.speed&&(this.index++,this.timer=0,this.index>=this.frames.length&&(this.index=0))}},{key:"getCurrentFrame",value:function(){return this.speed=this.frames[this.index].speed,this.frames[this.index].frame}}]),e}(),lt=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),ct=function(){function e(){s(this,e)}return lt(e,null,[{key:"loadImage",value:function(e){var t=new Image;return t.src=e,t}}]),e}(),ft=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),pt=function(){function e(t){u(this,e),this.sheet=t}return ft(e,[{key:"crop",value:function(e,t,n,i){return{sheet:this.sheet,x:e,y:t,width:n,height:i}}}]),e}(),yt=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),dt={},gt=window.location.href.replace("index.html","")+"src/res/",bt=function(){function e(t,n,i,r){h(this,e),dt[t]=this,this.name=t,this.path=n,this.width=i,this.height=r,this.sheet=new pt(ct.loadImage(this.path)),this.animations={}}return yt(e,[{key:"addAnimation",value:function(e,t){this.animations[e]=t}},{key:"getWidth",value:function(){return 16}},{key:"getHeight",value:function(){return 16}}],[{key:"getAssets",value:function(e){return dt[e]}}]),e}(),vt=function(e,t,n){return e.sheet.crop(16*t,16*n,16,16)},wt=new bt("tiles",gt+"tiles.png",16,16);wt.path=vt(wt,1,0),wt.pathBlue=vt(wt,1,2),wt.pathGreen=vt(wt,2,2),wt.pathYellow=vt(wt,0,2),wt.wall=vt(wt,0,0),wt.wallBlue=vt(wt,1,1),wt.wallGreen=vt(wt,2,1),wt.wallYellow=vt(wt,0,1),wt.switchGreen=vt(wt,2,0),wt.switchBlue=vt(wt,3,0),wt.exit=vt(wt,3,1),wt.lantern=vt(wt,3,2);var mt=new bt("sprites",gt+"sprites.png",16,18),Tt=new bt("creature",gt+"creature.png",16,18),kt=function(e){for(var t=[],n=[],i=[],r=[],o=[],a=0;a<3;a++)i.push({frame:e.sheet.crop(e.width*a,0*e.height,e.width,e.height),speed:200}),t.push({frame:e.sheet.crop(e.width*a,1*e.height+1,e.width,e.height),speed:200}),r.push({frame:e.sheet.crop(e.width*a,2*e.height+1,e.width,e.height),speed:200}),n.push({frame:e.sheet.crop(e.width*a,3*e.height+1,e.width,e.height),speed:200}),o.push({frame:e.sheet.crop(e.width*a,4*e.height,e.width,e.height),speed:500});var s=[{frame:e.sheet.crop(0,2*e.height,e.width,e.height),speed:200},{frame:e.sheet.crop(1*e.width,2*e.height,e.width,e.height),speed:200},{frame:e.sheet.crop(2*e.width,2*e.height,e.width,e.height),speed:200}];e.addAnimation("walk_up",new ht(i)),e.addAnimation("walk_right",new ht(t)),e.addAnimation("walk_down",new ht(r)),e.addAnimation("walk_left",new ht(n)),e.addAnimation("idle",new ht(s)),e.addAnimation("death",new ht(o))};kt(mt),kt(Tt);var _t=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Et=function(){function e(t){l(this,e),this.handler=t,this.countSinceInput=0}return _t(e,[{key:"tick",value:function(e){this.countSinceInput++,this.countSinceInput>8&&this.getInput(e),this.render()}}]),e}(),Ot=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),It=function(e){function t(e){return c(this,t),f(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return p(t,e),Ot(t,[{key:"render",value:function(e){if(e){var t=this.handler.getWidth(),n=this.handler.getHeight();e.fillStyle="black",e.fillRect(0,0,t,n);var i="You escaped the maze!",r=t/2-e.measureText(i).width/2,o=n/3;e.drawText({fillColor:"yellow",text:i,fontSize:32,x:r,y:o}),i="Press enter for another run!",r=t/2-e.measureText(i).width/2,o=n/1.5,e.drawText({fillColor:"white",text:i,fontSize:32,x:r,y:o})}}},{key:"getInput",value:function(){this.handler.getKeyManager().enter&&window.location.reload()}}]),t}(Et),xt=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Ht=function(e){function t(e){return y(this,t),d(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return g(t,e),xt(t,[{key:"render",value:function(e){if(e){var t=this.handler.getWidth(),n=this.handler.getHeight();e.fillStyle="black",e.fillRect(0,0,t,n);var i="Y O U   D I E D",r=t/2-e.measureText(i).width/2,o=n/3;e.drawText({fillColor:"red",text:i,fontSize:32,x:r,y:o}),i="press enter to try again",r=t/2-e.measureText(i).width/2,o=n/1.5,e.drawText({fillColor:"white",text:i,fontSize:32,x:r,y:o})}}},{key:"getInput",value:function(){this.handler.getKeyManager().enter&&window.location.reload()}}]),t}(Et),Mt=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),jt=function(){function e(t,n,i,r,o){b(this,e),this.x=n,this.y=i,this.width=r,this.height=o,this.handler=t,this.bounds=new tt(0,0,r,o),this.moveThrough=!1}return Mt(e,[{key:"getX",value:function(){return this.x}},{key:"getY",value:function(){return this.y}},{key:"getWidth",value:function(){return this.width}},{key:"getHeight",value:function(){return this.height}},{key:"getCollisionBounds",value:function(e,t){return new tt(parseInt(this.x+this.bounds.x+e),parseInt(this.y+this.bounds.y+t),this.bounds.width,this.bounds.height)}},{key:"checkEntityCollisions",value:function(e,t){for(var n=this.handler.getWorld().getSpatialGrid().retrieve(new tt(this.x+this.bounds.x+e,this.y+this.bounds.y+t,this.bounds.width,this.bounds.height),this),i=0;i<n.length;i++){var r=n[i];if(r.moveThrough)return!1;if(r.getCollisionBounds(0,0).intersects(this.getCollisionBounds(e,t)))return this.checkForCollisionEvents(this,r),!0}return!1}},{key:"checkForCollisionEvents",value:function(e,t){if(!this.checkCollidingTypes(e,t,"monster","monster")){var n=this.handler,i=n.getGame(),r=n.getWorld(),o=r.entityManager;if(this.checkCollidingTypes(e,t,"player","journal")&&("journal"===e.type?(e.triggerEntry(),o.removeEntity(e)):(t.triggerEntry(),o.removeEntity(t))),this.checkCollidingTypes(e,t,"switch","player")&&("switch"===e.type?e.toggleSwitch():t.toggleSwitch()),this.checkCollidingTypes(e,t,"player","exit")){if(r.level>=4){r.dialogue.clear();var a=new It(this.handler);i.getGameState().setState(a)}return void r.changeLevel()}if(this.checkCollidingTypes(e,t,"player","monster")){if(e.invincible||t.invincible)return;r.dialogue.clear();var s=new Ht(e.handler);i.getGameState().setState(s)}}}},{key:"checkCollidingTypes",value:function(e,t,n,i){return e.type===n&&t.type===i||e.type===i&&t.type===n}},{key:"setX",value:function(e){this.x=e}},{key:"setY",value:function(e){this.y=e}},{key:"setWidth",value:function(e){this.width=e}},{key:"setHeight",value:function(e){this.height=e}}]),e}(),Lt=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Pt=function(e){function t(e,n,i){v(this,t);var r=w(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,i,64,64));return r.speed=80,r.xMove=0,r.yMove=0,r}return m(t,e),Lt(t,[{key:"tick",value:function(){this.yMove<0&&this.assets.animations.walk_up.tick(),this.yMove>0&&this.assets.animations.walk_down.tick(),this.xMove>0&&this.assets.animations.walk_right.tick(),this.xMove<0&&this.assets.animations.walk_left.tick()}},{key:"move",value:function(){(Math.abs(this.xMove)>0||Math.abs(this.yMove)>0)&&(this.handler.getWorld().getSpatialGrid().remove(new tt(this.x+this.bounds.x,this.y+this.bounds.y,this.bounds.width,this.bounds.height),this),this.checkEntityCollisions(this.xMove,0)||this.moveX(),this.checkEntityCollisions(0,this.yMove)||this.moveY(),this.handler.getWorld().getSpatialGrid().insert(new tt(this.x+this.bounds.x,this.y+this.bounds.y,this.bounds.width,this.bounds.height),this))}},{key:"moveX",value:function(){if(this.clipping)return void(this.x+=this.xMove);var e=this.xMove>0?parseInt((this.x+this.xMove+this.bounds.x+this.bounds.width)/TILE_WIDTH):parseInt((this.x+this.xMove+this.bounds.x)/TILE_WIDTH),t=parseInt((this.y+this.bounds.y)/TILE_HEIGHT),n=parseInt((this.y+this.bounds.y+this.bounds.height)/TILE_HEIGHT),i=this.xMove>0?e*TILE_WIDTH-this.bounds.x-this.bounds.width-1:e*TILE_WIDTH+TILE_WIDTH-this.bounds.x;this.collisionWithTile(e,t)||this.collisionWithTile(e,n)?this.x=i:this.x+=this.xMove}},{key:"moveY",value:function(){if(this.clipping)return void(this.y+=this.yMove);var e=this.yMove>0?parseInt((this.y+this.yMove+this.bounds.y+this.bounds.height)/TILE_HEIGHT):parseInt((this.y+this.yMove+this.bounds.y)/TILE_HEIGHT),t=parseInt((this.x+this.bounds.x)/TILE_WIDTH),n=parseInt((this.x+this.bounds.x+this.bounds.width)/TILE_WIDTH),i=this.yMove>0?e*TILE_HEIGHT-this.bounds.y-this.bounds.height-1:e*TILE_HEIGHT+TILE_HEIGHT-this.bounds.y;this.collisionWithTile(t,e)||this.collisionWithTile(n,e)?this.y=i:this.y+=this.yMove}},{key:"collisionWithTile",value:function(e,t){try{return this.handler.getWorld().getTile(e,t).isSolid}catch(e){}}},{key:"getCurrentAnimationFrame",value:function(){return this.xMove<0?(this.lastAnimation="walk_left",this.assets.animations.walk_left.getCurrentFrame()):this.xMove>0?(this.lastAnimation="walk_right",this.assets.animations.walk_right.getCurrentFrame()):this.yMove<0?(this.lastAnimation="walk_up",this.assets.animations.walk_up.getCurrentFrame()):this.yMove>0?(this.lastAnimation="walk_down",this.assets.animations.walk_down.getCurrentFrame()):this.assets.animations[this.lastAnimation].getCurrentFrame()}}]),t}(jt),Wt=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),St=function e(t,n,i){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,n);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,i)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(i)},Ct=function(e){function t(e,n,i){T(this,t);var r=k(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,i,TILE_WIDTH,TILE_HEIGHT));return r.assets=bt.getAssets("creature"),r.x=n,r.y=i,r.spawnX=n,r.spawnY=i,r.bounds.x=10,r.bounds.y=10,r.bounds.width=TILE_WIDTH-2*r.bounds.x,r.bounds.height=TILE_HEIGHT-2*r.bounds.y,r.type="monster",r.patrol=r.getPatrolPattern(),r.patrolLength=100,r.dirMoving=0,r.numberOfMoves=0,r.lastAnimation="walk_down",r}return _(t,e),Wt(t,[{key:"getPatrolPattern",value:function(){var e=["vertical","horizontal"];return e[Math.floor(Math.random()*e.length)]}},{key:"maybeChangePatrol",value:function(){Math.random()<.41&&(this.patrol="vertical"===this.patrol?"horizontal":"vertical")}},{key:"checkIfOffMap",value:function(){var e=this.handler.getWorld().getWorldWidth()*TILE_WIDTH,t=this.handler.getWorld().getWorldHeight()*TILE_HEIGHT;(this.x<1||this.y<1||this.x>e||this.y>t)&&(this.x=this.spawnX,this.y=this.spawnY)}},{key:"setPatrolMovement",value:function(e){"vertical"===this.patrol?(0===this.dirMoving?this.yMove=-this.speed*e:this.yMove=this.speed*e,++this.numberOfMoves>this.patrolLength&&(this.dirMoving=0===this.dirMoving?1:0,this.numberOfMoves=0,this.maybeChangePatrol())):"horizontal"===this.patrol&&(0===this.dirMoving?this.xMove=-this.speed*e:this.xMove=this.speed*e,++this.numberOfMoves>this.patrolLength&&(this.dirMoving=0===this.dirMoving?1:0,this.numberOfMoves=0,this.maybeChangePatrol()))}},{key:"checkIfInWall",value:function(){var e=Math.round(this.x/TILE_WIDTH),t=Math.round(this.y/TILE_HEIGHT);if(this.handler.getWorld().getTile(e,t).isSolid)for(var n=e-1,i=t-1,r=e+1,o=t+1,a=i;a<o;a++)for(var s=n;s<r;s++)if(!this.handler.getWorld().getTile(s,a).isSolid&&(s===e||a===t))return this.x=s*TILE_WIDTH,void(this.y=a*TILE_HEIGHT)}},{key:"tick",value:function(e){this.checkIfOffMap(),this.checkIfInWall(),this.setPatrolMovement(e),St(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"tick",this).call(this),this.move()}},{key:"render",value:function(e){e.myDrawImage(this.getCurrentAnimationFrame(),this.x-this.handler.getGameCamera().getxOffset(),this.y-this.handler.getGameCamera().getyOffset(),this.width,this.height)}}]),t}(Pt),Gt=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Dt=[],Rt=[],At=0,zt=0,Nt=function(e,t){return 0===e||0===t||e===At-1||t===zt-1?1:Math.floor(20*Math.random())<15?1:wallIDs[Math.floor(Math.random()*wallIDs.length)]},Bt=function(){function e(){E(this,e)}return Gt(e,null,[{key:"createMaze",value:function(){for(var e=[],t=0;t<zt;t++){Dt[t]=[];for(var n=0;n<At;n++)Dt[t][n]=1}var i=1,r=1;Dt[i][r]=0,e.push(r+r*At);do{if(e.length){var o="";if(i+2>0&&i+2<zt-1&&1==Dt[i+2][r]&&(o+="S"),i-2>0&&i-2<zt-1&&1==Dt[i-2][r]&&(o+="N"),r-2>0&&r-2<At-1&&1==Dt[i][r-2]&&(o+="W"),r+2>0&&r+2<At-1&&1==Dt[i][r+2]&&(o+="E"),o){var a=Math.floor(Math.random()*o.length);switch(o[a]){case"N":Dt[i-2][r]=0,Dt[i-1][r]=0,i-=2;break;case"S":Dt[i+2][r]=0,Dt[i+1][r]=0,i+=2;break;case"W":Dt[i][r-2]=0,Dt[i][r-1]=0,r-=2;break;case"E":Dt[i][r+2]=0,Dt[i][r+1]=0,r+=2}e.push(r+i*At)}else{var s=e.pop();i=Math.floor(s/At),r=s%At}this.buildFinalMaze(i,r)}}while(e.length)}},{key:"buildFinalMaze",value:function(){for(var e=0;e<zt;e++)for(var t=0;t<At;t++)Rt[t]||(Rt[t]=[]),Rt[t][e]=1===Dt[e][t]?Nt(e,t):0}},{key:"createRooms",value:function(){this.createRoom(1,1,3),this.createRoom(1,zt-4,3),this.createRoom(At-4,zt-4,3),this.createRoom(At-4,1,3)}},{key:"createRoom",value:function(e,t,n){for(var i=t;i<t+n;i++)for(var r=e;r<e+n;r++)Rt[r][i]=0}},{key:"createBarriers",value:function(e){2!==e&&(Rt[1][Math.ceil(zt/2)]=1,Rt[1][Math.ceil(zt/2)+1]=1,Rt[At-2][Math.ceil(zt/2)]=1,Rt[At-2][Math.ceil(zt/2)+1]=1,Rt[Math.ceil(At/2)][1]=1,Rt[Math.ceil(At/2)+1][1]=1,Rt[Math.ceil(At/2)][zt-2]=1,Rt[Math.ceil(At/2)+1][zt-2]=1)}},{key:"getIntroMaze",value:function(){return[[1,1,1,1,1,1,1,1,1],[1,0,0,2,0,0,7,0,1],[1,2,2,2,0,0,7,0,1],[1,0,0,0,0,0,7,0,1],[1,0,0,0,0,0,7,0,1],[1,3,3,0,0,0,7,0,1],[1,0,0,3,0,0,7,0,1],[1,0,0,3,0,0,7,0,1],[1,1,1,1,1,1,1,1,1]]}},{key:"getRandomMaze",value:function(e,t,n){return 1===e?{mazeWidth:9,mazeHeight:9,spawnX:1,spawnY:1,pieces:this.getIntroMaze()}:(At=zt=10*e-1,this.createMaze(),this.createRooms(),this.createBarriers(e),{mazeWidth:At,mazeHeight:zt,spawnX:t,spawnY:n,pieces:Rt})}}]),e}(),Ft=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Yt=function e(t,n,i){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,n);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,i)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(i)},Xt=!1,$t=0,Ut=function(e){function t(e,n,i){O(this,t);var r=I(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,i));return r.assets=bt.getAssets("sprites"),r.x=n,r.y=i,r.speed=140,r.bounds.x=14,r.bounds.y=24,r.bounds.width=36,r.bounds.height=39,r.type="player",r.clipping=!1,r.invincible=!1,r.superSpeed=!1,r.allCheats=!1,r.lastAnimation="walk_down",r}return x(t,e),Ft(t,[{key:"tick",value:function(e){this.xMove=this.yMove=0,this.getInput(e),Yt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"tick",this).call(this,e),this.move(),this.superSpeed&&(this.move(),this.move()),this.handler.getGameCamera().centerOnEntity(this)}},{key:"render",value:function(e){e.myDrawImage(this.getCurrentAnimationFrame(),this.x-this.handler.getGameCamera().getxOffset(),this.y-this.handler.getGameCamera().getyOffset(),TILE_WIDTH,TILE_HEIGHT)}},{key:"getInput",value:function(e){var t=this.handler.getKeyManager();if((t.up||t.w||t.z)&&(this.yMove=-this.speed*e),(t.down||t.s)&&(this.yMove=this.speed*e),(t.left||t.a||t.q)&&(this.xMove=-this.speed*e),(t.right||t.d)&&(this.xMove=this.speed*e),Xt||$t++,$t>15||Xt){if(Xt=!0,$t=0,t.one){var n=this.allCheats?" ALL CHEATS disabled ":" ALL CHEATS enabled ";this.handler.devMessage(n),this.allCheats=!this.allCheats,this.clipping=this.allCheats,this.invincible=this.allCheats,this.superSpeed=this.allCheats,Xt=!1}if(t.three){var i=this.invincible?" invincibility disabled ":" invincibility enabled ";this.handler.devMessage(i),this.invincible=!this.invincible,Xt=!1}if(t.two){var r=this.clipping?" clipping disabled ":" clipping enabled ";this.handler.devMessage(r),this.clipping=!this.clipping,Xt=!1}if(t.four){var o=this.superSpeed?" super speed disabled ":" super speed enabled ";this.handler.devMessage(o),this.superSpeed=!this.superSpeed,Xt=!1}}}}]),t}(Pt),Kt=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Vt=function(){function e(t,n,i){H(this,e),this.width=parseInt(t/i),this.height=parseInt(n/i),this.size=i,this.grid=[];for(var r=0;r<=this.width;r++){this.grid[r]=[];for(var o=0;o<=this.height;o++)this.grid[r][o]=[]}}return Kt(e,[{key:"insert",value:function(e,t){for(var n=Math.max(0,parseInt(e.x/this.size)),i=Math.max(0,parseInt(e.y/this.size)),r=Math.min(this.width,parseInt((e.x+e.width)/this.size)),o=Math.min(this.height,parseInt((e.y+e.height)/this.size)),a=i;a<=o;a++)for(var s=n;s<=r;s++)-1===this.grid[s][a].indexOf(t)&&this.grid[s][a].push(t)}},{key:"retrieve",value:function(e,t){for(var n=Math.max(0,parseInt(e.x/this.size)),i=Math.max(0,parseInt(e.y/this.size)),r=Math.min(this.width,parseInt((e.x+e.width)/this.size)),o=Math.min(this.height,parseInt((e.y+e.height)/this.size)),a=[],s=i;s<=o;s++)for(var u=n;u<=r;u++)this.grid[u][s].forEach(function(e){e!==t&&-1===a.indexOf(e)&&a.push(e)});return a}},{key:"remove",value:function(e,t){for(var n=Math.max(0,parseInt(e.x/this.size)),i=Math.max(0,parseInt(e.y/this.size)),r=Math.min(this.width,parseInt((e.x+e.width)/this.size)),o=Math.min(this.height,parseInt((e.y+e.height)/this.size)),a=i;a<=o;a++)for(var s=n;s<=r;s++)for(var u=0;u<this.grid[s][a].length;u++)this.grid[s][a][u]===t&&this.grid[s][a].splice(u,1)}},{key:"getWidth",value:function(){return this.width}},{key:"getHeight",value:function(){return this.height}},{key:"getSize",value:function(){return this.size}}]),e}(),Jt=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),qt=function(){function e(t,n){M(this,e),this.isSolid=!1,this.texture=t,this.id=n,this.disappear=!1,this.assets=bt.getAssets("tiles")}return Jt(e,[{key:"render",value:function(e,t,n){e.myDrawImage(this.texture,t,n,TILE_WIDTH,TILE_HEIGHT)}},{key:"getId",value:function(){return this.id}}]),e}(),Qt=function(e){function t(e){return j(this,t),L(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,bt.getAssets("tiles").path,e))}return P(t,e),t}(qt),Zt=function(e){function t(e){return W(this,t),S(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,bt.getAssets("tiles").pathBlue,e))}return C(t,e),t}(qt),en=function(e){function t(e){return G(this,t),D(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,bt.getAssets("tiles").pathYellow,e))}return R(t,e),t}(qt),tn=function(e){function t(e){A(this,t);var n=z(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,bt.getAssets("tiles").wall,e));return n.isSolid=!0,n}return N(t,e),t}(qt),nn=function(e){function t(e){B(this,t);var n=F(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,bt.getAssets("tiles").wallBlue,e));return n.isSolid=!0,n}return Y(t,e),t}(qt),rn=function(e){function t(e){X(this,t);var n=$(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,bt.getAssets("tiles").wallYellow,e));return n.isSolid=!0,n.disappear=!0,n}return U(t,e),t}(qt),on=function(e){function t(e){return K(this,t),V(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,bt.getAssets("tiles").pathGreen,e))}return J(t,e),t}(qt),an=function(e){function t(e){q(this,t);var n=Q(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,bt.getAssets("tiles").wallGreen,e));return n.isSolid=!0,n}return Z(t,e),t}(qt),sn=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),un=bt.getAssets("tiles"),hn=[];hn[0]=new Qt(0),hn[1]=new tn(1),hn[2]=new rn(2),hn[3]=new nn(3),hn[4]=new en(4),hn[5]=new Zt(5),hn[7]=new on(7),hn[8]=new an(8);var ln=function(){function e(){ee(this,e)}return sn(e,null,[{key:"getAssets",value:function(){return un}},{key:"getTiles",value:function(){return hn}}]),e}(),cn=function(e){function t(e,n,i,r,o){return te(this,t),ne(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,i,r,o))}return ie(t,e),t}(jt),fn=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),pn=function(e){function t(e,n,i,r,o){re(this,t);var a=oe(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,i,r,o));return a.manager=a.handler.getWorld().getLightManager(),a.posX=Math.floor(n/TILE_WIDTH),a.posY=Math.floor(i/TILE_HEIGHT),a.bounds.x=0,a.bounds.y=0,a.bounds.width=0,a.bounds.height=0,a.flickering=!1,a.lastFlickerCounter=0,a.flickerToggle=0,a.flickerCount=0,a.flickerTimes=0,a.flickerLength=0,a.moveThrough=!0,a.assets=bt.getAssets("tiles"),a.type="light",a.init(),a}return ae(t,e),fn(t,[{key:"init",value:function(){this.makeSureOnWall(),this.expandLight()}},{key:"makeSureOnWall",value:function(){var e=this.posX,t=this.posY;if(1!==this.handler.getWorld().getTile(e,t).id)for(var n=t-1;n<t+1;n++)for(var i=e-1;i<e+1;i++)if(1===this.handler.getWorld().getTile(i,n).id)return this.posX=i,void(this.posY=n)}},{key:"expandLight",value:function(){for(var e=-2;e<3;e++)for(var t=-2;t<3;t++)this.manager.lightMap[this.posX+t][this.posY+e]=Math.min(this.manager.lightMap[this.posX+t][this.posY+e],OUTER_LIGHT);for(var n=-1;n<2;n++)for(var i=-1;i<2;i++)this.manager.lightMap[this.posX+i][this.posY+n]=Math.min(this.manager.lightMap[this.posX+i][this.posY+n],INNER_LIGHT);this.manager.lightMap[this.posX][this.posY]=CENTER_LIGHT}},{key:"dimLights",value:function(e){for(var t=-2;t<3;t++)for(var n=-2;n<3;n++)this.manager.lightMap[this.posX+n][this.posY+t]=Math.min(DEFAULT_LIGHT,OUTER_LIGHT+e);for(var i=-1;i<2;i++)for(var r=-1;r<2;r++)this.manager.lightMap[this.posX+r][this.posY+i]=Math.min(DEFAULT_LIGHT,INNER_LIGHT+e);this.manager.lightMap[this.posX][this.posY]=Math.min(DEFAULT_LIGHT,CENTER_LIGHT+e)}},{key:"chanceToFlicker",value:function(){Math.random()<.85||(this.lastFlickerCounter=0,this.flickerLength=Math.floor(5*Math.random())+4,this.flickering=!0)}},{key:"flickerLights",value:function(){0===this.flickerCount&&(0===this.flickerToggle?(this.dimLights(.25),this.flickerToggle=1):(this.expandLight(),this.flickerToggle=0)),this.flickerCount++,this.flickerCount>=this.flickerLength&&(this.flickerCount=0,this.flickerTimes++),this.flickerTimes>=6&&(this.flickerTimes=0,this.flickering=!1)}},{key:"tick",value:function(){this.flickering?this.flickerLights():++this.lastFlickerCounter>240&&this.chanceToFlicker()}},{key:"render",value:function(e){e.myDrawImage(this.assets.lantern,this.x-this.handler.getGameCamera().getxOffset(),this.y-this.handler.getGameCamera().getyOffset(),this.width,this.height)}}]),t}(cn),yn=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),dn=function(){function e(t){se(this,e),this.handler=t,this.init()}return yn(e,[{key:"init",value:function(){this.sources=[],this.lightMap=[],this.fillLightMap()}},{key:"fillLightMap",value:function(){for(var e=this.handler.getWorld().getWorldWidth(),t=this.handler.getWorld().getWorldHeight(),n=0;n<t;n++)for(var i=0;i<e;i++)this.lightMap[i]||(this.lightMap[i]=[]),this.lightMap[i][n]=DEFAULT_LIGHT}},{key:"tick",value:function(){this.sources.forEach(function(e){e.tick()})}},{key:"render",value:function(e,t,n,i,r){this.sources.forEach(function(e){e.render(r)}),this.drawLightBlocks(e,t,n,i,r)}},{key:"drawLightBlocks",value:function(e,t,n,i,r){r.fillStyle="black";for(var o=n;o<i;o++)for(var a=e;a<t;a++){var s=this.handler.getWorld().getTile(a,o).type;r.globalAlpha="switch"===s||"exit"===s?CENTER_LIGHT:this.lightMap[a][o],r.fillRect(a*TILE_WIDTH-this.handler.getGameCamera().getxOffset(),o*TILE_HEIGHT-this.handler.getGameCamera().getyOffset(),TILE_WIDTH,TILE_HEIGHT)}r.globalAlpha=1}},{key:"addSource",value:function(e,t){var n=new pn(this.handler,e*TILE_WIDTH,t*TILE_HEIGHT,TILE_WIDTH,TILE_HEIGHT,this);this.handler.getWorld().getEntityManager().addEntity(n),this.sources.push(n)}},{key:"setLight",value:function(e,t,n){this.lightMap[e][t]=n}},{key:"removeSources",value:function(){this.handler.getWorld().getEntityManager().removeEntitiesByType("light"),this.sources=[]}}]),e}(),gn=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),bn=function(e){function t(e,n,i,r,o){ue(this,t);var a=he(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,i,r,o));return a.assets=bt.getAssets("tiles"),a.type="exit",a.bounds.x=15,a.bounds.y=15,a.bounds.width=a.width-30,a.bounds.height=a.height-30,a}return le(t,e),gn(t,[{key:"tick",value:function(){}},{key:"render",value:function(e){e.myDrawImage(this.assets.exit,this.x-this.handler.getGameCamera().getxOffset(),this.y-this.handler.getGameCamera().getyOffset(),this.width,this.height)}}]),t}(cn),vn=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),wn=60,mn=function(e){function t(e,n,i,r,o){ce(this,t);var a=fe(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,i,r,o));return a.assets=bt.getAssets("tiles"),a.type="switch",a.bounds.x=5,a.bounds.y=25,a.bounds.width=a.width-18,a.bounds.height=a.height-35,a.currentSwitch=a.assets.switchGreen,a}return pe(t,e),vn(t,[{key:"tick",value:function(){wn++}},{key:"toggleSwitch",value:function(){wn<40||(this.currentSwitch===this.assets.switchGreen?(this.currentSwitch=this.assets.switchBlue,this.color="blue"):(this.currentSwitch=this.assets.switchGreen,this.color="green"),this.handler.getWorld().swapGreenAndBlueTiles(this.color),wn=0)}},{key:"render",value:function(e){e.myDrawImage(this.currentSwitch,this.x-this.handler.getGameCamera().getxOffset(),this.y-this.handler.getGameCamera().getyOffset(),this.width,this.height)}}]),t}(cn),Tn=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),kn=document.getElementById("dialogue"),_n=document.getElementById("speaker"),En=5,On=0,In="",xn="",Hn=!1,Mn=!1,jn=!1,Ln=[],Pn=[],Wn=function(){function e(){ye(this,e)}return Tn(e,[{key:"tick",value:function(){En>=0&&Ln.length&&(Ln[0].length?this.speakNextLetter():On>=120?this.resetForNextSentence():On++),En<30&&En++}},{key:"resetForNextSentence",value:function(){Ln.splice(0,1),Pn.splice(0,1),kn.innerHTML="",_n.innerHTML="",On=0}},{key:"speakNextLetter",value:function(){_n.innerHTML=Pn[0]+":";var e=Ln[0][0];"@"===e&&(Hn=!Hn),"$"===e&&(jn=!jn),"&"===e&&(Mn=!Mn),In="",xn="",Hn&&(In+='<span style="color:red">',xn+="</span>"),jn&&(In+='<span style="color:yellow">',xn+="</span>"),Mn&&(In+="<em>",xn+="</em>"),"%"===e&&(xn+="<br />"),kn.innerHTML+=In+e.replace("%","").replace("@","").replace("&","").replace("$","")+xn,Ln[0].splice(0,1),En=0}},{key:"addWords",value:function(e,t){Ln.push(t.split("")),Pn.push(e)}},{key:"clear",value:function(){Ln=[],Pn=[],kn.innerHTML="",_n.innerHTML=""}}]),e}(),Sn=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Cn=function(e){function t(e,n,i,r,o,a){de(this,t);var s=ge(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,i,r,o));return s.type="journal",s.bounds.x=15,s.bounds.y=15,s.bounds.width=s.width-30,s.bounds.height=s.height-30,s.journal=a,s.triggered=!1,s}return be(t,e),Sn(t,[{key:"tick",value:function(){}},{key:"render",value:function(e){e.fillStyle="yellow",e.fillRect(this.bounds.x+this.x-this.handler.getGameCamera().getxOffset(),this.bounds.y+this.y-this.handler.getGameCamera().getyOffset(),this.bounds.width,this.bounds.height)}},{key:"triggerEntry",value:function(){var e=this;this.triggered||(this.triggered=!0,this.journal.getText().forEach(function(t){e.handler.getWorld().dialogue.addWords(e.journal.name,t)}))}}]),t}(cn),Gn=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Dn=function(){function e(){ve(this,e)}return Gn(e,[{key:"getText",value:function(){return this.text}},{key:"setText",value:function(e){this.text=e}}]),e}(),Rn=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),An=function(e){function t(){we(this,t);var e=me(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.setText(e.myText()),e.name="Journal #001",e}return Te(t,e),Rn(t,[{key:"myText",value:function(){return["Despite his best efforts, I've stayed alive longer than anyone else...","Before he sent me down into this hellhole, I was able to swipe one of his notebooks. He noticed, and broke my leg with a pipe...","Beware of the grotesque beings down here. One touch from them will plague your mind.","The beings are often slow, so make use of the switches and rotating walls to cut them off.","For all who come after me, I hope to provide some small guidance."]}}]),t}(Dn),zn=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Nn=function(e){function t(){ke(this,t);var e=_e(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.setText(e.myText()),e.name="Journal #002",e}return Ee(t,e),zn(t,[{key:"myText",value:function(){return["This place seems dark and unending. I feel as though I am peering into the abyss at every turn..","I'm not sure how much farther down it goes... I hope I'll see it to the end.","I have to hope, because the only thing left for me is fear and this damned broken tibia.","One odd thing... I have encountered an $old man$ in some of the darkest corners of the maze.","There is something very calming about him. He makes me feel as though I can push on a little longer.","He never speaks, and those... things never bother him. I wonder why?"]}}]),t}(Dn),Bn=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Fn=function(e){function t(){Oe(this,t);var e=Ie(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.setText(e.myText()),e.name="Journal #003",e}return xe(t,e),Bn(t,[{key:"myText",value:function(){return["It seems like this place gets larger with each floor I descend. Am I in a pyramid?","The gurgling noises come and go, but a foul stench is always present.","I am feeling migraines from time to time, and hearing an eerie voice constantly calling out to me from within. Like it wants to escape.","I think the silence and darkness are getting the better of me. The $bleeding$ won't stop. I am... afraid."]}}]),t}(Dn),Yn=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Xn=function(e){function t(){He(this,t);var e=Me(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.setText(e.myText()),e.name="Journal #004",e}return je(t,e),Yn(t,[{key:"myText",value:function(){return["It has been bothering me for a while and I can't get past it. Those creatures, they seem somehow... familiar.","I'm not sure from when or where, but their faces are familiar to me.","Another thing bothering me is that same old man on every floor. How is he traveling between the floors without passing me?","I'll think more on this later... The voice in my head is getting louder and is more frequent.","(&At the bottom of the page you see these words written in what looks to be @blood@.&)","@... ~HeHe. VeRy GooD!~@"]}}]),t}(Dn),$n=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Un=function(e){function t(){Le(this,t);var e=Pe(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.setText(e.myText()),e.name="Journal #005",e}return We(t,e),$n(t,[{key:"myText",value:function(){return["(&This page is covered in sweat and droplets of @blood@&)","I got a better look at the creatures today.","The strange part is that they all look the same. They all have the same face. %@~WiTH THiS GRoSS SMiLe.~@","It gets creepier. I got a good look at their faces this time in the light.","They all look like the $old man$. &EXACTLY& like him...","@~eVeRy.~","~SiNGLe.~","~oNe.~@"]}}]),t}(Dn),Kn=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Vn=function(e){function t(){Se(this,t);var e=Ce(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.setText(e.myText()),e.name="JournaL 0o0o06",e}return Ge(t,e),Kn(t,[{key:"myText",value:function(){return["To whomever...@~you~@ has made it this far, the $old man$ on this floor has passed away.%@~He iS DeaD you KNoW.~@","I fear no help is available to you.%@~you aRe aLoNe!~@%I barely made it back here on my own.%@~you WeRe NeVeR aLONE~@","I did find an eerie discovery while searching the old man. It seems he bares the same small branding upon his neck as I do.","I cannot see what mine says, but I believe his to be the letter $C$ followed by a $5 digit number$.%@~you KNoW WHaT THiS MeaNS.~@","The headaches rarely stop now.%@~aND SooN NeVeR WiLL.~@"]}}]),t}(Dn),Jn=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),qn=function(e){function t(){De(this,t);var e=Re(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.setText(e.myText()),e.name="HeHe! My eNTRy",e}return Ae(t,e),Jn(t,[{key:"myText",value:function(){return["@~WoW. you Too HaVe MaDe iT To THe eND. WHaT a ViLe JoKe aWaiTS.~","~HoW PiTiFuL i MuST HaVe SeeMeD, THiNKiNG i PuLLeD THe WooL oVeR HiS eyeS.~","~aT THe eND oF THiS FlooR, i HAVE SEEN THE ANSWER. SooN you WiLL Too. SHaLL you GueSS WHaT i SaW?~","~you WouLDN'T BeLieVe Me eVeN iF i ToLD you.~","~SCuRRy oN LiTTLe RaT! you SooN Too WiLL LeaRN THe TRuTH.~@"]}}]),t}(Dn),Qn=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Zn=!1,ei=!1,ti=0,ni=0,ii=function(){function e(t){ze(this,e),this.width=null,this.height=null,this.tiles=[],this.handler=t,t.setWorld(this),this.entityManager=new st(t,new Ut(t,20,20)),this.spatialGrid=new Vt(this.handler.getWidth()*TILE_WIDTH,this.handler.getHeight()*TILE_HEIGHT,64),this.level=1,this.loadWorld(),this.lightManager=new dn(t),this.dialogue=new Wn,this.init()}return Qn(e,[{key:"getLightManager",value:function(){return this.lightManager}},{key:"changeLevel",value:function(){this.setPlayerSpawn(this.spawnX,this.spawnY),this.level+=1,this.tiles=[],ni=0,this.lightManager.removeSources(),this.entityManager.removeEntitiesByType("exit"),this.entityManager.removeEntitiesByType("switch"),this.entityManager.removeEntitiesByType("journal"),ei||this.entityManager.removeEntitiesByType("monster"),ei=!1,this.loadWorld(),this.init()}},{key:"spawnRandomRoomEntities",value:function(){var e=new bn(this.handler,(this.width-2)*TILE_WIDTH,(this.height-2)*TILE_HEIGHT,TILE_WIDTH,TILE_HEIGHT),t=Math.random()<.5,n=t?(this.width-3)*TILE_WIDTH:2*TILE_WIDTH,i=t?2*TILE_HEIGHT:(this.height-3)*TILE_HEIGHT;this.entityManager.addEntity(new mn(this.handler,n,i,TILE_WIDTH,TILE_HEIGHT)),this.entityManager.addEntity(e)}},{key:"init",value:function(){this.setPlayerSpawn(this.spawnX,this.spawnY),this.lightManager.init(),this.lightManager.fillLightMap(),1===this.level?(this.entityManager.addEntity(new bn(this.handler,7*TILE_WIDTH,7*TILE_HEIGHT,TILE_WIDTH,TILE_HEIGHT)),this.entityManager.addEntity(new Cn(this.handler,1*TILE_WIDTH,2*TILE_HEIGHT,TILE_WIDTH,TILE_HEIGHT,new An)),this.entityManager.addEntity(new Ct(this.handler,6*TILE_WIDTH,2*TILE_WIDTH)),this.entityManager.addEntity(new mn(this.handler,4*TILE_WIDTH,4*TILE_HEIGHT,TILE_WIDTH,TILE_HEIGHT)),this.lightManager.addSource(5,3)):(this.spawnRandomRoomEntities(),this.addEvenSpreadOfLightSources(7),this.addEvenSpreadOfMonsters(7),this.spawnJournals())}},{key:"spawnJournals",value:function(){var e=[new Nn,new Fn,new Xn,new Un,new Vn,new qn],t=e[2*this.level-4],n=e[2*this.level-3];this.entityManager.addEntity(new Cn(this.handler,2*TILE_WIDTH,2*TILE_HEIGHT,TILE_WIDTH,TILE_HEIGHT,t)),this.entityManager.addEntity(new Cn(this.handler,(this.width-3)*TILE_WIDTH,(this.height-3)*TILE_HEIGHT,TILE_WIDTH,TILE_HEIGHT,n))}},{key:"addEvenSpreadOfLightSources",value:function(e){for(var t=e;t<=this.height;t+=e)for(var n=e;n<=this.width;n+=e)this.height-t>2&&this.width-n>2&&this.lightManager.addSource(n,t)}},{key:"getWorldHeight",value:function(){return this.height}},{key:"getWorldWidth",value:function(){return this.width}},{key:"addEvenSpreadOfMonsters",value:function(e){for(var t=e;t<=this.height;t+=e)for(var n=e;n<=this.width;n+=e)this.height-t>2&&this.width-n>2&&this.entityManager.addEntity(new Ct(this.handler,n*TILE_WIDTH,t*TILE_WIDTH))}},{key:"setPlayerSpawn",value:function(e,t){this.entityManager.getPlayer().setX(e),this.entityManager.getPlayer().setY(t)}},{key:"loadWorld",value:function(){for(var e=this.fillWorld(this.level,1,1),t=0;t<this.height;t++)for(var n=0;n<this.width;n++)this.tiles[n]||(this.tiles[n]=[]),this.tiles[n][t]=e[n][t]}},{key:"fillWorld",value:function(e,t,n){var i=Bt.getRandomMaze(e,t,n);return this.height=i.mazeHeight,this.width=i.mazeWidth,this.spawnX=i.spawnX*TILE_WIDTH,this.spawnY=i.spawnY*TILE_HEIGHT,i.pieces}},{key:"swapGreenAndBlueTiles",value:function(e){"green"===e?(this.swapTilesByID(5,3),this.swapTilesByID(8,7)):"blue"===e&&(this.swapTilesByID(3,5),this.swapTilesByID(7,8))}},{key:"getInput",value:function(){}},{key:"swapTilesByID",value:function(e,t){for(var n=1;n<this.height;n++)for(var i=1;i<this.width;i++)this.tiles[i][n]===e&&(this.tiles[i][n]=this.handler.getWorld().getTile(i,n).disappear?0:t)}},{key:"checkForWallSwap",value:function(){++ti>300&&(ti=0,Zn?this.swapTilesByID(4,2):this.swapTilesByID(2,4),Zn=!Zn)}},{key:"tick",value:function(e){this.getInput(),this.checkForWallSwap(),this.entityManager.tick(e),this.lightManager.tick(e),this.dialogue.tick(),ei||1===this.level||++ni/60>=240&&(alert("the monsters crumble all around you."),this.entityManager.removeEntitiesByType("monster"),ei=!0)}},{key:"render",value:function(e){var t=parseInt(Math.max(0,this.handler.getGameCamera().getxOffset()/TILE_WIDTH)),n=parseInt(Math.min(this.width,(this.handler.getGameCamera().getxOffset()+this.handler.getWidth())/TILE_WIDTH+1)),i=parseInt(Math.max(0,this.handler.getGameCamera().getyOffset()/TILE_HEIGHT)),r=parseInt(Math.min(this.height,(this.handler.getGameCamera().getyOffset()+this.handler.getHeight())/TILE_HEIGHT+1));this.drawTiles(t,n,i,r,e),this.entityManager.render(e),this.lightManager.render(t,n,i,r,e)}},{key:"drawTiles",value:function(e,t,n,i,r){for(var o=n;o<i;o++)for(var a=e;a<t;a++)void 0!==this.getTile(a,o)&&this.getTile(a,o).render(r,a*TILE_WIDTH-this.handler.getGameCamera().getxOffset(),o*TILE_HEIGHT-this.handler.getGameCamera().getyOffset())}},{key:"getTile",value:function(e,t){try{return ln.getTiles()[this.tiles[e][t]]}catch(e){}}},{key:"getWidth",value:function(){return this.width}},{key:"getHeight",value:function(){return this.height}},{key:"getEntityManager",value:function(){return this.entityManager}},{key:"getSpatialGrid",value:function(){return this.spatialGrid}}]),e}(),ri=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),oi=function(){function e(t){Ne(this,e),this.handler=t,this.world=new ii(t)}return ri(e,[{key:"tick",value:function(e){this.world.tick(e)}},{key:"render",value:function(e){this.world.render(e)}}]),e}(),ai=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),si=function(){function e(t,n,i){Be(this,e),this.xOffset=n,this.yOffset=i,this.handler=t}return ai(e,[{key:"centerOnEntity",value:function(e){this.xOffset=e.getX()-this.handler.getWidth()/2+e.getWidth()/2,this.yOffset=e.getY()-this.handler.getHeight()/2+e.getHeight()/2,this.checkBlankSpace()}},{key:"move",value:function(e,t){this.xOffset+=e,this.yOffset+=t,this.checkBlankSpace()}},{key:"getxOffset",value:function(){return parseInt(this.xOffset)}},{key:"getyOffset",value:function(){return parseInt(this.yOffset)}},{key:"setxOffset",value:function(e){this.xOffset=e}},{key:"setyOffset",value:function(e){this.yOffset=e}},{key:"checkBlankSpace",value:function(){this.xOffset<0?this.xOffset=0:this.xOffset>this.handler.getWorld().getWidth()*TILE_WIDTH-this.handler.getWidth()&&(this.xOffset=this.handler.getWorld().getWidth()*TILE_WIDTH-this.handler.getWidth()),this.yOffset<0?this.yOffset=0:this.yOffset>this.handler.getWorld().getHeight()*TILE_HEIGHT-this.handler.getHeight()&&(this.yOffset=this.handler.getWorld().getHeight()*TILE_HEIGHT-this.handler.getHeight())}}]),e}(),ui=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),hi=function(){function e(t){Fe(this,e),this.game=t,this.console=document.getElementById("console"),this.devMessage(" dev cheats initialized \n 2 - clipping \n 3 - invincibility \n 4 - super speed \n 1 - all cheats ")}return ui(e,[{key:"devMessage",value:function(e){var t=["background: linear-gradient(#ffffff, #ff00ff)","border: 1px solid #3E0E02","color: black","display: block","line-height: 40px","text-align: center","font-size: 18px","font-weight: bold"].join(";");console.log("%c"+e,t)}},{key:"getWidth",value:function(){return this.game.getWidth()}},{key:"getHeight",value:function(){return this.game.getHeight()}},{key:"getKeyManager",value:function(){return this.game.getKeyManager()}},{key:"getGameCamera",value:function(){return this.game.getGameCamera()}},{key:"getWorld",value:function(){return this.world}},{key:"setWorld",value:function(e){this.world=e}},{key:"getGame",value:function(){return this.game}}]),e}(),li=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),ci=[],fi=function(){function e(){Ye(this,e)}return li(e,[{key:"tick",value:function(){this.up=ci[38],this.down=ci[40],this.left=ci[37],this.right=ci[39],this.one=ci[49],this.two=ci[50],this.three=ci[51],this.four=ci[52],this.a=ci[65],this.w=ci[87],this.s=ci[83],this.d=ci[68],this.z=ci[90],this.q=ci[81],this.enter=ci[13]}}]),e}();window.onkeydown=function(e){ci[e.keyCode]=!0},window.onkeyup=function(e){ci[e.keyCode]=!1};var pi=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),yi=(function(e){function t(e){return Xe(this,t),$e(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}Ue(t,e),pi(t,[{key:"render",value:function(e){if(e){var t=this.handler.getWidth(),n=this.handler.getHeight();e.fillStyle="black",e.fillRect(0,0,t,n),e.drawText({fillColor:"white",text:"you are",fontSize:32,x:90,y:n/4}),e.drawText({fillColor:"yellow",text:"A L O N E",fontSize:64,x:80,y:n/2}),e.drawText({fillColor:"white",text:"press enter",fontSize:32,x:210,y:n/1.4})}}},{key:"getInput",value:function(e){if(this.handler.getKeyManager().enter){var t=new oi(this.handler);this.handler.getGame().getGameState().setState(t)}}}])}(Et),function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}()),di=function(){function e(t){Ke(this,e),this.currentState=null,this.handler=t}return yi(e,[{key:"getState",value:function(){return this.currentState}},{key:"setState",value:function(e){this.currentState=e}}]),e}(),gi=function(){var e=function(e){return Math.sin(6.283184*e)},t=function(e){return e%1*2-1},n=function(e){return e%1<.5?1:-1},i=function(e){var t=e%1*4;return t<2?t-1:3-t},r=function(e){return.003959503758*Math.pow(2,(e-128)/12)},o=function(e,t,n){var i=a[e.i[0]],o=e.i[1],s=e.i[3],u=a[e.i[4]],h=e.i[5],l=e.i[8],c=e.i[9],f=e.i[10]*e.i[10]*4,p=e.i[11]*e.i[11]*4,y=e.i[12]*e.i[12]*4,d=1/y,g=e.i[13],b=n*Math.pow(2,2-e.i[14]),v=new Int32Array(f+p+y),w=0,m=0,T=void 0,k=void 0,_=void 0,E=void 0,O=void 0,I=void 0,x=void 0;for(T=0,k=0;T<f+p+y;T++,k++)k>=0&&(g=g>>8|(255&g)<<4,k-=b,I=r(t+(15&g)+e.i[2]-128),x=r(t+(15&g)+e.i[6]-128)*(1+8e-4*e.i[7])),_=1,T<f?_=T/f:T>=f+p&&(_-=(T-f-p)*d),E=I,s&&(E*=_*_),w+=E,O=i(w)*o,E=x,l&&(E*=_*_),m+=E,O+=u(m)*h,c&&(O+=(2*Math.random()-1)*c),v[T]=80*O*_|0;return v},a=[e,n,t,i],s=void 0,u=void 0,h=void 0,l=void 0,c=void 0;this.init=function(e){s=e,u=e.endPattern-2,h=0,l=e.rowLen*e.patternLen*(u+1)*2,c=new Int32Array(l)},this.generate=function(){var t=void 0,n=void 0,i=void 0,r=void 0,f=void 0,p=void 0,y=void 0,d=void 0,g=void 0,b=void 0,v=void 0,w=void 0,m=new Int32Array(l),T=s.songData[h],k=s.rowLen,_=s.patternLen,E=0,O=0,I=void 0,x=void 0,H=!1,M=[];for(i=0;i<=u;++i)for(y=T.p[i],r=0;r<_;++r){var j=y?T.c[y-1].f[r]:0;j&&(T.i[j-1]=T.c[y-1].f[r+_]||0,j<16&&(M=[]));var L=a[T.i[15]],P=T.i[16]/512,W=Math.pow(2,T.i[17]-9)/k,S=T.i[18],C=T.i[19],G=43.23529*T.i[20]*3.141592/44100,D=1-T.i[21]/255,R=1e-5*T.i[22],A=T.i[23]/32,z=T.i[24]/512,N=6.283184*Math.pow(2,T.i[25]-9)/k,B=T.i[26]/255,F=T.i[27]*k;for(v=(i*_+r)*k,f=0;f<4;++f)if(p=y?T.c[y-1].n[r+f*_]:0){M[p]||(M[p]=o(T,p,k));var Y=M[p];for(n=0,t=2*v;n<Y.length;n++,t+=2)m[t]+=Y[n]}for(n=0;n<k;n++)d=2*(v+n),b=m[d],b||H?(w=G,S&&(w*=L(W*d)*P+.5),w=1.5*Math.sin(w),E+=w*O,I=D*(b-O)-E,O+=w*I,b=3==C?O:1==C?I:E,R&&(b*=R,b=b<1?b>-1?e(.25*b):-1:1,b/=R),b*=A,H=b*b>1e-5,g=Math.sin(N*d)*z+.5,x=b*(1-g),b*=g):x=0,d>=F&&(x+=m[d-F+1]*B,b+=m[d-F]*B),m[d]=0|x,m[d+1]=0|b,c[d]+=0|x,c[d+1]+=0|b}return++h/8},this.createWave=function(){var e=44+2*l-8,t=e-36,n=new Uint8Array(44+2*l);n.set([82,73,70,70,255&e,e>>8&255,e>>16&255,e>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&t,t>>8&255,t>>16&255,t>>24&255]);for(var i=0,r=44;i<l;++i){var o=c[i];o=o<-32767?-32767:o>32767?32767:o,n[r++]=255&o,n[r++]=o>>8&255}return n},this.getData=function(e,t){for(var n=2*Math.floor(44100*e),i=new Array(t),r=0;r<2*t;r+=1){var o=n+r;i[r]=e>0&&o<c.length?c[o]/32768:0}return i}},bi=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),vi=(function(){function e(){Ve(this,e),this.bgMusic={songData:[{i:[3,59,140,0,1,60,128,3,0,29,92,28,95,0,0,3,96,2,1,2,124,135,11,25,130,4,97,2],p:[1],c:[{n:[112,,,,114,,,,117,,,,114,,,,112,,,,114,,,,117,,,,114,,,,141,,,,,,,,,,,,,,,,138],f:[]}]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]}],rowLen:22050,patternLen:32,endPattern:2},this.loaded=!1,this.lastTime=0,this.logged=0}bi(e,[{key:"init",value:function(){var e=new gi;e.init(this.bgMusic);var t=!1;setInterval(function(){if(!t&&(t=e.generate()>=1)){var n=e.createWave(),i=document.createElement("audio");i.src=URL.createObjectURL(new Blob([n],{type:"audio/wav"})),i.play(),i.volume=.3,setInterval(function(){var t=i.currentTime;e.getData(t,300)&&0===this.logged&&this.logged++,i.play(),i.loop=!0,this.lastTime=t},16)}},0)}},{key:"tick",value:function(){}},{key:"render",value:function(){}}])}(),function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}()),wi=!1,mi=void 0,Ti=void 0,ki=void 0,_i=void 0,Ei=void 0,Oi=void 0,Ii=void 0,xi=function(){function e(t,n,i){Je(this,e),this.height=i,this.title=t,this.width=n}return vi(e,[{key:"run",value:function(){var e=this;this.init();var t=0,n=0,i=Date.now(),r=Date.now(),o=0;!function a(){wi&&(i=Date.now(),t=i-r,o+=t,r=i),o>=1e3/60&&(n=o/1e3,e.tick(n),e.render(),o=0),window.requestAnimationFrame(a)}()}},{key:"start",value:function(){wi||(wi=!0,this.run())}},{key:"getSoundManager",value:function(){}},{key:"getKeyManager",value:function(){return ki}},{key:"getDisplay",value:function(){return Ti}},{key:"getWidth",value:function(){return this.width}},{key:"getHeight",value:function(){return this.height}},{key:"getGameCamera",value:function(){return Ei}},{key:"getGameState",value:function(){return Oi}},{key:"init",value:function(){_i=new hi(this),Ti=new Ze(this.title,this.width,this.height),ki=new fi,mi=Ti.getGraphics(),Oi=new di,Ei=new si(_i,0,0),Ii=new oi(_i),Oi.setState(Ii)}},{key:"tick",value:function(e){ki.tick(),Oi.getState()&&!Ti.paused&&Oi.getState().tick(e)}},{key:"render",value:function(){Oi.getState()&&!Ti.paused&&Oi.getState().render(mi)}}]),e}();window.TILE_HEIGHT=64,window.TILE_WIDTH=64,window.DEFAULT_LIGHT=.85,window.CENTER_LIGHT=.3,window.INNER_LIGHT=.5,window.OUTER_LIGHT=.65,new xi("Lost!",448,448).start();var Hi=n(1);n.n(Hi)},function(e,t){}]);</script></body>

</html>

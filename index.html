<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
<style type="text/css">body,html{background-color:#000;height:100%;margin:0;padding:0;width:100%}#canvas{background-color:inherit;border-radius:235px;margin:50px 0 0 -224px}#canvas,.speech{left:50%;position:fixed;z-index:100}.speech{font-family:Arial,"serif";line-height:36px;font-size:24px;padding:0;top:408px}#dialogue{color:#fff;height:324px;margin:112px 0 0 -190px;width:600px}#speaker{color:#ff0;height:50px;margin:112px 0 0 -425px;text-align:right;width:200px}</style></head>

<body>
    <canvas id="canvas"></canvas>

    <div id="dialogue" class="speech"></div>

    <div id="speaker" class="speech"></div>
<script type="text/javascript">!function(e){function t(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function p(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function y(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function g(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function b(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function v(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function w(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function m(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function k(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function O(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function x(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function T(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function M(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function j(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function E(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function P(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function S(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function C(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function I(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function W(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function L(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function H(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function R(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function G(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function A(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function z(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function D(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function B(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function Y(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function N(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function F(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function X(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function $(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function K(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function V(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function J(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function q(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function U(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Q(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function Z(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function ee(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function te(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ne(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function ie(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function re(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function oe(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function ae(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function se(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ue(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function he(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function le(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function ce(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function fe(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function pe(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function ye(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function de(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ge(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function be(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function ve(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function we(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function me(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function ke(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function Oe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _e(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function xe(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function Te(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Me(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function je(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function Ee(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Pe(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function Se(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function Ce(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ie(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function We(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function Le(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function He(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function Re(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function Ge(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ae(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function ze(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function De(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Be(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ye(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ne(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Fe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Xe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function $e(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function Ke(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function Ve(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Je(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function qe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var Ue=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Qe=null,Ze=function(){function e(t,n,r){i(this,e),this.title=t,this.width=n,this.height=r,this.paused=!1,this.createDisplay()}return Ue(e,[{key:"createDisplay",value:function(){document.title=this.title;var e=document.getElementById("canvas");e.setAttribute("height",this.height),e.setAttribute("width",this.width),Qe=e.getContext("2d"),Qe.webkitImageSmoothingEnabled=!1,Qe.mozImageSmoothingEnabled=!1,Qe.imageSmoothingEnabled=!1,this.setEventListeners()}},{key:"setEventListeners",value:function(){window.onblur=this.pause,window.onfocus=this.unPause}},{key:"pause",value:function(){this.paused=!0}},{key:"unPause",value:function(){this.paused=!1}},{key:"getTitle",value:function(){return this.title}},{key:"getWidth",value:function(){return this.width}},{key:"getHeight",value:function(){return this.height}},{key:"getGraphics",value:function(){return Qe}}]),e}();CanvasRenderingContext2D.prototype.myDrawImage=function(e,t,n,i,r){Qe.drawImage(e.sheet,e.x,e.y,e.width,e.height,t,n,i,r)},CanvasRenderingContext2D.prototype.drawText=function(e){Qe.font=e.fontSize+"px Arial",Qe.fillStyle=e.fillColor,Qe.strokeText(e.text,e.x,e.y),Qe.fillText(e.text,e.x,e.y)};var et=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),tt=function(){function e(t,n,i,o){r(this,e),this.x=t,this.y=n,this.width=i,this.height=o}return et(e,[{key:"intersects",value:function(e){return this.x<e.x+e.width&&this.x+this.width>e.x&&this.y<e.y+e.height&&this.y+this.height>e.y}}]),e}(),nt=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),it=void 0,rt=void 0,ot=void 0,at=function(e,t){var n=e.getY(),i=t.getY(),r=e.getHeight(),o=t.getHeight();return n+r===i+o?0:n+r<i+o?-1:1},st=function(){function e(t,n){o(this,e),it=t,rt=n,ot=new Array(rt)}return nt(e,[{key:"tick",value:function(e){ot.sort(at);for(var t=0;t<ot.length;t++){ot[t].tick(e)}}},{key:"render",value:function(e){ot.forEach(function(t){t.handler.getWidth()+t.handler.getGameCamera().getxOffset()&&t.handler.getHeight()+t.handler.getGameCamera().getyOffset()&&t.handler.getGameCamera().getxOffset()-t.width&&t.handler.getGameCamera().getyOffset()-t.height&&t.render(e)})}},{key:"getPlayer",value:function(){return rt}},{key:"getHandler",value:function(){return it}},{key:"getEntities",value:function(){return ot}},{key:"addEntity",value:function(e){ot.push(e),it.getWorld().getSpatialGrid().insert(new tt(e.x+e.bounds.x,e.y+e.bounds.y,e.bounds.width,e.bounds.height),e)}},{key:"removeEntity",value:function(e){var t=ot.indexOf(e);it.getWorld().getSpatialGrid().remove(new tt(e.x+e.bounds.x,e.y+e.bounds.y,e.bounds.width,e.bounds.height),e),ot.splice(t,1)}},{key:"removeEntitiesByType",value:function(e){ot=ot.filter(function(t){if(t.type!==e)return t;it.getWorld().getSpatialGrid().remove(new tt(t.x+t.bounds.x,t.y+t.bounds.y,t.bounds.width,t.bounds.height),t)})}}]),e}(),ut=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),ht=function(){function e(t){a(this,e),this.frames=t,this.index=0,this.lastTime=Date.now(),this.timer=0,this.speed=1e3}return ut(e,[{key:"tick",value:function(){this.timer+=Date.now()-this.lastTime,this.lastTime=Date.now(),this.timer>=this.speed&&(this.index++,this.timer=0,this.index>=this.frames.length&&(this.index=0))}},{key:"getCurrentFrame",value:function(){return this.speed=this.frames[this.index].speed,this.frames[this.index].frame}}]),e}(),lt=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),ct=function(){function e(){s(this,e)}return lt(e,null,[{key:"loadImage",value:function(e){var t=new Image;return t.src=e,t}}]),e}(),ft=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),pt=function(){function e(t){u(this,e),this.sheet=t}return ft(e,[{key:"crop",value:function(e,t,n,i){return{sheet:this.sheet,x:e,y:t,width:n,height:i}}}]),e}(),yt=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),dt={},gt=window.location.href.replace("index.html","")+"src/res/",bt=function(){function e(t,n,i,r){h(this,e),dt[t]=this,this.name=t,this.path=n,this.width=i,this.height=r,this.sheet=new pt(ct.loadImage(this.path)),this.animations={}}return yt(e,[{key:"addAnimation",value:function(e,t){this.animations[e]=t}},{key:"getWidth",value:function(){return 16}},{key:"getHeight",value:function(){return 16}}],[{key:"getAssets",value:function(e){return dt[e]}}]),e}(),vt=function(e,t,n){return e.sheet.crop(16*t,16*n,16,16)},wt=new bt("tiles",gt+"tiles.png",16,16);wt.path=vt(wt,1,0),wt.pathBlue=vt(wt,1,2),wt.pathGreen=vt(wt,2,2),wt.pathYellow=vt(wt,0,2),wt.wall=vt(wt,0,0),wt.wallBlue=vt(wt,1,1),wt.wallGreen=vt(wt,2,1),wt.wallYellow=vt(wt,0,1),wt.switchGreen=vt(wt,2,0),wt.switchBlue=vt(wt,3,0),wt.exit=vt(wt,3,1),wt.lantern=vt(wt,3,2);var mt=new bt("sprites",gt+"sprites.png",16,18),kt=new bt("creature",gt+"creature.png",16,18),Ot=function(e){for(var t=[],n=[],i=[],r=[],o=[],a=0;a<3;a++)i.push({frame:e.sheet.crop(e.width*a,0*e.height,e.width,e.height),speed:200}),t.push({frame:e.sheet.crop(e.width*a,1*e.height+1,e.width,e.height),speed:200}),r.push({frame:e.sheet.crop(e.width*a,2*e.height+1,e.width,e.height),speed:200}),n.push({frame:e.sheet.crop(e.width*a,3*e.height+1,e.width,e.height),speed:200}),o.push({frame:e.sheet.crop(e.width*a,4*e.height,e.width,e.height),speed:500});var s=[{frame:e.sheet.crop(0,2*e.height,e.width,e.height),speed:200},{frame:e.sheet.crop(1*e.width,2*e.height,e.width,e.height),speed:200},{frame:e.sheet.crop(2*e.width,2*e.height,e.width,e.height),speed:200}];e.addAnimation("walk_up",new ht(i)),e.addAnimation("walk_right",new ht(t)),e.addAnimation("walk_down",new ht(r)),e.addAnimation("walk_left",new ht(n)),e.addAnimation("idle",new ht(s)),e.addAnimation("death",new ht(o))};Ot(mt),Ot(kt);var _t=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),xt=function(){function e(t){l(this,e),this.handler=t,this.countSinceInput=0}return _t(e,[{key:"tick",value:function(e){this.countSinceInput++,this.countSinceInput>8&&this.getInput(e),this.render()}},{key:"render",value:function(){alert("all menus need a render!")}},{key:"getInput",value:function(){alert("all menus need getInput!")}}]),e}(),Tt=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Mt=function(e){function t(e){return c(this,t),f(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return p(t,e),Tt(t,[{key:"render",value:function(e){if(e){var t=this.handler.getWidth(),n=this.handler.getHeight();e.fillStyle="black",e.fillRect(0,0,t,n);var i="You escaped the maze!",r=t/2-e.measureText(i).width/2,o=n/3;e.drawText({fillColor:"yellow",text:i,fontSize:32,x:r,y:o}),i="Press enter for another run!",r=t/2-e.measureText(i).width/2,o=n/1.5,e.drawText({fillColor:"white",text:i,fontSize:32,x:r,y:o})}}},{key:"getInput",value:function(){this.handler.getKeyManager().enter&&window.location.reload()}}]),t}(xt),jt=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Et=function(e){function t(e){return y(this,t),d(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return g(t,e),jt(t,[{key:"render",value:function(e){if(e){var t=this.handler.getWidth(),n=this.handler.getHeight();e.fillStyle="black",e.fillRect(0,0,t,n);var i="Y O U   D I E D",r=t/2-e.measureText(i).width/2,o=n/3;e.drawText({fillColor:"red",text:i,fontSize:32,x:r,y:o}),i="press enter to try again",r=t/2-e.measureText(i).width/2,o=n/1.5,e.drawText({fillColor:"white",text:i,fontSize:32,x:r,y:o})}}},{key:"getInput",value:function(){this.handler.getKeyManager().enter&&window.location.reload()}}]),t}(xt),Pt=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),St=function(){function e(t,n,i,r,o){b(this,e),this.x=n,this.y=i,this.width=r,this.height=o,this.handler=t,this.bounds=new tt(0,0,r,o),this.moveThrough=!1}return Pt(e,[{key:"getX",value:function(){return this.x}},{key:"getY",value:function(){return this.y}},{key:"getWidth",value:function(){return this.width}},{key:"getHeight",value:function(){return this.height}},{key:"getCollisionBounds",value:function(e,t){return new tt(parseInt(this.x+this.bounds.x+e),parseInt(this.y+this.bounds.y+t),this.bounds.width,this.bounds.height)}},{key:"checkEntityCollisions",value:function(e,t){for(var n=this.handler.getWorld().getSpatialGrid().retrieve(new tt(this.x+this.bounds.x+e,this.y+this.bounds.y+t,this.bounds.width,this.bounds.height),this),i=0;i<n.length;i++){var r=n[i];if(r.moveThrough)return!1;if(r.getCollisionBounds(0,0).intersects(this.getCollisionBounds(e,t)))return this.checkForCollisionEvents(this,r),!0}return!1}},{key:"checkForCollisionEvents",value:function(e,t){if(!this.checkCollidingTypes(e,t,"monster","monster")){var n=this.handler,i=n.getGame(),r=n.getWorld(),o=r.entityManager;if(this.checkCollidingTypes(e,t,"player","journal")&&("journal"===e.type?(e.triggerEntry(),o.removeEntity(e)):(t.triggerEntry(),o.removeEntity(t))),this.checkCollidingTypes(e,t,"switch","player")&&("switch"===e.type?e.toggleSwitch():t.toggleSwitch()),this.checkCollidingTypes(e,t,"player","exit")){if(r.level>=4){r.dialogue.clear();var a=new Mt(this.handler);i.getGameState().setState(a)}return void r.changeLevel()}if(this.checkCollidingTypes(e,t,"player","monster")){if(e.invincible||t.invincible)return;r.dialogue.clear();var s=new Et(e.handler);i.getGameState().setState(s)}}}},{key:"checkCollidingTypes",value:function(e,t,n,i){return e.type===n&&t.type===i||e.type===i&&t.type===n}},{key:"setX",value:function(e){this.x=e}},{key:"setY",value:function(e){this.y=e}},{key:"setWidth",value:function(e){this.width=e}},{key:"setHeight",value:function(e){this.height=e}}]),e}(),Ct=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),It=100,Wt=200,Lt=64,Ht=64,Rt=function(e){function t(e,n,i){v(this,t);var r=w(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,i,Lt,Ht));return r.health=Wt,r.speed=It,r.xMove=0,r.yMove=0,r}return m(t,e),Ct(t,[{key:"tick",value:function(){this.yMove<0&&this.assets.animations.walk_up.tick(),this.yMove>0&&this.assets.animations.walk_down.tick(),this.xMove>0&&this.assets.animations.walk_right.tick(),this.xMove<0&&this.assets.animations.walk_left.tick()}},{key:"move",value:function(){(Math.abs(this.xMove)>0||Math.abs(this.yMove)>0)&&(this.handler.getWorld().getSpatialGrid().remove(new tt(this.x+this.bounds.x,this.y+this.bounds.y,this.bounds.width,this.bounds.height),this),this.checkEntityCollisions(this.xMove,0)||this.moveX(),this.checkEntityCollisions(0,this.yMove)||this.moveY(),this.handler.getWorld().getSpatialGrid().insert(new tt(this.x+this.bounds.x,this.y+this.bounds.y,this.bounds.width,this.bounds.height),this))}},{key:"moveX",value:function(){if(this.clipping)return void(this.x+=this.xMove);var e=this.xMove>0?parseInt((this.x+this.xMove+this.bounds.x+this.bounds.width)/64):parseInt((this.x+this.xMove+this.bounds.x)/64),t=parseInt((this.y+this.bounds.y)/64),n=parseInt((this.y+this.bounds.y+this.bounds.height)/64),i=this.xMove>0?64*e-this.bounds.x-this.bounds.width-1:64*e+64-this.bounds.x;this.collisionWithTile(e,t)||this.collisionWithTile(e,n)?this.x=i:this.x+=this.xMove}},{key:"moveY",value:function(){if(this.clipping)return void(this.y+=this.yMove);var e=this.yMove>0?parseInt((this.y+this.yMove+this.bounds.y+this.bounds.height)/64):parseInt((this.y+this.yMove+this.bounds.y)/64),t=parseInt((this.x+this.bounds.x)/64),n=parseInt((this.x+this.bounds.x+this.bounds.width)/64),i=this.yMove>0?64*e-this.bounds.y-this.bounds.height-1:64*e+64-this.bounds.y;this.collisionWithTile(t,e)||this.collisionWithTile(n,e)?this.y=i:this.y+=this.yMove}},{key:"collisionWithTile",value:function(e,t){try{return this.handler.getWorld().getTile(e,t).isSolid}catch(e){}}},{key:"getCurrentAnimationFrame",value:function(){return this.yMove<0?(this.lastAnimation="walk_up",this.assets.animations.walk_up.getCurrentFrame()):this.yMove>0?(this.lastAnimation="walk_down",this.assets.animations.walk_down.getCurrentFrame()):this.xMove<0?(this.lastAnimation="walk_left",this.assets.animations.walk_left.getCurrentFrame()):this.xMove>0?(this.lastAnimation="walk_right",this.assets.animations.walk_right.getCurrentFrame()):this.assets.animations[this.lastAnimation].getCurrentFrame()}}]),t}(St),Gt=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),At=function e(t,n,i){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,n);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,i)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(i)},zt=64,Dt=64,Bt=function(e){function t(e,n,i){k(this,t);var r=O(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,i,zt,Dt));return r.assets=bt.getAssets("creature"),r.x=n,r.y=i,r.spawnX=n,r.spawnY=i,r.bounds.x=10,r.bounds.y=10,r.bounds.width=zt-2*r.bounds.x,r.bounds.height=Dt-2*r.bounds.y,r.type="monster",r.patrol=r.getPatrolPattern(),r.startX=n,r.startY=i,r.patrolLength=100,r.dirMoving=0,r.numberOfMoves=0,r.lastAnimation="walk_down",r}return _(t,e),Gt(t,[{key:"getPatrolPattern",value:function(){var e=["vertical","horizontal"];return e[Math.floor(Math.random()*e.length)]}},{key:"maybeChangePatrol",value:function(){Math.random()<.41&&(this.patrol="vertical"===this.patrol?"horizontal":"vertical")}},{key:"checkIfOffMap",value:function(){var e=this.handler.getWorld().getWorldWidth()*zt,t=this.handler.getWorld().getWorldHeight()*Dt;(this.x<1||this.y<1||this.x>e||this.y>t)&&(this.x=this.spawnX,this.y=this.spawnY)}},{key:"setPatrolMovement",value:function(e){"vertical"===this.patrol?(0===this.dirMoving?this.yMove=-this.speed*e:this.yMove=this.speed*e,++this.numberOfMoves>this.patrolLength&&(this.dirMoving=0===this.dirMoving?1:0,this.numberOfMoves=0,this.maybeChangePatrol())):"horizontal"===this.patrol&&(0===this.dirMoving?this.xMove=-this.speed*e:this.xMove=this.speed*e,++this.numberOfMoves>this.patrolLength&&(this.dirMoving=0===this.dirMoving?1:0,this.numberOfMoves=0,this.maybeChangePatrol()))}},{key:"checkIfInWall",value:function(){var e=Math.round(this.x/zt),t=Math.round(this.y/Dt);if(this.handler.getWorld().getTile(e,t).isSolid)for(var n=e-1,i=t-1,r=e+1,o=t+1,a=i;a<o;a++)for(var s=n;s<r;s++)if(!this.handler.getWorld().getTile(s,a).isSolid&&(s===e||a===t))return this.x=s*zt,void(this.y=a*Dt)}},{key:"tick",value:function(e){this.checkIfOffMap(),this.checkIfInWall(),this.setPatrolMovement(e),At(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"tick",this).call(this),this.move()}},{key:"render",value:function(e){e.myDrawImage(this.getCurrentAnimationFrame(),this.x-this.handler.getGameCamera().getxOffset(),this.y-this.handler.getGameCamera().getyOffset(),this.width,this.height)}}]),t}(Rt),Yt=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Nt=[],Ft=[],Xt=[2,3,7],$t=0,Kt=0,Vt=function(e,t){return 0===e||0===t||e===$t-1||t===Kt-1?1:Math.floor(20*Math.random())<15?1:Xt[Math.floor(Math.random()*Xt.length)]},Jt=function(){function e(){x(this,e)}return Yt(e,null,[{key:"createMaze",value:function(){for(var e=[],t=0;t<Kt;t++){Nt[t]=[];for(var n=0;n<$t;n++)Nt[t][n]=1}var i=1,r=1;Nt[i][r]=0,e.push(r+r*$t);do{if(e.length){var o="";if(i+2>0&&i+2<Kt-1&&1==Nt[i+2][r]&&(o+="S"),i-2>0&&i-2<Kt-1&&1==Nt[i-2][r]&&(o+="N"),r-2>0&&r-2<$t-1&&1==Nt[i][r-2]&&(o+="W"),r+2>0&&r+2<$t-1&&1==Nt[i][r+2]&&(o+="E"),o){var a=Math.floor(Math.random()*o.length);switch(o[a]){case"N":Nt[i-2][r]=0,Nt[i-1][r]=0,i-=2;break;case"S":Nt[i+2][r]=0,Nt[i+1][r]=0,i+=2;break;case"W":Nt[i][r-2]=0,Nt[i][r-1]=0,r-=2;break;case"E":Nt[i][r+2]=0,Nt[i][r+1]=0,r+=2}e.push(r+i*$t)}else{var s=e.pop();i=Math.floor(s/$t),r=s%$t}this.buildFinalMaze(i,r)}}while(e.length)}},{key:"buildFinalMaze",value:function(){for(var e=0;e<Kt;e++)for(var t=0;t<$t;t++)Ft[t]||(Ft[t]=[]),Ft[t][e]=1===Nt[e][t]?Vt(e,t):0}},{key:"createRooms",value:function(){this.createRoom(1,1,3),this.createRoom(1,Kt-4,3),this.createRoom($t-4,Kt-4,3),this.createRoom($t-4,1,3)}},{key:"createRoom",value:function(e,t,n){for(var i=t;i<t+n;i++)for(var r=e;r<e+n;r++)Ft[r][i]=0}},{key:"createBarriers",value:function(e){2!==e&&(Ft[1][Math.ceil(Kt/2)]=1,Ft[1][Math.ceil(Kt/2)+1]=1,Ft[$t-2][Math.ceil(Kt/2)]=1,Ft[$t-2][Math.ceil(Kt/2)+1]=1,Ft[Math.ceil($t/2)][1]=1,Ft[Math.ceil($t/2)+1][1]=1,Ft[Math.ceil($t/2)][Kt-2]=1,Ft[Math.ceil($t/2)+1][Kt-2]=1)}},{key:"getIntroMaze",value:function(){return[[1,1,1,1,1,1,1,1,1],[1,0,0,2,0,0,7,0,1],[1,2,2,2,0,0,7,0,1],[1,0,0,0,0,0,7,0,1],[1,0,0,0,0,0,7,0,1],[1,3,3,0,0,0,7,0,1],[1,0,0,3,0,0,7,0,1],[1,0,0,3,0,0,7,0,1],[1,1,1,1,1,1,1,1,1]]}},{key:"getRandomMaze",value:function(e,t,n){return 1===e?{mazeWidth:9,mazeHeight:9,spawnX:1,spawnY:1,pieces:this.getIntroMaze()}:($t=Kt=10*e-1,this.createMaze(),this.createRooms(),this.createBarriers(e),{mazeWidth:$t,mazeHeight:Kt,spawnX:t,spawnY:n,pieces:Ft})}}]),e}(),qt=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Ut=function e(t,n,i){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,n);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,i)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(i)},Qt=!1,Zt=0,en=function(e){function t(e,n,i){T(this,t);var r=M(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,i));return r.assets=bt.getAssets("sprites"),r.x=n,r.y=i,r.speed=140,r.bounds.x=14,r.bounds.y=24,r.bounds.width=36,r.bounds.height=39,r.type="player",r.clipping=!1,r.invincible=!1,r.superSpeed=!1,r.allCheats=!1,r.lastAnimation="walk_down",r}return j(t,e),qt(t,[{key:"tick",value:function(e){this.xMove=this.yMove=0,this.getInput(e),Ut(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"tick",this).call(this,e),this.move(),this.superSpeed&&(this.move(),this.move()),this.handler.getGameCamera().centerOnEntity(this)}},{key:"render",value:function(e){e.myDrawImage(this.getCurrentAnimationFrame(),this.x-this.handler.getGameCamera().getxOffset(),this.y-this.handler.getGameCamera().getyOffset(),64,64)}},{key:"getInput",value:function(e){var t=this.handler.getKeyManager();if((t.up||t.w||t.z)&&(this.yMove=-this.speed*e),(t.down||t.s)&&(this.yMove=this.speed*e),(t.left||t.a||t.q)&&(this.xMove=-this.speed*e),(t.right||t.d)&&(this.xMove=this.speed*e),Qt||Zt++,Zt>15||Qt){if(Qt=!0,Zt=0,t.one){var n=this.allCheats?" ALL CHEATS disabled ":" ALL CHEATS enabled ";this.handler.devMessage(n),this.allCheats=!this.allCheats,this.clipping=this.allCheats,this.invincible=this.allCheats,this.superSpeed=this.allCheats,Qt=!1}if(t.three){var i=this.invincible?" invincibility disabled ":" invincibility enabled ";this.handler.devMessage(i),this.invincible=!this.invincible,Qt=!1}if(t.two){var r=this.clipping?" clipping disabled ":" clipping enabled ";this.handler.devMessage(r),this.clipping=!this.clipping,Qt=!1}if(t.four){var o=this.superSpeed?" super speed disabled ":" super speed enabled ";this.handler.devMessage(o),this.superSpeed=!this.superSpeed,Qt=!1}}}}]),t}(Rt),tn=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),nn=function(){function e(t,n,i){E(this,e),this.width=parseInt(t/i),this.height=parseInt(n/i),this.size=i,this.grid=[];for(var r=0;r<=this.width;r++){this.grid[r]=[];for(var o=0;o<=this.height;o++)this.grid[r][o]=[]}}return tn(e,[{key:"insert",value:function(e,t){for(var n=Math.max(0,parseInt(e.x/this.size)),i=Math.max(0,parseInt(e.y/this.size)),r=Math.min(this.width,parseInt((e.x+e.width)/this.size)),o=Math.min(this.height,parseInt((e.y+e.height)/this.size)),a=i;a<=o;a++)for(var s=n;s<=r;s++)-1===this.grid[s][a].indexOf(t)&&this.grid[s][a].push(t)}},{key:"retrieve",value:function(e,t){for(var n=Math.max(0,parseInt(e.x/this.size)),i=Math.max(0,parseInt(e.y/this.size)),r=Math.min(this.width,parseInt((e.x+e.width)/this.size)),o=Math.min(this.height,parseInt((e.y+e.height)/this.size)),a=[],s=i;s<=o;s++)for(var u=n;u<=r;u++)this.grid[u][s].forEach(function(e){e!==t&&-1===a.indexOf(e)&&a.push(e)});return a}},{key:"remove",value:function(e,t){for(var n=Math.max(0,parseInt(e.x/this.size)),i=Math.max(0,parseInt(e.y/this.size)),r=Math.min(this.width,parseInt((e.x+e.width)/this.size)),o=Math.min(this.height,parseInt((e.y+e.height)/this.size)),a=i;a<=o;a++)for(var s=n;s<=r;s++)for(var u=0;u<this.grid[s][a].length;u++)this.grid[s][a][u]===t&&this.grid[s][a].splice(u,1)}},{key:"getWidth",value:function(){return this.width}},{key:"getHeight",value:function(){return this.height}},{key:"getSize",value:function(){return this.size}}]),e}(),rn=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),on=function(){function e(t,n){P(this,e),this.isSolid=!1,this.texture=t,this.id=n,this.disappear=!1,this.assets=bt.getAssets("tiles")}return rn(e,[{key:"render",value:function(e,t,n){e.myDrawImage(this.texture,t,n,64,64)}},{key:"getId",value:function(){return this.id}}]),e}(),an=function(e){function t(e){return S(this,t),C(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,bt.getAssets("tiles").path,e))}return I(t,e),t}(on),sn=function(e){function t(e){return W(this,t),L(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,bt.getAssets("tiles").pathBlue,e))}return H(t,e),t}(on),un=function(e){function t(e){return R(this,t),G(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,bt.getAssets("tiles").pathYellow,e))}return A(t,e),t}(on),hn=function(e){function t(e){z(this,t);var n=D(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,bt.getAssets("tiles").wall,e));return n.isSolid=!0,n}return B(t,e),t}(on),ln=function(e){function t(e){Y(this,t);var n=N(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,bt.getAssets("tiles").wallBlue,e));return n.isSolid=!0,n}return F(t,e),t}(on),cn=function(e){function t(e){X(this,t);var n=$(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,bt.getAssets("tiles").wallYellow,e));return n.isSolid=!0,n.disappear=!0,n}return K(t,e),t}(on),fn=function(e){function t(e){return V(this,t),J(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,bt.getAssets("tiles").pathGreen,e))}return q(t,e),t}(on),pn=function(e){function t(e){U(this,t);var n=Q(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,bt.getAssets("tiles").wallGreen,e));return n.isSolid=!0,n}return Z(t,e),t}(on),yn=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),dn=bt.getAssets("tiles"),gn=[];gn[0]=new an(0),gn[1]=new hn(1),gn[2]=new cn(2),gn[3]=new ln(3),gn[4]=new un(4),gn[5]=new sn(5),gn[7]=new fn(7),gn[8]=new pn(8);var bn=function(){function e(){ee(this,e)}return yn(e,null,[{key:"getAssets",value:function(){return dn}},{key:"getTiles",value:function(){return gn}}]),e}(),vn=function(e){function t(e,n,i,r,o){return te(this,t),ne(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,i,r,o))}return ie(t,e),t}(St),wn=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),mn=64,kn=64,On=function(e){function t(e,n,i,r,o){re(this,t);var a=oe(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,i,r,o));return a.manager=a.handler.getWorld().getLightManager(),a.posX=Math.floor(n/mn),a.posY=Math.floor(i/kn),a.bounds.x=0,a.bounds.y=0,a.bounds.width=0,a.bounds.height=0,a.flickering=!1,a.lastFlickerCounter=0,a.flickerToggle=0,a.flickerCount=0,a.flickerTimes=0,a.flickerLength=0,a.moveThrough=!0,a.assets=bt.getAssets("tiles"),a.type="light",a.init(),a}return ae(t,e),wn(t,[{key:"init",value:function(){this.makeSureOnWall(),this.expandLight()}},{key:"makeSureOnWall",value:function(){var e=this.posX,t=this.posY;if(1!==this.handler.getWorld().getTile(e,t).id)for(var n=t-1;n<t+1;n++)for(var i=e-1;i<e+1;i++)if(1===this.handler.getWorld().getTile(i,n).id)return this.posX=i,void(this.posY=n)}},{key:"expandLight",value:function(){for(var e=-2;e<3;e++)for(var t=-2;t<3;t++)this.manager.lightMap[this.posX+t][this.posY+e]=Math.min(this.manager.lightMap[this.posX+t][this.posY+e],.65);for(var n=-1;n<2;n++)for(var i=-1;i<2;i++)this.manager.lightMap[this.posX+i][this.posY+n]=Math.min(this.manager.lightMap[this.posX+i][this.posY+n],.5);this.manager.lightMap[this.posX][this.posY]=.3}},{key:"dimLights",value:function(e){for(var t=-2;t<3;t++)for(var n=-2;n<3;n++)this.manager.lightMap[this.posX+n][this.posY+t]=Math.min(.75,.65+e);for(var i=-1;i<2;i++)for(var r=-1;r<2;r++)this.manager.lightMap[this.posX+r][this.posY+i]=Math.min(.75,.5+e);this.manager.lightMap[this.posX][this.posY]=Math.min(.75,.3+e)}},{key:"chanceToFlicker",value:function(){Math.random()<.85||(this.lastFlickerCounter=0,this.flickerLength=Math.floor(5*Math.random())+4,this.flickering=!0)}},{key:"flickerLights",value:function(){0===this.flickerCount&&(0===this.flickerToggle?(this.dimLights(.25),this.flickerToggle=1):(this.expandLight(),this.flickerToggle=0)),this.flickerCount++,this.flickerCount>=this.flickerLength&&(this.flickerCount=0,this.flickerTimes++),this.flickerTimes>=6&&(this.flickerTimes=0,this.flickering=!1)}},{key:"tick",value:function(){this.flickering?this.flickerLights():++this.lastFlickerCounter>240&&this.chanceToFlicker()}},{key:"render",value:function(e){e.myDrawImage(this.assets.lantern,this.x-this.handler.getGameCamera().getxOffset(),this.y-this.handler.getGameCamera().getyOffset(),this.width,this.height)}}]),t}(vn),_n=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),xn=function(){function e(t){se(this,e),this.handler=t,this.init()}return _n(e,[{key:"init",value:function(){this.sources=[],this.lightMap=[],this.fillLightMap()}},{key:"fillLightMap",value:function(){for(var e=this.handler.getWorld().getWorldWidth(),t=this.handler.getWorld().getWorldHeight(),n=0;n<t;n++)for(var i=0;i<e;i++)this.lightMap[i]||(this.lightMap[i]=[]),this.lightMap[i][n]=.85}},{key:"tick",value:function(){this.sources.forEach(function(e){e.tick()})}},{key:"render",value:function(e,t,n,i,r){this.sources.forEach(function(e){e.render(r)}),this.drawLightBlocks(e,t,n,i,r)}},{key:"drawLightBlocks",value:function(e,t,n,i,r){r.fillStyle="black";for(var o=n;o<i;o++)for(var a=e;a<t;a++){var s=this.handler.getWorld().getTile(a,o).type;r.globalAlpha="switch"===s||"exit"===s?.3:this.lightMap[a][o],r.fillRect(64*a-this.handler.getGameCamera().getxOffset(),64*o-this.handler.getGameCamera().getyOffset(),64,64)}r.globalAlpha=1}},{key:"addSource",value:function(e,t){var n=new On(this.handler,64*e,64*t,64,64,this);this.handler.getWorld().getEntityManager().addEntity(n),this.sources.push(n)}},{key:"setLight",value:function(e,t,n){this.lightMap[e][t]=n}},{key:"removeSources",value:function(){this.handler.getWorld().getEntityManager().removeEntitiesByType("light"),this.sources=[]}}]),e}(),Tn=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Mn=function(e){function t(e,n,i,r,o){ue(this,t);var a=he(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,i,r,o));return a.assets=bt.getAssets("tiles"),a.type="exit",a.bounds.x=15,a.bounds.y=15,a.bounds.width=a.width-30,a.bounds.height=a.height-30,a}return le(t,e),Tn(t,[{key:"tick",value:function(){}},{key:"render",value:function(e){e.myDrawImage(this.assets.exit,this.x-this.handler.getGameCamera().getxOffset(),this.y-this.handler.getGameCamera().getyOffset(),this.width,this.height)}}]),t}(vn),jn=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),En=60,Pn=function(e){function t(e,n,i,r,o){ce(this,t);var a=fe(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,i,r,o));return a.assets=bt.getAssets("tiles"),a.type="switch",a.bounds.x=5,a.bounds.y=25,a.bounds.width=a.width-18,a.bounds.height=a.height-35,a.currentSwitch=a.assets.switchGreen,a}return pe(t,e),jn(t,[{key:"tick",value:function(){En++}},{key:"toggleSwitch",value:function(){En<40||(this.currentSwitch===this.assets.switchGreen?(this.currentSwitch=this.assets.switchBlue,this.color="blue"):(this.currentSwitch=this.assets.switchGreen,this.color="green"),this.handler.getWorld().swapGreenAndBlueTiles(this.color),En=0)}},{key:"render",value:function(e){e.myDrawImage(this.currentSwitch,this.x-this.handler.getGameCamera().getxOffset(),this.y-this.handler.getGameCamera().getyOffset(),this.width,this.height)}}]),t}(vn),Sn=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Cn=document.getElementById("dialogue"),In=document.getElementById("speaker"),Wn=5,Ln=0,Hn="",Rn="",Gn=!1,An=!1,zn=!1,Dn=[],Bn=[],Yn=function(){function e(){ye(this,e)}return Sn(e,[{key:"tick",value:function(){Wn>=0&&Dn.length&&(Dn[0].length?this.speakNextLetter():Ln>=120?this.resetForNextSentence():Ln++),Wn<30&&Wn++}},{key:"resetForNextSentence",value:function(){Dn.splice(0,1),Bn.splice(0,1),Cn.innerHTML="",In.innerHTML="",Ln=0}},{key:"speakNextLetter",value:function(){In.innerHTML=Bn[0]+":";var e=Dn[0][0];"@"===e&&(Gn=!Gn),"$"===e&&(zn=!zn),"&"===e&&(An=!An),Hn="",Rn="",Gn&&(Hn+='<span style="color:red">',Rn+="</span>"),zn&&(Hn+='<span style="color:yellow">',Rn+="</span>"),An&&(Hn+="<em>",Rn+="</em>"),"%"===e&&(Rn+="<br />"),Cn.innerHTML+=Hn+e.replace("%","").replace("@","").replace("&","").replace("$","")+Rn,Dn[0].splice(0,1),Wn=0}},{key:"addWords",value:function(e,t){Dn.push(t.split("")),Bn.push(e)}},{key:"clear",value:function(){Dn=[],Bn=[],Cn.innerHTML="",In.innerHTML=""}}]),e}(),Nn=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Fn=function(e){function t(e,n,i,r,o,a){de(this,t);var s=ge(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,i,r,o));return s.type="journal",s.bounds.x=15,s.bounds.y=15,s.bounds.width=s.width-30,s.bounds.height=s.height-30,s.journal=a,s.triggered=!1,s}return be(t,e),Nn(t,[{key:"tick",value:function(){}},{key:"render",value:function(e){e.fillStyle="yellow",e.fillRect(this.bounds.x+this.x-this.handler.getGameCamera().getxOffset(),this.bounds.y+this.y-this.handler.getGameCamera().getyOffset(),this.bounds.width,this.bounds.height)}},{key:"triggerEntry",value:function(){var e=this;this.triggered||(this.triggered=!0,this.journal.getText().forEach(function(t){e.handler.getWorld().dialogue.addWords(e.journal.name,t)}))}}]),t}(vn),Xn=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),$n=function(){function e(){ve(this,e)}return Xn(e,[{key:"getText",value:function(){return this.text}},{key:"setText",value:function(e){this.text=e}}]),e}(),Kn=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Vn=function(e){function t(){we(this,t);var e=me(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.setText(e.myText()),e.name="Journal #001",e}return ke(t,e),Kn(t,[{key:"myText",value:function(){return["Despite his best efforts, I've stayed alive longer than anyone else...","Before he sent me down into this hellhole, I was able to swipe one of his notebooks. He noticed, and broke my leg with a pipe...","Beware of the grotesque beings down here. One touch from them will plague your mind.","The beings are often slow, so make use of the switches and rotating walls to cut them off.","For all who come after me, I hope to provide some small guidance."]}}]),t}($n),Jn=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),qn=function(e){function t(){Oe(this,t);var e=_e(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.setText(e.myText()),e.name="Journal #002",e}return xe(t,e),Jn(t,[{key:"myText",value:function(){return["This place seems dark and unending. I feel as though I am peering into the abyss at every turn..","I'm not sure how much farther down it goes... I hope I'll see it to the end.","I have to hope, because the only thing left for me is fear and this damned broken tibia.","One odd thing... I have encountered an $old man$ in some of the darkest corners of the maze.","There is something very calming about him. He makes me feel as though I can push on a little longer.","He never speaks, and those... things never bother him. I wonder why?"]}}]),t}($n),Un=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Qn=function(e){function t(){Te(this,t);var e=Me(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.setText(e.myText()),e.name="Journal #003",e}return je(t,e),Un(t,[{key:"myText",value:function(){return["It seems like this place gets larger with each floor I descend. Am I in a pyramid?","The gurgling noises come and go, but a foul stench is always present.","I am feeling migraines from time to time, and hearing an eerie voice constantly calling out to me from within. Like it wants to escape.","I think the silence and darkness are getting the better of me. The $bleeding$ won't stop. I am... afraid."]}}]),t}($n),Zn=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),ei=function(e){function t(){Ee(this,t);var e=Pe(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.setText(e.myText()),e.name="Journal #004",e}return Se(t,e),Zn(t,[{key:"myText",value:function(){return["It has been bothering me for a while and I can't get past it. Those creatures, they seem somehow... familiar.","I'm not sure from when or where, but their faces are familiar to me.","Another thing bothering me is that same old man on every floor. How is he traveling between the floors without passing me?","I'll think more on this later... The voice in my head is getting louder and is more frequent.","(&At the bottom of the page you see these words written in what looks to be @blood@.&)","@... ~HeHe. VeRy GooD!~@"]}}]),t}($n),ti=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),ni=function(e){function t(){Ce(this,t);var e=Ie(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.setText(e.myText()),e.name="Journal #005",e}return We(t,e),ti(t,[{key:"myText",value:function(){return["(&This page is covered in sweat and droplets of @blood@&)","I got a better look at the creatures today.","The strange part is that they all look the same. They all have the same face. %@~WiTH THiS GRoSS SMiLe.~@","It gets creepier. I got a good look at their faces this time in the light.","They all look like the $old man$. &EXACTLY& like him...","@~eVeRy.~","~SiNGLe.~","~oNe.~@"]}}]),t}($n),ii=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),ri=function(e){function t(){Le(this,t);var e=He(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.setText(e.myText()),e.name="JournaL 0o0o06",e}return Re(t,e),ii(t,[{key:"myText",value:function(){return["To whomever...@~you~@ has made it this far, the $old man$ on this floor has passed away.%@~He iS DeaD you KNoW.~@","I fear no help is available to you.%@~you aRe aLoNe!~@%I barely made it back here on my own.%@~you WeRe NeVeR aLONE~@","I did find an eerie discovery while searching the old man. It seems he bares the same small branding upon his neck as I do.","I cannot see what mine says, but I believe his to be the letter $C$ followed by a $5 digit number$.%@~you KNoW WHaT THiS MeaNS.~@","The headaches rarely stop now.%@~aND SooN NeVeR WiLL.~@"]}}]),t}($n),oi=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),ai=function(e){function t(){Ge(this,t);var e=Ae(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.setText(e.myText()),e.name="HeHe! My eNTRy",e}return ze(t,e),oi(t,[{key:"myText",value:function(){return["@~WoW. you Too HaVe MaDe iT To THe eND. WHaT a ViLe JoKe aWaiTS.~","~HoW PiTiFuL i MuST HaVe SeeMeD, THiNKiNG i PuLLeD THe WooL oVeR HiS eyeS.~","~aT THe eND oF THiS FlooR, i HAVE SEEN THE ANSWER. SooN you WiLL Too. SHaLL you GueSS WHaT i SaW?~","~you WouLDN'T BeLieVe Me eVeN iF i ToLD you.~","~SCuRRy oN LiTTLe RaT! you SooN Too WiLL LeaRN THe TRuTH.~@"]}}]),t}($n),si=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),ui=64,hi=64,li=!1,ci=!1,fi=0,pi=0,yi=function(){function e(t){De(this,e),this.width=null,this.height=null,this.tiles=[],this.handler=t,t.setWorld(this),this.entityManager=new st(t,new en(t,20,20)),this.spatialGrid=new nn(this.handler.getWidth()*ui,this.handler.getHeight()*hi,64),this.level=1,this.loadWorld(),this.lightManager=new xn(t),this.dialogue=new Yn,this.init()}return si(e,[{key:"getLightManager",value:function(){return this.lightManager}},{key:"changeLevel",value:function(){this.setPlayerSpawn(this.spawnX,this.spawnY),this.level+=1,this.tiles=[],pi=0,this.lightManager.removeSources(),this.entityManager.removeEntitiesByType("exit"),this.entityManager.removeEntitiesByType("switch"),this.entityManager.removeEntitiesByType("journal"),ci||this.entityManager.removeEntitiesByType("monster"),ci=!1,this.loadWorld(),this.init()}},{key:"spawnRandomRoomEntities",value:function(){var e=new Mn(this.handler,(this.width-2)*ui,(this.height-2)*hi,ui,hi),t=Math.random()<.5,n=t?(this.width-3)*ui:2*ui,i=t?2*hi:(this.height-3)*hi;this.entityManager.addEntity(new Pn(this.handler,n,i,ui,hi)),this.entityManager.addEntity(e)}},{key:"init",value:function(){this.setPlayerSpawn(this.spawnX,this.spawnY),this.lightManager.init(),this.lightManager.fillLightMap(),1===this.level?(this.entityManager.addEntity(new Mn(this.handler,7*ui,7*hi,ui,hi)),this.entityManager.addEntity(new Fn(this.handler,1*ui,2*hi,ui,hi,new Vn)),this.entityManager.addEntity(new Bt(this.handler,6*ui,2*ui)),this.entityManager.addEntity(new Pn(this.handler,4*ui,4*hi,ui,hi)),this.lightManager.addSource(5,3)):(this.spawnRandomRoomEntities(),this.addEvenSpreadOfLightSources(7),this.addEvenSpreadOfMonsters(7),this.spawnJournals())}},{key:"spawnJournals",value:function(){var e=[new qn,new Qn,new ei,new ni,new ri,new ai],t=e[2*this.level-4],n=e[2*this.level-3];this.entityManager.addEntity(new Fn(this.handler,2*ui,2*hi,ui,hi,t)),this.entityManager.addEntity(new Fn(this.handler,(this.width-3)*ui,(this.height-3)*hi,ui,hi,n))}},{key:"addEvenSpreadOfLightSources",value:function(e){for(var t=e;t<=this.height;t+=e)for(var n=e;n<=this.width;n+=e)this.height-t>2&&this.width-n>2&&this.lightManager.addSource(n,t)}},{key:"getWorldHeight",value:function(){return this.height}},{key:"getWorldWidth",value:function(){return this.width}},{key:"addEvenSpreadOfMonsters",value:function(e){for(var t=e;t<=this.height;t+=e)for(var n=e;n<=this.width;n+=e)this.height-t>2&&this.width-n>2&&this.entityManager.addEntity(new Bt(this.handler,n*ui,t*ui))}},{key:"setPlayerSpawn",value:function(e,t){this.entityManager.getPlayer().setX(e),this.entityManager.getPlayer().setY(t)}},{key:"loadWorld",value:function(){for(var e=this.fillWorld(this.level,1,1),t=0;t<this.height;t++)for(var n=0;n<this.width;n++)this.tiles[n]||(this.tiles[n]=[]),this.tiles[n][t]=e[n][t]}},{key:"fillWorld",value:function(e,t,n){var i=Jt.getRandomMaze(e,t,n);return this.height=i.mazeHeight,this.width=i.mazeWidth,this.spawnX=i.spawnX*ui,this.spawnY=i.spawnY*hi,i.pieces}},{key:"swapGreenAndBlueTiles",value:function(e){"green"===e?(this.swapTilesByID(5,3),this.swapTilesByID(8,7)):"blue"===e&&(this.swapTilesByID(3,5),this.swapTilesByID(7,8))}},{key:"getInput",value:function(){}},{key:"swapTilesByID",value:function(e,t){for(var n=1;n<this.height;n++)for(var i=1;i<this.width;i++)this.tiles[i][n]===e&&(this.tiles[i][n]=this.handler.getWorld().getTile(i,n).disappear?0:t)}},{key:"checkForWallSwap",value:function(){++fi>300&&(fi=0,li?this.swapTilesByID(4,2):this.swapTilesByID(2,4),li=!li)}},{key:"tick",value:function(e){this.getInput(),this.checkForWallSwap(),this.entityManager.tick(e),this.lightManager.tick(e),this.dialogue.tick(),ci||1===this.level||++pi/60>=240&&(alert("the monsters crumble all around you."),this.entityManager.removeEntitiesByType("monster"),ci=!0)}},{key:"render",value:function(e){var t=parseInt(Math.max(0,this.handler.getGameCamera().getxOffset()/ui)),n=parseInt(Math.min(this.width,(this.handler.getGameCamera().getxOffset()+this.handler.getWidth())/ui+1)),i=parseInt(Math.max(0,this.handler.getGameCamera().getyOffset()/hi)),r=parseInt(Math.min(this.height,(this.handler.getGameCamera().getyOffset()+this.handler.getHeight())/hi+1));this.drawTiles(t,n,i,r,e),this.entityManager.render(e),this.lightManager.render(t,n,i,r,e)}},{key:"drawTiles",value:function(e,t,n,i,r){for(var o=n;o<i;o++)for(var a=e;a<t;a++)void 0!==this.getTile(a,o)&&this.getTile(a,o).render(r,a*ui-this.handler.getGameCamera().getxOffset(),o*hi-this.handler.getGameCamera().getyOffset())}},{key:"getTile",value:function(e,t){try{return bn.getTiles()[this.tiles[e][t]]}catch(e){}}},{key:"getWidth",value:function(){return this.width}},{key:"getHeight",value:function(){return this.height}},{key:"getEntityManager",value:function(){return this.entityManager}},{key:"getSpatialGrid",value:function(){return this.spatialGrid}}]),e}(),di=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),gi=function(){function e(t){Be(this,e),this.handler=t,this.world=new yi(t)}return di(e,[{key:"tick",value:function(e){this.world.tick(e)}},{key:"render",value:function(e){this.world.render(e)}}]),e}(),bi=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),vi=function(){function e(t,n,i){Ye(this,e),this.xOffset=n,this.yOffset=i,this.handler=t}return bi(e,[{key:"centerOnEntity",value:function(e){this.xOffset=e.getX()-this.handler.getWidth()/2+e.getWidth()/2,this.yOffset=e.getY()-this.handler.getHeight()/2+e.getHeight()/2,this.checkBlankSpace()}},{key:"move",value:function(e,t){this.xOffset+=e,this.yOffset+=t,this.checkBlankSpace()}},{key:"getxOffset",value:function(){return parseInt(this.xOffset)}},{key:"getyOffset",value:function(){return parseInt(this.yOffset)}},{key:"setxOffset",value:function(e){this.xOffset=e}},{key:"setyOffset",value:function(e){this.yOffset=e}},{key:"checkBlankSpace",value:function(){this.xOffset<0?this.xOffset=0:this.xOffset>64*this.handler.getWorld().getWidth()-this.handler.getWidth()&&(this.xOffset=64*this.handler.getWorld().getWidth()-this.handler.getWidth()),this.yOffset<0?this.yOffset=0:this.yOffset>64*this.handler.getWorld().getHeight()-this.handler.getHeight()&&(this.yOffset=64*this.handler.getWorld().getHeight()-this.handler.getHeight())}}]),e}(),wi=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),mi=function(){function e(t){Ne(this,e),this.game=t,this.console=document.getElementById("console"),this.devMessage(" dev cheats initialized \n 2 - clipping \n 3 - invincibility \n 4 - super speed \n 1 - all cheats ")}return wi(e,[{key:"devMessage",value:function(e){var t=["background: linear-gradient(#ffffff, #ff00ff)","border: 1px solid #3E0E02","color: black","display: block","line-height: 40px","text-align: center","font-size: 18px","font-weight: bold"].join(";");console.log("%c"+e,t)}},{key:"getWidth",value:function(){return this.game.getWidth()}},{key:"getHeight",value:function(){return this.game.getHeight()}},{key:"getKeyManager",value:function(){return this.game.getKeyManager()}},{key:"getGameCamera",value:function(){return this.game.getGameCamera()}},{key:"getWorld",value:function(){return this.world}},{key:"setWorld",value:function(e){this.world=e}},{key:"getGame",value:function(){return this.game}}]),e}(),ki=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Oi=[],_i=function(){function e(){Fe(this,e)}return ki(e,[{key:"tick",value:function(){this.up=Oi[38],this.down=Oi[40],this.left=Oi[37],this.right=Oi[39],this.one=Oi[49],this.two=Oi[50],this.three=Oi[51],this.four=Oi[52],this.a=Oi[65],this.w=Oi[87],this.s=Oi[83],this.d=Oi[68],this.z=Oi[90],this.q=Oi[81],this.enter=Oi[13]}}]),e}();window.onkeydown=function(e){Oi[e.keyCode]=!0},window.onkeyup=function(e){Oi[e.keyCode]=!1};var xi=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Ti=(function(e){function t(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Xe(this,t),$e(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}Ke(t,e),xi(t,[{key:"render",value:function(e){if(e){var t=this.handler.getWidth(),n=this.handler.getHeight();e.fillStyle="black",e.fillRect(0,0,t,n),e.drawText({fillColor:"white",text:"you are",fontSize:32,x:90,y:n/4}),e.drawText({fillColor:"yellow",text:"A L O N E",fontSize:64,x:80,y:n/2}),e.drawText({fillColor:"white",text:"press enter",fontSize:32,x:210,y:n/1.4})}}},{key:"getInput",value:function(e){if(this.handler.getKeyManager().enter){var t=new gi(this.handler);this.handler.getGame().getGameState().setState(t)}}}])}(xt),function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}()),Mi=function(){function e(t){Ve(this,e),this.currentState=null,this.handler=t}return Ti(e,[{key:"tick",value:function(e){throw"Every state needs a tick"}},{key:"render",value:function(e){throw"Every state needs a render"}},{key:"getState",value:function(){return this.currentState}},{key:"setState",value:function(e){this.currentState=e}}]),e}(),ji=function(){var e=function(e){return Math.sin(6.283184*e)},t=function(e){return e%1*2-1},n=function(e){return e%1<.5?1:-1},i=function(e){var t=e%1*4;return t<2?t-1:3-t},r=function(e){return.003959503758*Math.pow(2,(e-128)/12)},o=function(e,t,n){var i=a[e.i[0]],o=e.i[1],s=e.i[3],u=a[e.i[4]],h=e.i[5],l=e.i[8],c=e.i[9],f=e.i[10]*e.i[10]*4,p=e.i[11]*e.i[11]*4,y=e.i[12]*e.i[12]*4,d=1/y,g=e.i[13],b=n*Math.pow(2,2-e.i[14]),v=new Int32Array(f+p+y),w=0,m=0,k=void 0,O=void 0,_=void 0,x=void 0,T=void 0,M=void 0,j=void 0;for(k=0,O=0;k<f+p+y;k++,O++)O>=0&&(g=g>>8|(255&g)<<4,O-=b,M=r(t+(15&g)+e.i[2]-128),j=r(t+(15&g)+e.i[6]-128)*(1+8e-4*e.i[7])),_=1,k<f?_=k/f:k>=f+p&&(_-=(k-f-p)*d),x=M,s&&(x*=_*_),w+=x,T=i(w)*o,x=j,l&&(x*=_*_),m+=x,T+=u(m)*h,c&&(T+=(2*Math.random()-1)*c),v[k]=80*T*_|0;return v},a=[e,n,t,i],s=void 0,u=void 0,h=void 0,l=void 0,c=void 0;this.init=function(e){s=e,u=e.endPattern-2,h=0,l=e.rowLen*e.patternLen*(u+1)*2,c=new Int32Array(l)},this.generate=function(){var t=void 0,n=void 0,i=void 0,r=void 0,f=void 0,p=void 0,y=void 0,d=void 0,g=void 0,b=void 0,v=void 0,w=void 0,m=new Int32Array(l),k=s.songData[h],O=s.rowLen,_=s.patternLen,x=0,T=0,M=void 0,j=void 0,E=!1,P=[];for(i=0;i<=u;++i)for(y=k.p[i],r=0;r<_;++r){var S=y?k.c[y-1].f[r]:0;S&&(k.i[S-1]=k.c[y-1].f[r+_]||0,S<16&&(P=[]));var C=a[k.i[15]],I=k.i[16]/512,W=Math.pow(2,k.i[17]-9)/O,L=k.i[18],H=k.i[19],R=43.23529*k.i[20]*3.141592/44100,G=1-k.i[21]/255,A=1e-5*k.i[22],z=k.i[23]/32,D=k.i[24]/512,B=6.283184*Math.pow(2,k.i[25]-9)/O,Y=k.i[26]/255,N=k.i[27]*O;for(v=(i*_+r)*O,f=0;f<4;++f)if(p=y?k.c[y-1].n[r+f*_]:0){P[p]||(P[p]=o(k,p,O));var F=P[p];for(n=0,t=2*v;n<F.length;n++,t+=2)m[t]+=F[n]}for(n=0;n<O;n++)d=2*(v+n),b=m[d],b||E?(w=R,L&&(w*=C(W*d)*I+.5),w=1.5*Math.sin(w),x+=w*T,M=G*(b-T)-x,T+=w*M,b=3==H?T:1==H?M:x,A&&(b*=A,b=b<1?b>-1?e(.25*b):-1:1,b/=A),b*=z,E=b*b>1e-5,g=Math.sin(B*d)*D+.5,j=b*(1-g),b*=g):j=0,d>=N&&(j+=m[d-N+1]*Y,b+=m[d-N]*Y),m[d]=0|j,m[d+1]=0|b,c[d]+=0|j,c[d+1]+=0|b}return++h/8},this.createWave=function(){var e=44+2*l-8,t=e-36,n=new Uint8Array(44+2*l);n.set([82,73,70,70,255&e,e>>8&255,e>>16&255,e>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&t,t>>8&255,t>>16&255,t>>24&255]);for(var i=0,r=44;i<l;++i){var o=c[i];o=o<-32767?-32767:o>32767?32767:o,n[r++]=255&o,n[r++]=o>>8&255}return n},this.getData=function(e,t){for(var n=2*Math.floor(44100*e),i=new Array(t),r=0;r<2*t;r+=1){var o=n+r;i[r]=e>0&&o<c.length?c[o]/32768:0}return i}},Ei=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Pi=(function(){function e(){Je(this,e),this.bgMusic={songData:[{i:[3,59,140,0,1,60,128,3,0,29,92,28,95,0,0,3,96,2,1,2,124,135,11,25,130,4,97,2],p:[1],c:[{n:[112,,,,114,,,,117,,,,114,,,,112,,,,114,,,,117,,,,114,,,,141,,,,,,,,,,,,,,,,138],f:[]}]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]}],rowLen:22050,patternLen:32,endPattern:2},this.loaded=!1,this.lastTime=0,this.logged=0}Ei(e,[{key:"init",value:function(){var e=new ji;e.init(this.bgMusic);var t=!1;setInterval(function(){if(!t&&(t=e.generate()>=1)){var n=e.createWave(),i=document.createElement("audio");i.src=URL.createObjectURL(new Blob([n],{type:"audio/wav"})),i.play(),i.volume=.3,setInterval(function(){var t=i.currentTime;e.getData(t,300)&&0===this.logged&&this.logged++,i.play(),i.loop=!0,this.lastTime=t},16)}},0)}},{key:"tick",value:function(){}},{key:"render",value:function(){}}])}(),function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}()),Si=!1,Ci=void 0,Ii=void 0,Wi=void 0,Li=void 0,Hi=void 0,Ri=void 0,Gi=void 0;new(function(){function e(t,n,i){qe(this,e),this.height=i,this.title=t,this.width=n}return Pi(e,[{key:"run",value:function(){var e=this;this.init();var t=0,n=0,i=Date.now(),r=Date.now(),o=0;!function a(){Si&&(i=Date.now(),t=i-r,o+=t,r=i),o>=1e3/60&&(n=o/1e3,e.tick(n),e.render(),o=0),window.requestAnimationFrame(a)}()}},{key:"start",value:function(){Si||(Si=!0,this.run())}},{key:"getSoundManager",value:function(){}},{key:"getKeyManager",value:function(){return Wi}},{key:"getDisplay",value:function(){return Ii}},{key:"getWidth",value:function(){return this.width}},{key:"getHeight",value:function(){return this.height}},{key:"getGameCamera",value:function(){return Hi}},{key:"getGameState",value:function(){return Ri}},{key:"init",value:function(){Li=new mi(this),Ii=new Ze(this.title,this.width,this.height),Wi=new _i,Ci=Ii.getGraphics(),Ri=new Mi,Hi=new vi(Li,0,0),Gi=new gi(Li),Ri.setState(Gi)}},{key:"tick",value:function(e){Wi.tick(),Ri.getState()&&!Ii.paused&&Ri.getState().tick(e)}},{key:"render",value:function(){Ri.getState()&&!Ii.paused&&Ri.getState().render(Ci)}}]),e}())("Lost!",448,448).start();var Ai=n(1);n.n(Ai)},function(e,t){}]);</script></body>

</html>
